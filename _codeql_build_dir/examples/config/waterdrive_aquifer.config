# ==============================================================================
# Waterdrive Reservoir with Aquifer Configuration
# ==============================================================================
# Demonstrates ECLIPSE-compatible aquifer modeling:
# - Carter-Tracy analytical aquifer
# - Fetkovich pseudo-steady state aquifer
# - Aquifer-reservoir connections
#
# Usage: mpirun -np 4 fsrm -c config/waterdrive_aquifer.config
# ==============================================================================

[SIMULATION]
name = waterdrive_aquifer
start_time = 0.0
end_time = 315360000.0                # 10 years in seconds
dt_initial = 86400.0                  # 1 day initial
dt_min = 3600.0                       # 1 hour min
dt_max = 2592000.0                    # 30 days max
max_timesteps = 500
output_frequency = 10

# Black oil model
fluid_model = BLACK_OIL
solid_model = ELASTIC

# Disable unnecessary physics
enable_geomechanics = false
enable_thermal = false
enable_fractures = false

# Solver settings
rtol = 1.0e-6
atol = 1.0e-8
max_nonlinear_iterations = 50

[GRID]
# Simple reservoir grid
nx = 20
ny = 20
nz = 5
Lx = 2000.0                           # 2 km
Ly = 2000.0                           # 2 km
Lz = 50.0                             # 50 m thick

mesh_type = CARTESIAN
use_unstructured = false

[ROCK]
porosity = 0.25
permeability_x = 200.0                # mD
permeability_y = 200.0
permeability_z = 20.0                 # 10:1 anisotropy
compressibility = 4.35e-10            # 1/Pa
density = 2600.0

[FLUID]
type = BLACK_OIL

# Stock tank properties
oil_density_std = 820.0               # kg/m³
gas_density_std = 0.85                # kg/m³
water_density_std = 1020.0            # kg/m³ (slightly saline)

# Viscosities
oil_viscosity = 0.003                 # 3 cP
gas_viscosity = 0.00002               # 0.02 cP
water_viscosity = 0.0005              # 0.5 cP

# PVT
solution_gor = 80.0                   # sm³/sm³
bubble_point_pressure = 15e6          # 15 MPa
pvt_correlation = STANDING

# Relative permeability
swc = 0.20                            # Connate water
sor = 0.25                            # Residual oil
sgc = 0.05                            # Critical gas
corey_nw = 2.5
corey_no = 2.0
corey_ng = 2.5

# ==============================================================================
# AQUIFER SECTION - ECLIPSE-like aquifer definitions
# ==============================================================================

[AQUIFER1]
# Carter-Tracy infinite-acting aquifer (edge water drive)
type = CARTER_TRACY
id = 1
geometry = RADIAL
initial_pressure = 25.5e6             # 25.5 MPa (slightly above reservoir)
permeability = 150.0                  # mD (aquifer permeability)
porosity = 0.22
thickness = 30.0                      # m
compressibility = 4.5e-10             # 1/Pa
viscosity = 0.0005                    # Pa·s (water viscosity)
inner_radius = 1000.0                 # Reservoir radius (m)
outer_radius = 50000.0                # Large (nearly infinite)
encroachment_angle = 0.75             # 270 degrees (3/4 of circle)

[AQUIFER2]
# Fetkovich bottom water drive
type = FETKOVICH
id = 2
initial_pressure = 26e6               # 26 MPa
productivity_index = 5e-7             # m³/s/Pa
initial_volume = 2e9                  # 2 billion m³ encroachable water

[AQUIFER_CONNECTION1]
# Connect Carter-Tracy aquifer to reservoir edge
aquifer_id = 1
i1 = 1
i2 = 1
j1 = 1
j2 = 20
k1 = 1
k2 = 5
face = I_MINUS
trans_mult = 1.0
allow_crossflow = true

[AQUIFER_CONNECTION2]
# Connect Fetkovich aquifer to bottom layer
aquifer_id = 2
i1 = 1
i2 = 20
j1 = 1
j2 = 20
k1 = 5
k2 = 5
face = K_PLUS
trans_mult = 0.5                      # Partial connectivity
allow_crossflow = true

# ==============================================================================
# WELL SECTION
# ==============================================================================

[WELL1]
name = PROD1
type = PRODUCER
i = 10
j = 10
k = 2
control_mode = RATE
target_value = 5e-4                   # ~40,000 bbl/day
min_bhp = 10e6                        # 10 MPa
diameter = 0.2

[WELL2]
name = PROD2
type = PRODUCER
i = 5
j = 15
k = 2
control_mode = RATE
target_value = 3e-4                   # ~24,000 bbl/day
min_bhp = 10e6
diameter = 0.2

[WELL3]
name = PROD3
type = PRODUCER
i = 15
j = 5
k = 2
control_mode = RATE
target_value = 3e-4
min_bhp = 10e6
diameter = 0.2

# ==============================================================================
# GROUP CONTROL - ECLIPSE GRUPTREE/GCONPROD style
# ==============================================================================

[GROUP1]
name = PLATFORM_A
parent = FIELD
wells = PROD1, PROD2, PROD3
control_mode = ORAT                   # Oil rate control
oil_rate_target = 0.001               # Total platform target (m³/s)
oil_rate_max = 0.0012
liquid_rate_max = 0.002
guide_rate_type = OIL                 # Allocate based on oil potential

# ==============================================================================
# INITIAL CONDITIONS
# ==============================================================================

[IC1]
field = PRESSURE
distribution = GRADIENT
value = 25e6                          # Initial pressure at datum
gradient = 0, 0, 9810                 # Hydrostatic (Pa/m)

[IC2]
field = SATURATION_W
distribution = UNIFORM
value = 0.20                          # Connate water

[IC3]
field = SATURATION_G
distribution = UNIFORM
value = 0.0                           # No free gas initially

# ==============================================================================
# BOUNDARY CONDITIONS
# ==============================================================================

[BC1]
# No-flow on sides (aquifer handles water influx)
type = NEUMANN
field = PRESSURE
location = XMAX
value = 0.0

[BC2]
type = NEUMANN
field = PRESSURE
location = YMIN
value = 0.0

[BC3]
type = NEUMANN
field = PRESSURE
location = YMAX
value = 0.0

[BC4]
type = NEUMANN
field = PRESSURE
location = ZMIN
value = 0.0

# ==============================================================================
# OUTPUT SECTION - ECLIPSE SUMMARY style
# ==============================================================================

[SUMMARY]
# Field totals
field_vectors = FOPR, FWPR, FGPR, FOPT, FWPT, FWCT, FGOR, FPR

# Well vectors
well_vectors = WOPR, WWPR, WGPR, WOPT, WWPT, WBHP, WTHP, WWCT, WGOR

# Aquifer vectors
aquifer_vectors = AAQP, AAQR, AAQT

# Performance
performance_vectors = TIME, TIMESTEP, NEWTON

[OUTPUT]
format = HDF5
path = output/waterdrive
frequency = 10
pressure = true
saturation = true
well_data = true
aquifer_data = true
