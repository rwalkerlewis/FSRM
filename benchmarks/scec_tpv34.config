# ============================================================================
# SCEC TPV34: 2D Anti-Plane with Thermal Pressurization
# ============================================================================
# Verification of thermal pressurization implementation
# Reference: http://scec.org/cvws/download/TPV34_Description_v01.pdf
# ============================================================================

[SIMULATION]
name = SCEC_TPV34
description = "2D anti-plane shear with thermal pressurization"

start_time = 0.0
end_time = 15.0                    # 15 seconds
dt_initial = 0.0001                # Small timestep for TP diffusion
dt_min = 1e-7
dt_max = 0.001

output_frequency = 100
output_format = HDF5
output_directory = output/tpv34

# Numerical method
use_discontinuous_galerkin = true
dg_order = 4
use_ader_time_integration = true
enable_local_time_stepping = true
lts_rate = 2

# Physics
enable_elastodynamics = true
enable_dynamic_rupture = true
enable_thermal_pressurization = true  # KEY FEATURE

use_gpu = true

[GRID]
# 2D problem (very thin in y-direction)
use_unstructured = false
nx = 400                           # Need fine mesh
ny = 1
nz = 200
Lx = 24000.0                       # 24 km
Ly = 100.0                         # Thin (quasi-2D)
Lz = 12000.0                       # 12 km depth

# Or unstructured 2D mesh
# use_unstructured = true
# mesh_file = meshes/tpv34_2d.msh

[ROCK]
# Elastic properties
youngs_modulus = 32.04e9
poisson_ratio = 0.25
density = 2670.0
p_wave_velocity = 6000.0
s_wave_velocity = 3464.0

# No attenuation for TPV34
enable_attenuation = false

[FAULT1]
type = PLANAR_VERTICAL
strike = 90.0                      # E-W fault (perpendicular to y)
dip = 90.0
x_center = 0.0
y_center = 0.0
z_center = -6000.0
length = 24000.0
width = 12000.0

# Rate-and-state friction with thermal pressurization
friction_law = RATE_STATE_SLIP_WITH_TP
rs_a = 0.008                       # Direct effect
rs_b = 0.012                       # Evolution effect (VW)
rs_L = 8.0e-3                      # State evolution distance [m]
rs_f0 = 0.6                        # Reference friction
rs_V0 = 1.0e-6                     # Reference velocity [m/s]

# Initial state
rs_initial_slip_rate = 1.0e-16     # Essentially zero
rs_initial_state_variable = 1.6e13 # θ_0 = L / V_0

# Thermal pressurization parameters (from TPV34 specs)
enable_thermal_pressurization = true
tp_thermal_diffusivity = 1.0e-6    # α_th [m²/s]
tp_hydraulic_diffusivity = 1.0e-4  # α_hy [m²/s]
tp_specific_heat = 2.67e6          # ρc [J/(m³·K)]
tp_Lambda = 0.1e6                  # Λ [Pa/K]
tp_half_width_shear_zone = 1.0e-3  # w = 1 mm (very thin!)

# Initial conditions
tp_initial_temperature = 483.15    # T_0 = 210°C = 483.15 K
tp_initial_pore_pressure = 0.0     # Relative to initial (hydrostatic subtracted)

# Initial stress (depth-dependent)
initial_stress_type = DEPTH_DEPENDENT
initial_shear_stress_gradient = 7378.0    # τ = 7378 Pa/m × depth
initial_normal_stress_gradient = -13407.4 # σ_n (compression)

# Stress ratio: τ / |σ_n| = 0.55 (same as TPV5)

# Nucleation
nucleation_type = SPATIAL_PATCH
nucleation_x_center = 0.0
nucleation_z_center = -7500.0      # 7.5 km depth
nucleation_radius = 1500.0         # 1.5 km
nucleation_overstress = 1.25       # 25% overstress

use_split_nodes = true
split_node_method = PENALTY

[THERMAL_PRESSURIZATION]
# TP diffusion solver settings
tp_diffusion_solver = FINITE_DIFFERENCE_1D
tp_num_grid_points = 51            # Across fault zone
tp_grid_extent = 0.05              # 5 cm (50 mm) each side

# Time integration
tp_time_integration = IMPLICIT     # Stable for small dx
tp_max_substeps = 100              # Allow subcycling

# Output TP fields
output_tp_profiles = true
tp_profile_frequency = 100
tp_profile_locations = [0.0, -7500.0], [6000.0, -7500.0]

[BC1]
type = FREE_SURFACE
location = ZMAX

[BC2]
type = ABSORBING
location = XMIN,XMAX,YMIN,YMAX,ZMIN
absorbing_method = PML

[BC3]
# Anti-plane constraint (no displacement in y-direction)
type = DIRICHLET
field = DISPLACEMENT_Y
location = ALL
value = 0.0

[OUTPUT]
output_fault_data = true
fault_output_fields = slip,slip_rate,shear_stress,normal_stress,rupture_time,pore_pressure,temperature,friction_coefficient
fault_output_frequency = 10         # Every 10 steps

# TP-specific output
output_tp_data = true
tp_output_fields = pore_pressure,temperature,effective_normal_stress,apparent_friction
tp_output_frequency = 10

volume_output_fields = velocity,displacement,stress
volume_output_frequency = 100

enable_receivers = true
receiver_file = benchmarks/receivers_tpv34.txt

[VERIFICATION]
enable_verification = true
reference_solution_dir = benchmarks/reference/tpv34
verification_tolerance = 0.10      # 10% (TP can be sensitive)

verify_rupture_time = true
verify_slip_distribution = true
verify_tp_evolution = true
verify_weakening = true
verify_energy_balance = true

[ANALYSIS]
# TPV34-specific analysis
compute_rupture_velocity = true
analyze_tp_weakening = true
compute_apparent_friction = true
track_pressure_temperature_evolution = true

# TP effectiveness
compute_pressure_buildup = true
compute_temperature_rise = true
analyze_weakening_rate = true

# Energy partitioning
compute_frictional_heating = true
compute_thermal_energy = true
compute_mechanical_work = true

[TP_ANALYSIS]
# Expected TP behavior
expected_max_temperature_rise = 200.0    # ~200 K
expected_max_pressure_rise = 20.0e6      # ~20 MPa
expected_min_apparent_friction = 0.1     # μ_eff ~ 0.1

# Compare with and without TP
run_comparison_without_tp = false

[NOTES]
# TPV34 Key Features:
# - 2D anti-plane shear (simplifies problem)
# - Rate-and-state friction
# - Thermal pressurization
# - Very thin shear zone (1 mm)
# - Dramatic fault weakening
#
# Expected Results:
# - Initial friction μ ~ 0.6
# - TP causes dramatic weakening
# - Apparent friction drops to μ_app ~ 0.1
# - Pore pressure increases by 20+ MPa
# - Temperature increases by 200+ K
# - Fast rupture velocity (~0.9 × V_s)
# - Low stress drop
#
# Physics:
# - Frictional heating: Q = τ × V
# - Temperature diffusion: ∂T/∂t = α_th ∂²T/∂y²
# - Pressure diffusion: ∂p/∂t = α_hy ∂²p/∂y² + Λ ∂T/∂t
# - Coupling through Λ (undrained TP response)
#
# Numerical Challenges:
# - Very thin shear zone (1 mm) requires fine grid
# - Diffusion equations are stiff
# - Small time steps needed (0.0001 s)
# - Coupled nonlinear system
# - Subcycling for TP may be necessary
#
# Verification:
# - Compare temperature and pressure evolution
# - Check energy balance
# - Verify weakening magnitude
# - Compare with analytical solutions (if available)
#
# Importance:
# - TP explains low apparent friction in large earthquakes
# - Resolves "heat flow paradox"
# - Critical for realistic earthquake mechanics
