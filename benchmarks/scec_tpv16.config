# ============================================================================
# SCEC TPV16: Heterogeneous Initial Stress
# ============================================================================
# Tests spatially variable initial conditions
# Reference: http://scec.org/cvws/download/TPV16_17_Description_v4.pdf
# ============================================================================

[SIMULATION]
name = SCEC_TPV16
description = "Planar fault with heterogeneous initial stress"

start_time = 0.0
end_time = 12.0
dt_initial = 0.001
dt_min = 1e-6
dt_max = 0.01

output_frequency = 100
output_format = HDF5
output_directory = output/tpv16

# Numerical method
use_discontinuous_galerkin = true
dg_order = 4
use_ader_time_integration = true
enable_local_time_stepping = true
lts_rate = 2

enable_elastodynamics = true
enable_dynamic_rupture = true

use_gpu = true

[GRID]
use_unstructured = true
mesh_file = meshes/tpv16.msh

# Or structured
# nx = 300
# ny = 1
# nz = 150
# Lx = 48000.0                     # 48 km
# Ly = 100.0
# Lz = 20000.0                     # 20 km depth

[ROCK]
youngs_modulus = 32.04e9
poisson_ratio = 0.25
density = 2670.0
p_wave_velocity = 6000.0
s_wave_velocity = 3464.0

enable_attenuation = false

[FAULT1]
type = PLANAR_VERTICAL
strike = 0.0
dip = 90.0
x_center = 0.0
y_center = 0.0
z_center = -8660.0                 # 8.66 km (center of 17.32 km depth extent)
length = 48000.0                   # 48 km along strike
width = 17320.0                    # 17.32 km down-dip

# Linear slip-weakening friction
friction_law = LINEAR_SLIP_WEAKENING_HETEROGENEOUS
mu_s_file = benchmarks/data/tpv16_mu_s.h5
mu_d_file = benchmarks/data/tpv16_mu_d.h5
d_c = 0.40                         # Uniform d_c
cohesion = 0.0

# Heterogeneous initial stress
initial_stress_type = HETEROGENEOUS
initial_stress_file = benchmarks/data/tpv16_stress.h5

# Fields in stress file:
# - stress_xx(x, z)
# - stress_yy(x, z)
# - stress_zz(x, z)
# - stress_xy(x, z)
# - stress_xz(x, z)
# - stress_yz(x, z)

# Alternatively, specify functional form:
# initial_stress_type = FUNCTIONAL
# stress_function = tpv16_stress_pattern

# TPV16 stress pattern (from SCEC description):
# Two asperities with high stress
# Surrounding region with lower stress
# Creates complex rupture propagation

# Nucleation (small overstressed patch)
nucleation_type = SPATIAL_PATCH
nucleation_x_center = 0.0
nucleation_z_center = -7500.0
nucleation_radius = 1500.0         # Small 1.5 km patch
nucleation_overstress = 1.2

use_split_nodes = true
split_node_method = PENALTY

[HETEROGENEOUS_STRESS_PATTERN]
# TPV16 specific stress pattern
# Two asperities (high stress regions)

# Asperity 1
asperity1_center_x = -12000.0      # 12 km left of center
asperity1_center_z = -7500.0
asperity1_radius = 3000.0
asperity1_shear_stress = 81.6e6    # High stress

# Asperity 2
asperity2_center_x = 12000.0       # 12 km right of center
asperity2_center_z = -7500.0
asperity2_radius = 3000.0
asperity2_shear_stress = 81.6e6

# Background
background_shear_stress = 70.0e6   # Lower stress
background_normal_stress = -120.0e6

# Smooth transitions
transition_type = GAUSSIAN
transition_width = 1000.0          # 1 km transition zones

[HETEROGENEOUS_FRICTION]
# TPV16 friction heterogeneity

# High friction barrier between asperities
barrier_center_x = 0.0
barrier_center_z = -7500.0
barrier_width_x = 4000.0           # 4 km wide barrier
barrier_mu_s = 0.7                 # Higher friction

# Background friction
background_mu_s = 0.677
background_mu_d = 0.525

[BC1]
type = FREE_SURFACE
location = ZMAX

[BC2]
type = ABSORBING
location = XMIN,XMAX,YMIN,YMAX,ZMIN
absorbing_method = PML

[OUTPUT]
output_fault_data = true
fault_output_fields = slip,slip_rate,shear_stress,normal_stress,rupture_time,friction_coefficient
fault_output_frequency = 1

volume_output_fields = velocity,displacement,stress
volume_output_frequency = 100

enable_receivers = true
receiver_file = benchmarks/receivers_tpv16.txt

[VERIFICATION]
enable_verification = true
reference_solution_dir = benchmarks/reference/tpv16
verification_tolerance = 0.05

verify_rupture_time = true
verify_slip_distribution = true
verify_complex_propagation = true

[ANALYSIS]
# TPV16-specific analysis
compute_rupture_velocity = true
analyze_asperity_interaction = true
track_rupture_path = true
compute_stress_heterogeneity_effects = true

# Measure specific features
detect_rupture_jumps = true
measure_barrier_breakthrough = true
analyze_directivity_variations = true

[NOTES]
# TPV16 Key Features:
# - Heterogeneous initial stress (two asperities)
# - High stress barriers
# - Complex rupture propagation
# - Rupture may jump barriers
# - Non-uniform rupture velocity
#
# Expected Results:
# - Rupture nucleates in first asperity
# - Propagates outward
# - May stop at barrier (low stress)
# - May jump to second asperity
# - Complex slip distribution
# - Variable rupture velocity (0.5-0.9 Ã— V_s)
#
# Challenges:
# - Requires fine spatial resolution
# - Accurate stress interpolation
# - Sensitive to numerical diffusion
# - Multiple rupture fronts
#
# Comparison with TPV5:
# - TPV5: Homogeneous stress
# - TPV16: Heterogeneous stress
# - TPV16 more realistic (real faults have heterogeneity)
# - TPV16 tests code's ability to handle complexity
