# ============================================================================
# SCEC TPV10: 60° Dipping Normal Fault
# ============================================================================
# Benchmark for non-planar fault geometry
# Reference: http://scec.org/cvws/download/TPV10_11_Description_v7.pdf
# ============================================================================

[SIMULATION]
name = SCEC_TPV10
description = "60-degree dipping normal fault with slip-weakening friction"

# Time control
start_time = 0.0
end_time = 12.0                    # seconds
dt_initial = 0.001
dt_min = 1e-6
dt_max = 0.01

# Output
output_frequency = 100
output_format = HDF5
output_directory = output/tpv10

# Numerical method
use_discontinuous_galerkin = true
dg_order = 4                       # O4 for accuracy
dg_basis_type = NODAL
dg_flux_method = RUSANOV

use_ader_time_integration = true
ader_order = 4

enable_local_time_stepping = true
lts_rate = 2

# Physics
enable_elastodynamics = true
enable_dynamic_rupture = true

# GPU
use_gpu = true
gpu_mode = GPU_ONLY

[GRID]
# Need refined mesh near fault
use_unstructured = true
mesh_file = meshes/tpv10_dipping.msh

# Or structured with refinement
# nx = 300
# ny = 200
# nz = 150
# Lx = 36000.0
# Ly = 24000.0
# Lz = 24000.0

[ROCK]
# Homogeneous elastic halfspace
youngs_modulus = 32.04e9           # Pa
poisson_ratio = 0.25
density = 2670.0                   # kg/m³

# Derived properties
p_wave_velocity = 6000.0           # m/s
s_wave_velocity = 3464.0           # m/s

# Attenuation (optional)
enable_attenuation = false

# Damping for numerical stability
damping_alpha = 0.0
damping_beta = 0.0

[FAULT1]
# 60° dipping fault in xz-plane
type = PLANAR_DIPPING
strike = 0.0                       # N-S fault
dip = 60.0                         # 60° dip to the East
x_center = 0.0
y_center = 0.0
z_center = -9000.0                 # 9 km depth (center of fault)
length = 30000.0                   # 30 km along strike
width = 15000.0                    # 15 km down-dip

# Linear slip-weakening friction
friction_law = LINEAR_SLIP_WEAKENING
mu_s = 0.677                       # Static friction
mu_d = 0.525                       # Dynamic friction
d_c = 0.40                         # Critical slip distance [m]
cohesion = 0.0

# Initial stress - ROTATED from global coordinates
# TPV10 specifies stress in fault coordinates, must rotate to global
#
# In fault coordinates (downdip distance d):
#   σ_n = -7378 Pa/m × d  (normal stress, negative = compression)
#   τ = 0.55 × |σ_n|      (shear stress)
#
# Rotating to global coordinates (see SCEC description):
initial_stress_type = DEPTH_DEPENDENT
stress_rotation_angle = 30.0       # Rotate 30° clockwise around x-axis

# Stress components in global coordinates
# (computed from rotation - see preprocessing/science/stressrotation3D)
initial_stress_xx = 0.0
initial_stress_yy_gradient = -2019.26    # Pa/m (depth gradient)
initial_stress_zz_gradient = -5358.74    # Pa/m
initial_stress_yz_gradient = 5223.72     # Pa/m (shear)
initial_stress_xy = 0.0
initial_stress_xz = 0.0

# Nucleation patch (circular, centered on fault)
nucleation_type = SPATIAL_PATCH
nucleation_x_center = 0.0
nucleation_y_center = 0.0
nucleation_z_center = -9000.0      # Center of fault
nucleation_radius = 3000.0         # 3 km radius
nucleation_overstress = 1.4        # 40% overstress in nucleation

# Forced rupture time (optional - smooths nucleation)
use_forced_rupture_time = false

# Split-node method
use_split_nodes = true
split_node_method = PENALTY
penalty_normal = 1e12
penalty_tangent = 1e10

[BC1]
# Free surface at z=0
type = FREE_SURFACE
location = ZMAX

[BC2]
# Absorbing boundaries on all other sides
type = ABSORBING
location = XMIN,XMAX,YMIN,YMIN,ZMIN
absorbing_method = PML
pml_width = 1000.0
pml_strength = 1000.0

[OUTPUT]
# Fault output
output_fault_data = true
fault_output_fields = slip,slip_rate,shear_stress,normal_stress,rupture_time
fault_output_frequency = 1         # Every timestep

# Volume output (sparse)
volume_output_fields = velocity,displacement
volume_output_frequency = 100

# On-fault receivers (detailed time series)
enable_fault_receivers = true
fault_receiver_spacing = 1000.0    # Every 1 km

# Off-fault receivers (from SCEC benchmark)
enable_receivers = true
receiver_file = benchmarks/receivers_tpv10.txt

[VERIFICATION]
enable_verification = true
reference_solution_dir = benchmarks/reference/tpv10
verification_fields = slip,slip_rate,rupture_time
verification_tolerance = 0.05      # 5%

# Compare specific stations
compare_stations = true
station_list = faultst000dp000,faultst000dp015,body045,body090

# Key metrics to check
verify_rupture_time = true
verify_slip_distribution = true
verify_peak_slip_rate = true
verify_energy_balance = true

[ANALYSIS]
# TPV10-specific analysis
compute_rupture_velocity = true
compute_slip_distribution = true
compute_stress_drop = true

# Check asymmetry due to dip
analyze_hanging_wall_footwall = true
compute_directivity_effect = true

[NOTES]
# TPV10 Key Features:
# - 60° dipping fault (tests non-planar geometry)
# - Asymmetric rupture due to dip
# - Free surface interaction
# - Stress rotation required
#
# Expected Results:
# - Bilateral rupture propagation
# - Faster rupture updip (toward free surface)
# - Slower rupture downdip
# - Rupture reaches surface at ~4-5 seconds
# - Peak slip rate ~1.8 m/s
# - Final slip 2-3 m near hypocenter
#
# Comparison with TPV5:
# - Same friction parameters
# - Different geometry (dipping vs vertical)
# - More complex rupture pattern
