# ===============================================================================
# FSRM Infrasound Modeling Example
# ===============================================================================
# This example demonstrates infrasound propagation from an explosion source
# with atmospheric stratification, wind effects, and topographic interactions.
#
# Application: Nuclear test monitoring (CTBT/IMS-style), volcanic monitoring,
# or industrial accident detection.
#
# All internal calculations use SI base units (m, kg, s).
# Input values can be specified in any supported unit (conversion automatic).
# Output units can be configured separately.
# ===============================================================================

[GENERAL]
title = Infrasound Propagation Example
description = Atmospheric infrasound from surface explosion with terrain effects

[UNITS]
# Input/output unit preferences
# All calculations performed in SI base units internally
input_system = SI
output_system = SI

# Per-quantity output units (optional overrides)
pressure_unit = Pa
distance_unit = km
time_unit = s
frequency_unit = Hz
velocity_unit = m/s
temperature_unit = degC

[SIMULATION]
# Time parameters (values in SI or with units)
start_time = 0.0 s
end_time = 600.0 s
dt_initial = 0.1 s
dt_min = 0.001 s
dt_max = 1.0 s

# Solver settings
max_timesteps = 10000
rtol = 1e-6
atol = 1e-8

# Physics enables
enable_infrasound = true
enable_atmospheric_blast = true
enable_surface_deformation = false

# Dynamic mode for wave propagation
use_dynamic_mode = true

[GPU]
use_gpu = false
gpu_mode = CPU_FALLBACK
gpu_device_id = 0

[GRID]
# Computational domain
# Using cylindrical coordinates centered on source
type = CYLINDRICAL_2D  # (r, z) axisymmetric

# Radial extent
r_min = 0.0 m
r_max = 500 km

# Vertical extent (altitude above sea level)
z_min = 0.0 m
z_max = 120 km

# Resolution
nr = 2000
nz = 600

# Mesh refinement near ground
refine_near_ground = true
refinement_height = 5 km
refinement_factor = 2

[SOURCE]
# =========================================================================
# Infrasound Source Configuration
# =========================================================================
type = EXPLOSION                    # EXPLOSION, VOLCANIC, BOLIDE, EARTHQUAKE

# Source location (UTM or local coordinates)
x = 0.0 m                           # X coordinate
y = 0.0 m                           # Y coordinate
z = 0.0 m                           # Altitude above sea level

# Explosion parameters
yield = 1.0 kt                      # Equivalent TNT yield (kilotons)
# Alternative: specify peak overpressure directly
# peak_overpressure = 1e6 Pa

# Source timing
onset_time = 0.0 s

# Frequency content
dominant_frequency = 1.0 Hz         # Dominant infrasound frequency
source_duration = 2.0 s             # Characteristic duration

[ATMOSPHERE]
# =========================================================================
# Atmospheric Model Configuration
# =========================================================================
model = US_STANDARD_1976            # Standard atmosphere model
# Options: US_STANDARD_1976, ICAO_STANDARD, TROPICAL, 
#          MIDLATITUDE_SUMMER, MIDLATITUDE_WINTER,
#          SUBARCTIC_SUMMER, SUBARCTIC_WINTER, CUSTOM

# Custom profile (if model = CUSTOM)
# profile_file = atmospheric_profile.txt

# Ground conditions (can override standard values)
ground_temperature = 288.15 K       # 15°C
ground_pressure = 101325 Pa         # 1 atm
ground_humidity = 0.5               # 50% relative humidity

[WIND]
# =========================================================================
# Wind Profile
# =========================================================================
model = PROFILE                     # NONE, UNIFORM, PROFILE, CUSTOM

# Uniform wind (if model = UNIFORM)
wind_east = 0.0 m/s
wind_north = 0.0 m/s

# Wind profile by altitude (if model = PROFILE)
# Format: altitude(m), east_wind(m/s), north_wind(m/s)
wind_profile = """
0      2.0   1.0
1000   5.0   2.0
5000  15.0   5.0
10000 30.0  10.0
20000 50.0  15.0
50000 30.0   5.0
80000 10.0   0.0
"""

# Or load from file
# wind_profile_file = wind_profile.txt

[TOPOGRAPHY]
# =========================================================================
# Terrain Model
# =========================================================================
model = FLAT                        # FLAT, ANALYTICAL, FILE

# Flat terrain elevation
elevation = 0.0 m

# Analytical terrain (if model = ANALYTICAL)
# function = GAUSSIAN_MOUNTAIN
# peak_height = 2000 m
# peak_x = 100 km
# peak_y = 0.0 m
# width = 20 km

# From file (if model = FILE)
# terrain_file = terrain.tif         # GeoTIFF, NetCDF, or ASCII grid
# terrain_format = GEOTIFF

# Terrain acoustic properties
ground_impedance = 1000 Pa-s/m      # Effective impedance for reflection

[ATTENUATION]
# =========================================================================
# Atmospheric Absorption
# =========================================================================
enable = true
model = STANDARD                    # STANDARD, BASS_1972, SUTHERLAND_1975

# Include molecular relaxation
include_molecular = true

# Include classical absorption
include_classical = true

# Include humidity effects
include_humidity = true

[PROPAGATION]
# =========================================================================
# Propagation Method
# =========================================================================
method = PE                         # RAY, PE (Parabolic Equation), FD

# Ray tracing settings (if method = RAY)
ray_max_bounces = 5
ray_angle_resolution = 0.5 deg
ray_max_range = 1000 km

# Parabolic equation settings (if method = PE)
pe_vertical_step = 50 m
pe_range_step = 500 m
pe_absorbing_layer_thickness = 20 km

# Wide-angle correction
pe_wide_angle = true

[RECEIVERS]
# =========================================================================
# Infrasound Receiver Array
# =========================================================================
# Define receiver locations for waveform output

# Single receiver
# rx = 200 km
# ry = 0.0 m
# rz = 0.0 m

# Array of receivers along radial line
array_type = RADIAL
num_receivers = 20
range_min = 50 km
range_max = 500 km
azimuth = 0.0 deg                   # East direction
receiver_height = 1.0 m             # Height above ground

# Alternative: custom receiver locations
# receiver_file = receivers.txt

[ANALYSIS]
# =========================================================================
# Post-processing Analysis
# =========================================================================
# Compute transmission loss
compute_transmission_loss = true
tl_frequencies = 0.1, 0.5, 1.0, 2.0, 5.0 Hz
tl_reference_distance = 1 km

# Compute travel time
compute_travel_time = true

# Compute eigenrays to receivers
compute_eigenrays = true

# Spectrum analysis
compute_spectrum = true
spectrum_fmin = 0.01 Hz
spectrum_fmax = 20 Hz
spectrum_nf = 200

[OUTPUT]
# =========================================================================
# Output Configuration
# =========================================================================
format = HDF5                       # VTK, HDF5, NETCDF
prefix = infrasound_example

# Output frequency
output_frequency = 10

# Field outputs
output_pressure = true
output_velocity = true
output_transmission_loss = true

# Receiver waveforms
output_waveforms = true
waveform_format = ASCII             # ASCII, HDF5

# Snapshots
output_snapshots = true
snapshot_times = 60, 120, 180, 240, 300 s

# Output units for display
output_pressure_unit = Pa
output_distance_unit = km
output_time_unit = s

[DIAGNOSTICS]
# =========================================================================
# Diagnostic Output
# =========================================================================
verbose = true
log_level = INFO

# Ray path visualization
output_rays = true
ray_output_file = ray_paths.vtk

# Sound speed profile
output_sound_speed_profile = true

# Energy conservation check
check_energy = true

# ===============================================================================
# Notes on Physical Interpretation
# ===============================================================================
#
# 1. INFRASOUND CHARACTERISTICS:
#    - Frequency range: 0.01 - 20 Hz
#    - Wavelengths: ~17 m to ~34 km
#    - Can propagate thousands of km in atmospheric waveguides
#
# 2. ATMOSPHERIC DUCTING:
#    - Stratospheric duct (~50 km altitude)
#    - Thermospheric duct (~100 km altitude)
#    - Wind-assisted ducts (effective sound speed variations)
#
# 3. YIELD SCALING (Explosions):
#    - Dominant period T ∝ W^(1/3)  where W = yield
#    - Peak overpressure P ∝ W^(1/3) / R  where R = distance
#    - 1 kt explosion: ~1 Hz dominant, detectable at 1000+ km
#
# 4. TRANSMISSION LOSS:
#    - Geometric spreading: 10 log(R) for cylindrical
#    - Atmospheric absorption: significant above 10 Hz
#    - Ducting can reduce losses at long range
#
# 5. UNITS:
#    - All internal calculations in SI (m, kg, s)
#    - User specifies input/output units freely
#    - Automatic conversion handled by UnitSystem
#
# ===============================================================================
