# ==============================================================================
# Surface Burst (Fallout-dominant) - 50 kt
# ==============================================================================
# Purpose:
# - Example of a low-altitude/surface burst designed to highlight:
#   - crater ejecta contribution to fallout
#   - debris entrainment + deposition mapping
#   - combined blast/thermal/radiation outputs in a smaller, quicker run
#
# Notes:
# - This is intentionally smaller than `atmospheric_nuclear_test.config` but keeps
#   the same section naming so it's easy to compare.
# ==============================================================================

[SIMULATION]
name = atmospheric_nuclear_surface_fallout_50kt
description = 50 kt surface burst emphasizing fallout formation and deposition

start_time = 0.0
end_time = 600.0

dt_initial = 5.0e-9
dt_min = 1.0e-11
dt_max = 0.2

adaptive_dt = true
phase_adaptive = true
phase1_end = 1.0e-3
phase1_dt_max = 1.0e-7
phase2_end = 0.1
phase2_dt_max = 5.0e-5
phase3_end = 10.0
phase3_dt_max = 0.02

output_frequency = 200
output_format = HDF5
enable_checkpointing = true
checkpoint_frequency = 10000

fluid_model = COMPRESSIBLE_NS
solid_model = ELASTODYNAMIC

enable_atmosphere = true
enable_geomechanics = true
enable_elastodynamics = true
enable_thermal = true
enable_radiation = true

# EMP/ionosphere are optional for this case; keep them off to reduce complexity
enable_electromagnetic = false
enable_ionization = false

coupling_mode = FULLY_COUPLED
atmosphere_ground_coupling = true
radiation_thermal_coupling = true

use_gpu = true
gpu_mode = AUTO

# ==============================================================================
# Device
# ==============================================================================
[NUCLEAR_DEVICE]
type = NUCLEAR_FISSION
yield_kt = 50.0
fission_fraction = 1.0

# Surface burst (HOB ~ 0)
burst_height = 0.0
location_x = 60000.0
location_y = 60000.0
location_z = 0.0

# ==============================================================================
# Fireball / Thermal
# ==============================================================================
[FIREBALL]
model = BRODE
thermal_fraction = 0.35
thermal_pulse_duration = 1.5
enable_double_flash = false

# ==============================================================================
# Atmosphere
# ==============================================================================
[ATMOSPHERE]
model = EXTENDED
base_profile = US_STANDARD_1976
ground_level = 0.0
top_of_domain = 30000.0
num_layers = 40
layer_type = EXPONENTIAL

[ATMOSPHERE.WIND]
enable_wind = true
wind_profile_type = POWER_LAW
surface_wind_speed = 8.0
wind_direction = 260.0
reference_height = 10.0
surface_roughness = 0.05
wind_shear_exponent = 0.18
enable_jet_stream = false

[ATMOSPHERE.HUMIDITY]
relative_humidity = 0.30
enable_humidity_profile = false

# ==============================================================================
# Blast Wave (surface burst reflection / mach stem)
# ==============================================================================
[BLAST_WAVE]
model = SEDOV_TAYLOR
enable_ground_reflection = true
ground_reflection_factor = 2.0
include_negative_phase = true

# ==============================================================================
# Radiation Transport (keep key pieces; reduce MC particles)
# ==============================================================================
[RADIATION_TRANSPORT]
enabled = true
method = MONTE_CARLO
num_particles = 1500000

[RADIATION_TRANSPORT.PROMPT]
enabled = true
gamma_yield_fraction = 0.007
neutron_yield_fraction = 0.002
xray_yield_fraction = 0.70
xray_absorption_altitude = 8000.0

[RADIATION_TRANSPORT.FISSION_PRODUCTS]
enabled = true
fissile_type = U235
include_decay_chains = true
activity_model = WAY_WIGNER

[RADIATION_TRANSPORT.FALLOUT]
enabled = true
model = FALLOUT_FORMATION_MODEL

# Surface burst: crater ejecta dominates the debris/fallout mass
include_crater_ejecta = true
include_fireball_condensate = true
include_stem_entrainment = true

particle_model = LOGNORMAL
median_particle_size = 150.0
geometric_std_dev = 2.6

num_size_classes = 16
min_diameter = 0.5
max_diameter = 2000.0

soil_density = 2600.0
soil_melt_temperature = 1400.0
soil_vaporization_temp = 3000.0

[RADIATION_TRANSPORT.DISPERSAL]
enabled = true
model = RADIOACTIVE_DISPERSAL_MODEL
transport_method = LAGRANGIAN
num_particles = 80000
dispersion_scheme = PASQUILL_GIFFORD
pasquill_stability = D
wind_field = ATMOSPHERE

[RADIATION_TRANSPORT.DISPERSAL.DEPOSITION]
gravitational_settling = true
dry_deposition = true
size_dependent_vd = true
wet_deposition = false

[RADIATION_TRANSPORT.DOSE]
enabled = true
compute_prompt_dose = true
compute_cloud_shine = true
compute_ground_shine = true
compute_inhalation = true
output_contamination_map = true

# ==============================================================================
# Ground Material (soft soil / alluvium)
# ==============================================================================
[ROCK]
name = ALLUVIUM
constitutive_model = ELASTOPLASTIC_MC

youngs_modulus = 700.0e6
poisson_ratio = 0.35
density = 1800.0

p_wave_velocity = 600.0
s_wave_velocity = 300.0

failure_criterion = MOHR_COULOMB
cohesion = 80.0e3
friction_angle = 30.0
tensile_strength = 15.0e3

enable_crater_formation = true
excavation_model = HOLSAPPLE

[GROUND_COUPLING]
coupling_type = IMPEDANCE_MATCHING
surface_reflection = true
air_blast_ground_coupling = true
coupling_factor = 0.02

crater_model = NORDYKE
scaled_depth = 0.0
apparent_crater_depth = 20.0
apparent_crater_radius = 120.0

# ==============================================================================
# Grid
# ==============================================================================
[GRID]
nx = 320
ny = 320
nz = 180

Lx = 120000.0
Ly = 120000.0
Lz = 80000.0

origin_x = 0.0
origin_y = 0.0
origin_z = -20000.0

use_multidomain = true

[GRID.GROUND]
z_min = -20000.0
z_max = 0.0
nz = 40
material = SOLID

[GRID.ATMOSPHERE]
z_min = 0.0
z_max = 60000.0
nz = 140
material = GAS

[amr]
enabled = true
method = plex_refine

[amr.criterion]
type = combined
weight_shock = 1.0
weight_temperature = 0.5
weight_radiation = 0.5

[amr.limits]
max_refinement_level = 4
max_cells = 12000000
min_cell_size = 10.0

[amr.features.ground_zero]
x = 60000.0
y = 60000.0
z = 0.0
radius = 8000.0
level = 4

# ==============================================================================
# Receivers
# ==============================================================================
[RECEIVERS]
output_format = HDF5
sampling_rate = 500.0

[RECEIVER_ARRAY_PRESSURE]
type = LINE
start = 60000.0, 60000.0, 2.0
end = 120000.0, 60000.0, 2.0
num_stations = 40
fields = pressure, overpressure, temperature, velocity

[RECEIVER_ARRAY_RADIATION]
type = GRID
x_range = 50000.0, 90000.0
y_range = 50000.0, 90000.0
z = 1.0
nx = 10
ny = 10
fields = gamma_dose_rate, total_dose, contamination

# ==============================================================================
# Output
# ==============================================================================
[OUTPUT]
format = HDF5
path = output/atmospheric_surface_fallout_50kt

save_pressure = true
save_temperature = true
save_density = true
save_velocity = true

save_displacement = true
save_stress = true

save_dose_rate = true
save_accumulated_dose = true
save_contamination = true

volume_output_frequency = 1000
surface_output_frequency = 200

save_overpressure_contours = true
overpressure_levels = 0.01, 0.03, 0.07, 0.14, 0.35, 0.7, 1.4

[ANALYSIS]
compute_blast_damage = true
compute_thermal_damage = true
compute_radiation_effects = true
compute_fallout_pattern = true
output_damage_map = true

