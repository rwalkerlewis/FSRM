# ==============================================================================
# Atmospheric Nuclear Test with Coupled Physics
# ==============================================================================
# Comprehensive simulation of an atmospheric nuclear detonation including:
# - Fireball and thermal radiation
# - Atmospheric shock wave propagation  
# - Ground coupling and seismic wave generation
# - Radiation transport (gamma, neutron, fallout)
# - Electromagnetic Pulse (EMP) generation
# - Atmospheric structure and ionization
#
# Based on physics of atmospheric tests (e.g., Castle Bravo, Tsar Bomba scale)
# ==============================================================================

[SIMULATION]
name = atmospheric_nuclear_test
description = Surface/low-altitude nuclear detonation with full coupled physics

# Time parameters
# Phase 1: 0-1 ms - Initial radiation and fireball
# Phase 2: 1-100 ms - Shock formation and EMP
# Phase 3: 0.1-10 s - Blast wave propagation
# Phase 4: 10-300 s - Ground motion and atmospheric effects
start_time = 0.0
end_time = 300.0                     # 5 minutes for full waveform
dt_initial = 1.0e-9                  # 1 nanosecond for EMP resolution
dt_min = 1.0e-12                     # Picoseconds for gamma flash
dt_max = 0.1                         # Maximum after initial phases

# Multi-phase adaptive timestepping
adaptive_dt = true
phase_adaptive = true
phase1_end = 1.0e-3
phase1_dt_max = 1.0e-7
phase2_end = 0.1
phase2_dt_max = 1.0e-5
phase3_end = 10.0
phase3_dt_max = 0.01

# Output
output_frequency = 100
output_format = HDF5
enable_checkpointing = true
checkpoint_frequency = 5000

# Physics models - Multi-domain coupling
fluid_model = COMPRESSIBLE_NS        # Compressible Navier-Stokes for atmosphere
solid_model = ELASTODYNAMIC          # Ground response

# Enable physics modules
enable_geomechanics = true
enable_elastodynamics = true
enable_thermal = true
enable_radiation = true              # Radiation transport
enable_electromagnetic = true        # EMP physics
enable_atmosphere = true             # Atmospheric modeling
enable_ionization = true             # Ionospheric effects

# Multi-physics coupling
coupling_mode = FULLY_COUPLED
atmosphere_ground_coupling = true
radiation_thermal_coupling = true
emp_ionization_coupling = true

# Numerical methods
use_discontinuous_galerkin = true
dg_order = 4
use_ader_time_integration = true
enable_local_time_stepping = true

# Solvers
rtol = 1.0e-6
atol = 1.0e-10

# GPU required for this scale
use_gpu = true
gpu_mode = GPU_ONLY

# ==============================================================================
# Nuclear Device Parameters
# ==============================================================================
[NUCLEAR_DEVICE]
type = THERMONUCLEAR
yield_kt = 500.0                     # 500 kilotons
fission_fraction = 0.50              # 50% fission, 50% fusion

# Burst geometry
burst_height = 500.0                 # 500 m height of burst (meters AGL)
location_x = 50000.0                 # Center of domain
location_y = 50000.0
location_z = 500.0                   # Height above ground

# Device characteristics
casing_mass = 5000.0                 # kg
efficiency = 0.25                    # 25% efficiency

# ==============================================================================
# Fireball and Thermal Source
# ==============================================================================
[FIREBALL]
model = BRODE                        # Brode fireball model

# Fireball parameters (empirical scaling)
# Maximum radius: R_max ≈ 66 * W^0.4 meters (W in kt)
# For 500 kt: ~550 m radius
max_radius = 550.0                   # meters
formation_time = 0.001               # 1 ms to max radius

# Temperature evolution
initial_temperature = 1.0e8          # 100 million K (X-ray domain)
peak_surface_temperature = 8000.0    # K at maximum size
cooling_time = 10.0                  # seconds to cool

# Thermal radiation pulse
thermal_pulse_duration = 2.5         # seconds
thermal_fraction = 0.35              # 35% of yield as thermal

# Optical properties
emissivity = 0.95
thermal_radiation_model = PLANCK_GRAY

# Second maximum (for high-yield devices)
enable_double_flash = true
first_minimum_time = 0.01            # seconds
second_maximum_time = 0.5

# ==============================================================================
# Extended Atmospheric Model (AtmosphericExplosion.hpp)
# ==============================================================================
[ATMOSPHERE]
model = EXTENDED                     # Use ExtendedAtmosphericModel
base_profile = US_STANDARD_1976      # Base atmosphere profile

# Domain extends from ground to upper atmosphere
ground_level = 0.0
top_of_domain = 100000.0             # 100 km (includes ionosphere)

# Layer structure
num_layers = 50
layer_type = EXPONENTIAL             # Exponential density decrease

# Standard atmosphere parameters at sea level
sea_level_pressure = 101325.0        # Pa
sea_level_temperature = 288.15       # K (15°C)
sea_level_density = 1.225            # kg/m³

# Lapse rates (standard atmosphere)
troposphere_lapse_rate = -0.0065     # K/m
stratosphere_lapse_rate = 0.001      # K/m
tropopause_height = 11000.0          # m
stratopause_height = 50000.0         # m

# Composition
mean_molecular_weight = 28.97        # g/mol
gamma = 1.4                          # Ratio of specific heats
gas_constant = 287.05                # J/kg·K

# Extended wind profile
[ATMOSPHERE.WIND]
enable_wind = true
wind_profile_type = LOGARITHMIC      # LOG, POWER_LAW, CUSTOM, or JET_STREAM
surface_wind_speed = 5.0             # m/s at reference height
wind_direction = 270.0               # degrees (from west)
reference_height = 10.0              # m for wind profile
surface_roughness = 0.03             # m (terrain roughness length)
wind_shear_exponent = 0.14           # for power law profile

# Jet stream (if enabled)
enable_jet_stream = true
jet_stream_height = 10000.0          # m
jet_stream_speed = 50.0              # m/s
jet_stream_width = 3000.0            # m

# Humidity and clouds
[ATMOSPHERE.HUMIDITY]
relative_humidity = 0.50
enable_humidity_profile = true
surface_humidity = 0.70
humidity_scale_height = 2500.0       # m

# Cloud layer
cloud_layer = false
cloud_base = 2000.0                  # m
cloud_top = 4000.0                   # m
cloud_liquid_water = 0.5             # g/m³

# Extended atmospheric physics
[ATMOSPHERE.TURBULENCE]
enable_turbulence_model = true
turbulence_model = SMAGORINSKY       # Subgrid-scale turbulence
smagorinsky_constant = 0.17
turbulent_prandtl = 0.85
compute_brunt_vaisala = true         # Atmospheric stability
compute_richardson_number = true     # Turbulence criterion

# Stability parameters
pasquill_stability_class = D         # D = neutral stability
mixing_layer_height = 1500.0         # m (daytime convective)

# ==============================================================================
# Mushroom Cloud Dynamics (AtmosphericExplosion.hpp)
# ==============================================================================
[MUSHROOM_CLOUD]
enabled = true
model = FULL_DYNAMICS                # Use MushroomCloudModel

# Fireball-to-cloud transition
fireball_rise_model = BUOYANT_THERMAL
entrainment_model = MORTON_TAYLOR_TURNER
entrainment_coefficient = 0.12       # Morton-Taylor-Turner constant

# Cloud evolution phases
enable_fireball_phase = true
enable_rise_phase = true
enable_cap_formation = true
enable_stem_development = true
enable_stabilization = true

# Toroidal vortex (mushroom cap)
vortex_model = TOROIDAL
compute_vortex_strength = true
initial_circulation = 50000.0        # m²/s

# Stem entrainment
stem_entrainment_rate = 0.08
dust_loading_factor = 0.15           # Fraction of stem mass as dust
afterwinds_velocity = 30.0           # m/s at surface

# Cloud stabilization
stabilization_height = 15000.0       # m (top of cloud)
cloud_base_height = 8000.0           # m (bottom of cap)
stabilization_time = 300.0           # s

# ==============================================================================
# Hydrodynamic Instabilities (AtmosphericExplosion.hpp)
# ==============================================================================
[INSTABILITIES]
enabled = true

# Rayleigh-Taylor Instability (buoyancy-driven)
[INSTABILITIES.RAYLEIGH_TAYLOR]
enabled = true
compute_growth_rate = true
initial_perturbation = 0.01          # Initial amplitude fraction
wavelength_spectrum = BROADBAND      # SINGLE, BROADBAND, or CUSTOM
dominant_wavelength = 100.0          # m for single mode

# Atwood number calculation (density contrast)
compute_atwood_number = true
use_compressible_correction = true   # Accounts for shock compression

# Nonlinear evolution
bubble_penetration_model = DIMONTE
spike_penetration_model = DIMONTE
mixing_model = YOUNGS                # Youngs turbulent mixing

# Richtmyer-Meshkov Instability (shock-driven)
[INSTABILITIES.RICHTMYER_MESHKOV]
enabled = true
shock_mach_number = auto             # Computed from blast wave
post_shock_growth = true
impulsive_model = RICHTMYER          # Classic RM theory
late_time_model = SADOT              # Sadot et al. nonlinear

# Kelvin-Helmholtz Instability (shear-driven)
[INSTABILITIES.KELVIN_HELMHOLTZ]
enabled = true
compute_at_interfaces = true
interfaces = fireball_air, stem_air, cap_stratosphere
critical_richardson = 0.25           # Onset criterion
growth_rate_model = LINEAR           # LINEAR or NONLINEAR
include_viscous_effects = true
include_compressibility = true

# Vortex sheet rollup
vortex_sheet_model = KRASNY          # Desingularized vortex sheet
delta_smoothing = 0.1                # Regularization parameter

# ==============================================================================
# Buoyant Plume Model (AtmosphericExplosion.hpp)
# ==============================================================================
[BUOYANT_PLUME]
enabled = true
model = MORTON_TAYLOR_TURNER

# Source parameters
source_radius = 550.0                # m (fireball radius)
source_temperature = 8000.0          # K
source_buoyancy_flux = auto          # Computed from yield

# Entrainment
entrainment_model = TOP_HAT          # TOP_HAT or GAUSSIAN
entrainment_coefficient = 0.12
stratification_effect = true         # Reduced entrainment in stable stratification

# Plume physics
include_moisture = true
latent_heat_release = true           # Condensation effects
include_radiation_cooling = true

# ==============================================================================
# Atmospheric Shock Wave
# ==============================================================================
[BLAST_WAVE]
model = SEDOV_TAYLOR                 # Self-similar blast wave

# Initial conditions
initial_overpressure = 1.0e12        # Pa (at fireball surface)
shock_velocity = 30000.0             # m/s initial

# Shock physics
equation_of_state = IDEAL_GAS
gamma_effective = 1.4
include_real_gas_effects = true
high_temperature_dissociation = true

# Ground reflection (Mach stem formation)
enable_ground_reflection = true
ground_reflection_factor = 1.8       # Pressure enhancement

# Positive phase parameters
positive_phase_duration_scaling = GLASSTONE_DOLAN

# Negative phase
include_negative_phase = true

# Precursor effects
enable_thermal_precursor = true
precursor_type = THERMAL_LAYER

# Dust and debris
enable_debris_loading = true
debris_mass_fraction = 0.1

# ==============================================================================
# Radiation Transport (RadiationPhysics.hpp)
# ==============================================================================
[RADIATION_TRANSPORT]
enabled = true
method = MONTE_CARLO                 # Monte Carlo transport
num_particles = 10000000             # 10 million particles

# Prompt radiation (gamma and neutron)
[RADIATION_TRANSPORT.PROMPT]
enabled = true
model = PROMPT_RADIATION_MODEL       # Use PromptRadiationModel

# Gamma rays
gamma_yield_fraction = 0.005         # 0.5% of yield as prompt gamma
gamma_spectrum = FISSION_SPECTRUM
mean_gamma_energy = 1.0              # MeV
gamma_attenuation_model = EXPONENTIAL

# Detailed gamma transport
include_compton_scattering = true
include_pair_production = true
include_photoelectric = true
buildup_factor_model = TAYLOR        # TAYLOR or GEOMETRIC

# Neutrons  
neutron_yield_fraction = 0.003
neutron_spectrum = FISSION_WATT      # Watt fission spectrum
watt_parameter_a = 0.988             # MeV
watt_parameter_b = 2.249             # MeV^-1
mean_neutron_energy = 2.0            # MeV
include_neutron_scattering = true
include_neutron_capture = true
include_neutron_thermalization = true

# Fusion enhancement (for thermonuclear devices)
fusion_neutron_enhancement = 1.5     # Additional 14 MeV neutrons

# X-rays (absorbed in atmosphere, creates fireball)
xray_yield_fraction = 0.75           # Most energy initially as X-rays
xray_absorption_altitude = 10000.0   # Absorbed below ~10 km

# ==============================================================================
# Fission Product Inventory (RadiationPhysics.hpp)
# ==============================================================================
[RADIATION_TRANSPORT.FISSION_PRODUCTS]
enabled = true
model = FISSION_PRODUCT_INVENTORY    # Use FissionProductInventory

# Fissile material
fissile_type = U235                  # U235, Pu239, or MIXED
fission_yield_thermal = true         # Use thermal fission yields

# Radionuclide database
database = DEFAULT                   # DEFAULT or CUSTOM
custom_database_file = none

# Key isotopes to track (always tracked regardless of cutoff)
tracked_isotopes = I-131, I-132, I-133, I-135, Cs-137, Sr-90, Y-90, Zr-95, Nb-95, Mo-99, Ba-140, La-140, Ce-141, Ce-144, Xe-133, Xe-135, Kr-85, Kr-88

# Decay chain modeling
include_decay_chains = true
chain_cutoff_halflife = 86400.0      # s (ignore daughters with t½ < 1 day)
bateman_equations = true             # Full Bateman solution for chains

# Activity calculation
activity_model = WAY_WIGNER          # t^(-1.2) decay law for total activity
output_activity_vs_time = true
activity_output_times = 1, 60, 3600, 86400, 604800, 2592000  # s

# Decay heat
compute_decay_heat = true

[RADIATION_TRANSPORT.DELAYED]
# Delayed radiation from fallout
enabled = true
fission_product_model = ENGLAND_RIDER  # England & Rider (1994) yields

# Gamma shine from deposited activity
gamma_shine_model = SEMI_INFINITE_PLANE
ground_roughness_factor = 0.7        # Reduces dose from surface irregularities
include_skyshine = true              # Scattered radiation

# ==============================================================================
# Fallout Formation Model (RadiationPhysics.hpp)
# ==============================================================================
[RADIATION_TRANSPORT.FALLOUT]
enabled = true
model = FALLOUT_FORMATION_MODEL      # Use FalloutFormationModel

# Particle formation
particle_model = LOGNORMAL
median_particle_size = 100.0         # micrometers
geometric_std_dev = 2.5

# Particle size classes for multi-group transport
num_size_classes = 20
min_diameter = 0.1                   # micrometers
max_diameter = 2000.0                # micrometers

# Fallout mass sources
include_crater_ejecta = true         # Soil from crater
include_fireball_condensate = true   # Vaporized material
include_stem_entrainment = true      # Entrained surface material

# Fractionation (radionuclide partitioning by particle size)
fractionation_model = FREILING       # Freiling fractionation
refractory_fraction = 0.7            # Fraction of refractories in large particles
volatile_fraction = 0.3              # Fraction of volatiles in small particles

# Soil properties for crater material
soil_density = 2600.0                # kg/m³
soil_melt_temperature = 1400.0       # K
soil_vaporization_temp = 3000.0      # K

# ==============================================================================
# Radioactive Dispersal Model (RadiationPhysics.hpp)
# ==============================================================================
[RADIATION_TRANSPORT.DISPERSAL]
enabled = true
model = RADIOACTIVE_DISPERSAL_MODEL  # Use RadioactiveDispersalModel

# Transport method
transport_method = LAGRANGIAN        # LAGRANGIAN or EULERIAN
num_particles = 100000               # Tracked particles for Lagrangian

# Atmospheric dispersion scheme
dispersion_scheme = PASQUILL_GIFFORD # GAUSSIAN, PASQUILL_GIFFORD, or K_THEORY
pasquill_stability = D               # A-F stability class

# Turbulent diffusion coefficients (for K-theory)
horizontal_diffusivity = 100.0       # m²/s
vertical_diffusivity = 10.0          # m²/s

# Wind field
wind_field = ATMOSPHERE              # Use wind from [ATMOSPHERE] section
time_varying_wind = false            # Static wind field

# Deposition processes
[RADIATION_TRANSPORT.DISPERSAL.DEPOSITION]
gravitational_settling = true
settling_velocity_model = STOKES     # STOKES, CUNNINGHAM, or TABULATED

dry_deposition = true
dry_deposition_velocity = 0.01       # m/s (default for fine particles)
size_dependent_vd = true             # Use size-dependent deposition velocity

wet_deposition = false               # Set true if rain present
washout_coefficient = 1.0e-4         # 1/s per mm/hr rain
below_cloud_scavenging = true
in_cloud_scavenging = true

# Resuspension
enable_resuspension = false
resuspension_factor = 1.0e-9         # 1/m for initial resuspension

# Domain for dispersal calculation
dispersal_domain_x = 200000.0        # m (200 km)
dispersal_domain_y = 200000.0        # m
dispersal_grid_nx = 200
dispersal_grid_ny = 200
dispersal_grid_nz = 50
dispersal_domain_z = 20000.0         # m (20 km vertical)

# Output
output_deposition_field = true
output_air_concentration = true
output_particle_tracks = false       # Can be large file

# ==============================================================================
# Dose Calculation Model (RadiationPhysics.hpp)
# ==============================================================================
[RADIATION_TRANSPORT.DOSE]
enabled = true
model = DOSE_CALCULATION_MODEL       # Use DoseCalculationModel

# Dose pathways
compute_prompt_dose = true           # Gamma + neutron
compute_cloud_shine = true           # External dose from passing cloud
compute_ground_shine = true          # External dose from deposited activity
compute_inhalation = true            # Internal dose from inhalation
compute_ingestion = false            # Internal dose from food/water

# Exposure parameters
breathing_rate = 1.2                 # m³/hr (light activity)
exposure_duration = 3600.0           # s (default 1 hour)
occupancy_factor = 1.0               # Fraction of time outdoors

# Shielding
[RADIATION_TRANSPORT.DOSE.SHIELDING]
enable_shielding = true
default_building_factor = 0.4        # Protection from buildings
default_wall_thickness = 0.15        # m (6 inch walls)
default_wall_density = 2400.0        # kg/m³ (concrete)

# Underground protection
underground_protection = false
underground_depth = 3.0              # m

# Dose limits and thresholds
[RADIATION_TRANSPORT.DOSE.THRESHOLDS]
prompt_lethal_dose = 4.5             # Sv (LD50/60)
acute_exposure_limit = 0.25          # Sv (acute exposure guideline)
annual_dose_limit = 0.001            # Sv (public annual limit)
emergency_worker_limit = 0.1         # Sv

# Dose rate contours for output
dose_rate_contours = 0.001, 0.01, 0.1, 1.0, 10.0  # Sv/hr
total_dose_contours = 0.001, 0.01, 0.1, 1.0, 4.5  # Sv

# Cloud rise parameters (used by multiple models)
stabilization_height = 15000.0       # m (mushroom cloud top)
cloud_rise_time = 300.0              # seconds

# Ground contamination output
output_contamination_map = true
contamination_units = Bq_per_m2      # Bq/m² or Ci/km²

# ==============================================================================
# Electromagnetic Pulse (EMP)
# ==============================================================================
[ELECTROMAGNETIC_PULSE]
enabled = true

# EMP source region
source_mechanism = COMPTON_CURRENT   # Compton electrons in atmosphere

# Three components of EMP
[EMP.E1]
# Early-time EMP (gamma-induced Compton current)
enabled = true
pulse_type = FAST
rise_time = 2.5e-9                   # 2.5 nanoseconds
decay_time = 1.0e-6                  # 1 microsecond
peak_field = 50000.0                 # V/m at 1 km

# Gamma source parameters
gamma_emission_time = 100.0e-9       # 100 ns gamma pulse
gamma_fluence = 1.0e13               # photons/m² at source

# Compton electron parameters
compton_electron_energy = 1.0        # MeV mean energy
geomagnetic_field = 50.0e-6          # Tesla (Earth's field)
geomagnetic_dip = 60.0               # degrees

# Source altitude effects
source_region_altitude = 20000.0     # m (Compton electrons created)
atmosphere_conductivity_profile = EXPONENTIAL

[EMP.E2]
# Intermediate-time EMP (scattered gamma)
enabled = true
pulse_type = INTERMEDIATE
rise_time = 1.0e-6                   # 1 microsecond
duration = 1.0e-3                    # 1 millisecond
peak_field = 1000.0                  # V/m

[EMP.E3]
# Late-time EMP (MHD-EMP from fireball expansion)
enabled = true
pulse_type = SLOW
rise_time = 0.1                      # 100 ms
duration = 100.0                     # 100 seconds
peak_field = 10.0                    # V/m

# Heave and magnetic field distortion
fireball_conductivity = 1.0e6        # S/m (ionized plasma)
magnetic_field_distortion = true

# Ground effects
[EMP.GROUND_EFFECTS]
ground_conductivity = 0.01           # S/m (typical soil)
enable_ground_wave = true
enable_sky_wave = true
ionosphere_reflection = true

# Infrastructure coupling
enable_line_coupling = true
power_line_length = 10000.0          # m (typical)
induced_current_model = TRANSMISSION_LINE

# Output fields
output_electric_field = true
output_magnetic_field = true
output_induced_current = true

# ==============================================================================
# Ionospheric Effects
# ==============================================================================
[IONOSPHERE]
enabled = true

# Ionosphere layers
D_layer_altitude = 60000.0           # 60 km
E_layer_altitude = 100000.0          # 100 km (outside domain)
F_layer_altitude = 300000.0          # 300 km (outside domain)

# Background electron density profile
background_model = IRI               # International Reference Ionosphere
daytime = true

# X-ray ionization enhancement
xray_ionization = true
enhanced_ionization_duration = 3600.0  # 1 hour

# Blackout effects
compute_radio_blackout = true
frequency_cutoff = 30.0e6            # Hz (HF cutoff)

# ==============================================================================
# Grid Configuration
# ==============================================================================
[GRID]
# Large domain for atmosphere and ground
nx = 400
ny = 400
nz = 200

# Domain: 100 km × 100 km × 100 km
Lx = 100000.0
Ly = 100000.0
Lz = 100000.0                        # 50 km ground + 100 km atmosphere

# Origin
origin_x = 0.0
origin_y = 0.0
origin_z = -50000.0                  # 50 km below, 100 km above ground

# Multi-domain mesh
use_multidomain = true

# Ground domain
[GRID.GROUND]
z_min = -50000.0
z_max = 0.0
nz = 50
material = SOLID

# Atmosphere domain
[GRID.ATMOSPHERE]
z_min = 0.0
z_max = 100000.0
nz = 150
material = GAS

# Adaptive refinement
[amr]
enabled = true
method = plex_refine

[amr.criterion]
type = combined
weight_shock = 1.0
weight_temperature = 0.5
weight_radiation = 0.3

[amr.limits]
max_refinement_level = 5
max_cells = 20000000
min_cell_size = 5.0

[amr.features]
buffer_layers = 3

# High resolution at burst point
[amr.features.burst]
x = 50000.0
y = 50000.0
z = 500.0
radius = 5000.0
level = 5

# Refinement at ground zero
[amr.features.ground_zero]
x = 50000.0
y = 50000.0
z = 0.0
radius = 10000.0
level = 4

# ==============================================================================
# Ground Material Properties
# ==============================================================================
[ROCK]
name = ALLUVIUM
constitutive_model = ELASTOPLASTIC_MC

# Alluvial soil properties
youngs_modulus = 500.0e6             # 500 MPa (soft soil)
poisson_ratio = 0.35
density = 1800.0                     # kg/m³

p_wave_velocity = 500.0              # m/s (very slow)
s_wave_velocity = 250.0

# Mohr-Coulomb plasticity
failure_criterion = MOHR_COULOMB
cohesion = 50.0e3                    # 50 kPa
friction_angle = 30.0                # degrees
tensile_strength = 10.0e3            # 10 kPa

# Crater formation
enable_crater_formation = true
excavation_model = HOLSAPPLE         # Holsapple scaling laws

# ==============================================================================
# Coupled Ground Response
# ==============================================================================
[GROUND_COUPLING]
# Air-ground interface
coupling_type = IMPEDANCE_MATCHING
surface_reflection = true

# Ground shock from air blast
air_blast_ground_coupling = true
coupling_factor = 0.01               # ~1% of overpressure couples to ground

# Seismic wave generation
seismic_source_type = DISTRIBUTED
source_area_radius = 5000.0          # m radius of loading

# Crater
crater_model = NORDYKE               # Nordyke scaling
scaled_depth = 0.0                   # Surface burst
apparent_crater_depth = 50.0         # m (estimated)
apparent_crater_radius = 300.0       # m (estimated)

# Ground motion
compute_ground_motion = true
surface_wave_generation = true

# ==============================================================================
# Initial Conditions
# ==============================================================================
[IC1]
field = PRESSURE_ATMOSPHERE
distribution = EXPONENTIAL
reference_value = 101325.0           # Pa at sea level
scale_height = 8500.0                # m

[IC2]
field = TEMPERATURE_ATMOSPHERE
distribution = PROFILE
profile_type = STANDARD_ATMOSPHERE

[IC3]
field = DENSITY_ATMOSPHERE
distribution = EXPONENTIAL
reference_value = 1.225              # kg/m³ at sea level
scale_height = 8500.0

[IC4]
# Ground at rest
field = DISPLACEMENT
distribution = UNIFORM
value = 0.0

[IC5]
# Initial temperature field
field = TEMPERATURE
distribution = GRADIENT
value = 288.15
gradient = 0.0, 0.0, -0.0065         # Lapse rate (atmosphere)

# ==============================================================================
# Boundary Conditions
# ==============================================================================
[BC1]
# Non-reflecting atmospheric boundaries
type = ABSORBING
location = XMIN, XMAX, YMIN, YMAX
field = ALL
absorbing_type = CHARACTERISTIC

[BC2]
# Top of atmosphere (outflow)
type = OUTFLOW
location = ZMAX
field = ALL

[BC3]
# Ground surface (coupled to atmosphere)
type = INTERFACE
location = GROUND_SURFACE
field = ALL
interface_type = ATMOSPHERE_GROUND

[BC4]
# Bottom of ground domain
type = ABSORBING
location = ZMIN
field = DISPLACEMENT
absorbing_type = PML
pml_layers = 20

# ==============================================================================
# Receivers and Stations
# ==============================================================================
[RECEIVERS]
output_format = HDF5
sampling_rate = 1000.0               # 1 kHz

# Pressure/overpressure sensors
[RECEIVER_ARRAY_PRESSURE]
type = LINE
start = 50000.0, 50000.0, 2.0
end = 100000.0, 50000.0, 2.0
num_stations = 50
fields = pressure, overpressure, temperature, velocity

# Ground motion seismometers
[RECEIVER_ARRAY_SEISMIC]
type = LINE
start = 50000.0, 50000.0, -1.0
end = 100000.0, 50000.0, -1.0
num_stations = 50
fields = displacement, velocity, acceleration

# Radiation detectors
[RECEIVER_ARRAY_RADIATION]
type = GRID
x_range = 45000.0, 75000.0
y_range = 45000.0, 75000.0
z = 1.0
nx = 10
ny = 10
fields = gamma_dose_rate, neutron_flux, total_dose

# EMP field sensors
[RECEIVER_ARRAY_EMP]
type = LINE
start = 50000.0, 50000.0, 10.0
end = 150000.0, 50000.0, 10.0
num_stations = 20
fields = electric_field_x, electric_field_y, electric_field_z, magnetic_field

# Individual key stations
[RECEIVER1]
name = GZ_SURFACE
location = 50000.0, 50000.0, 1.0
fields = ALL

[RECEIVER2]
name = 1KM_RANGE
location = 51000.0, 50000.0, 1.0
fields = ALL

[RECEIVER3]
name = 5KM_RANGE
location = 55000.0, 50000.0, 1.0
fields = ALL

[RECEIVER4]
name = 10KM_RANGE
location = 60000.0, 50000.0, 1.0
fields = ALL

[RECEIVER5]
name = 20KM_RANGE
location = 70000.0, 50000.0, 1.0
fields = ALL

# ==============================================================================
# Output Configuration
# ==============================================================================
[OUTPUT]
format = HDF5
path = output/atmospheric_nuclear

# Atmospheric fields
save_pressure = true
save_temperature = true
save_density = true
save_velocity = true

# Ground fields
save_displacement = true
save_ground_velocity = true
save_stress = true

# Radiation fields
save_dose_rate = true
save_accumulated_dose = true
save_contamination = true

# EMP fields
save_electric_field = true
save_magnetic_field = true
save_induced_current = true

# Frequencies
volume_output_frequency = 1000
surface_output_frequency = 100

# Special outputs
save_shock_front = true
save_fireball_contour = true
save_fallout_trajectory = true

# Visualization helpers
save_overpressure_contours = true
overpressure_levels = 0.01, 0.03, 0.07, 0.14, 0.35, 0.7, 1.4, 3.5  # Bar

# Movies
save_animation_frames = true
animation_frame_interval = 10

# ==============================================================================
# Debris Transport Model (AtmosphericExplosion.hpp)
# ==============================================================================
[DEBRIS_TRANSPORT]
enabled = true
model = DEBRIS_TRANSPORT_MODEL       # Use DebrisTransportModel

# Multi-phase particulate transport
num_phases = 3                       # Debris size classes
phase_names = fine, medium, coarse

# Size distribution (log-normal per phase)
[DEBRIS_TRANSPORT.FINE]
min_diameter = 0.1                   # micrometers
max_diameter = 10.0
median_diameter = 2.0
geometric_std = 2.0
density = 2000.0                     # kg/m³ (condensate)
mass_fraction = 0.2

[DEBRIS_TRANSPORT.MEDIUM]
min_diameter = 10.0                  # micrometers
max_diameter = 200.0
median_diameter = 50.0
geometric_std = 2.5
density = 2500.0                     # kg/m³ 
mass_fraction = 0.5

[DEBRIS_TRANSPORT.COARSE]
min_diameter = 200.0                 # micrometers  
max_diameter = 5000.0
median_diameter = 500.0
geometric_std = 2.0
density = 2600.0                     # kg/m³ (soil)
mass_fraction = 0.3

# Transport physics
settling_model = STOKES_CUNNINGHAM
include_turbulent_dispersion = true
include_coagulation = false          # Particle aggregation
include_breakup = false              # Particle fragmentation

# Initial distribution
initial_distribution = MUSHROOM_CLOUD  # From mushroom cloud model
inject_from_stem = true
inject_from_cap = true

# Deposition tracking
track_deposition_time = true
track_deposition_mechanism = true
output_deposition_rate = true

# ==============================================================================
# Turbulent Mixing Model (AtmosphericExplosion.hpp)
# ==============================================================================
[TURBULENT_MIXING]
enabled = true
model = TURBULENT_MIXING_MODEL       # Use TurbulentMixingModel

# Mixing length model
mixing_length_model = PRANDTL        # PRANDTL or BLACKADAR
von_karman_constant = 0.41
mixing_length_max = 100.0            # m (asymptotic value)

# Eddy viscosity
eddy_viscosity_model = SMAGORINSKY
smagorinsky_cs = 0.17

# Turbulent Prandtl/Schmidt numbers
turbulent_prandtl = 0.85
turbulent_schmidt = 0.7

# Entrainment
entrainment_model = TURNER
entrainment_coefficient = 0.12
stratification_suppression = true    # Reduce mixing in stable stratification

# Mixing efficiency
mixing_efficiency_model = OSBORN_COX
mixing_efficiency = 0.2              # Fraction of TKE to mixing

# ==============================================================================
# Analysis
# ==============================================================================
[ANALYSIS]
# Damage assessment
compute_blast_damage = true
damage_categories = light, moderate, severe, total
overpressure_thresholds = 3.5, 14, 35, 140    # kPa

# Thermal damage
compute_thermal_damage = true
thermal_fluence_thresholds = 125, 335, 670, 1675  # kJ/m² (burns)

# Radiation effects
compute_radiation_effects = true
dose_thresholds = 0.01, 0.1, 1.0, 10.0  # Sv

# EMP effects
compute_emp_effects = true
field_thresholds = 1000, 5000, 25000, 50000  # V/m

# Combined effects
compute_combined_effects = true
output_damage_map = true

# Seismic analysis
compute_seismic_magnitude = true
compute_ground_motion_parameters = true
compute_response_spectra = true

# Atmospheric effects
compute_mushroom_cloud = true
compute_fallout_pattern = true
compute_thermal_plume = true

# ==============================================================================
# Extended Physics Analysis (new models)
# ==============================================================================
[ANALYSIS.INSTABILITIES]
# Rayleigh-Taylor analysis
compute_rt_growth_rate = true
compute_rt_mixing_width = true
output_rt_amplitude_vs_time = true

# Richtmyer-Meshkov analysis
compute_rm_post_shock_growth = true
output_rm_interface_position = true

# Kelvin-Helmholtz analysis
compute_kh_vorticity = true
output_kh_mixing_layer = true

# Combined instability metrics
output_mixing_zone_width = true
output_atwood_number_evolution = true

[ANALYSIS.MUSHROOM_CLOUD]
# Cloud evolution tracking
output_cloud_height_vs_time = true
output_cloud_radius_vs_time = true
output_cloud_temperature_vs_time = true
output_rise_velocity_vs_time = true
output_entrainment_rate = true

# Vortex ring analysis
compute_circulation = true
output_vortex_trajectory = true

# Stem analysis
output_stem_height_vs_time = true
output_afterwinds_velocity = true

[ANALYSIS.RADIATION]
# Activity tracking
output_total_activity_vs_time = true
output_isotope_activities = true
output_dominant_contributors = true

# Dose analysis
output_dose_rate_maps = true
output_accumulated_dose_maps = true
output_thyroid_dose_map = true        # I-131 specific

# Fallout pattern analysis
compute_hot_line = true               # Maximum fallout axis
compute_contour_areas = true          # Area within dose contours
output_arrival_time_map = true        # Time of fallout arrival

[ANALYSIS.DISPERSAL]
# Plume analysis
output_plume_centerline = true
output_sigma_y_vs_distance = true
output_sigma_z_vs_distance = true

# Mass balance
output_deposited_fraction_vs_time = true
output_airborne_fraction_vs_time = true
output_escaped_fraction = true        # Left domain boundaries
