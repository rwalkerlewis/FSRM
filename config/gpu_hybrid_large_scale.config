# Large-Scale Simulation with Hybrid CPU+GPU Execution
# For problems too large to fit in GPU memory
# Automatic work partitioning between CPU and GPU

[SIMULATION]
start_time = 0.0
end_time = 365.0              # 1 year production
dt_initial = 0.1              # 0.1 day
dt_min = 0.001
dt_max = 10.0

# Hybrid GPU Configuration
use_gpu = true
gpu_mode = HYBRID             # Automatically partition work
gpu_device_id = 0
gpu_verbose = true
gpu_memory_fraction = 0.95    # Use most of GPU memory

# Hybrid execution strategy
hybrid_partition_strategy = AUTOMATIC  # Let solver decide split
hybrid_cpu_fraction = 0.3              # Aim for 30% CPU, 70% GPU
hybrid_rebalance_frequency = 100       # Rebalance every 100 steps

# GPU optimizations
use_gpu_preconditioner = true
use_gpu_matrix_assembly = true
pin_host_memory = true
use_unified_memory = false    # Disable for better performance in hybrid mode

# Time stepping
enable_adaptive_timestepping = true
max_timesteps = 3650

# Output
output_frequency = 365        # Monthly output
output_format = HDF5          # More efficient for large data
checkpointing = true
checkpoint_frequency = 365
enable_compression = true

# Solver
rtol = 1e-5
atol = 1e-6
max_nonlinear_iterations = 25
max_linear_iterations = 2000

# Physics - Black oil reservoir
fluid_model = BLACK_OIL
solid_model = POROELASTIC
enable_geomechanics = true
enable_thermal = false

[GRID]
# Large grid: ~11 million cells
nx = 400
ny = 400
nz = 70
Lx = 4000.0    # 4 km x 4 km field
Ly = 4000.0
Lz = 350.0     # 350 m thick reservoir

[ROCK]
# Heterogeneous sandstone
porosity = 0.22
permeability_x = 200.0e-15    # 200 mD average
permeability_y = 200.0e-15
permeability_z = 50.0e-15

# Add heterogeneity (will be generated)
use_heterogeneous_properties = true
permeability_variance = 0.5   # Log-normal variance
correlation_length = 100.0    # meters

# Geomechanics
youngs_modulus = 12.0e9
poisson_ratio = 0.25
density = 2400.0
biot_coefficient = 0.85

[FLUID]
# Black oil properties
oil_density_std = 850.0
gas_density_std = 1.2
water_density_std = 1020.0

oil_viscosity = 0.005         # 5 cP
gas_viscosity = 0.00002
water_viscosity = 0.001

solution_GOR = 150.0          # scf/stb
oil_formation_volume_factor = 1.2
gas_formation_volume_factor = 0.005

[WELL1]
name = PROD1
type = PRODUCER
i = 100
j = 100
k_top = 30
k_bottom = 60
control_mode = RATE
target_rate = 100.0           # mÂ³/day
min_bhp = 5.0e6              # 50 bar minimum BHP

[WELL2]
name = PROD2
type = PRODUCER
i = 300
j = 100
k_top = 30
k_bottom = 60
control_mode = RATE
target_rate = 100.0
min_bhp = 5.0e6

[WELL3]
name = PROD3
type = PRODUCER
i = 100
j = 300
k_top = 30
k_bottom = 60
control_mode = RATE
target_rate = 100.0
min_bhp = 5.0e6

[WELL4]
name = PROD4
type = PRODUCER
i = 300
j = 300
k_top = 30
k_bottom = 60
control_mode = RATE
target_rate = 100.0
min_bhp = 5.0e6

[WELL5]
name = INJ1
type = INJECTOR
i = 200
j = 200
k_top = 30
k_bottom = 60
control_mode = RATE
target_rate = 300.0           # Water injection
max_bhp = 50.0e6             # 500 bar maximum BHP
injection_fluid = WATER

[INITIAL_CONDITIONS]
pressure_type = GRADIENT
pressure_surface = 20.0e6     # 200 bar
pressure_gradient = 0, 0, 10000

saturation_oil = 0.75
saturation_water = 0.25
saturation_gas = 0.0

[BOUNDARY_CONDITIONS]
# All boundaries closed (no-flow)
xmin_type = NO_FLOW
xmax_type = NO_FLOW
ymin_type = NO_FLOW
ymax_type = NO_FLOW
zmin_type = NO_FLOW
zmax_type = NO_FLOW

[OUTPUT]
fields = pressure,saturation_oil,saturation_water,displacement,stress
save_well_data = true
well_data_frequency = 1       # Save daily well data

# Production curves
output_cumulative_production = true
output_production_rates = true
output_water_cut = true

[PERFORMANCE]
# Performance monitoring
enable_profiling = true
profile_frequency = 100
print_memory_usage = true
print_gpu_utilization = true

# Load balancing
enable_dynamic_load_balancing = true
load_balance_frequency = 500
load_balance_tolerance = 0.1
