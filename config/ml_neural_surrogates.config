# =============================================================================
# Neural Surrogates Configuration
# =============================================================================
# Configures ML-based surrogates for physics computations:
# - Neural PVT: Replace PVT correlations
# - Neural Flash: Replace Rachford-Rice iterations
# - Neural RelPerm: Replace relative permeability tables
# - Neural Preconditioner: Accelerate linear solvers
# =============================================================================

[general]
enabled = true
model_directory = ml_models/surrogates
auto_train = false
use_gpu = true
precision = float32

# =============================================================================
# Neural PVT Model
# =============================================================================
[neural_pvt]
enabled = true
model_path = ml_models/surrogates/pvt_model.pt

# Architecture
hidden_layers = 128,256,256,128
activation = gelu
use_batch_norm = true

# Input bounds (for normalization)
p_min = 1e5
p_max = 1e8
T_min = 273.15
T_max = 473.15
Rs_min = 0.0
Rs_max = 500.0

# Properties to predict
# Options: OIL_FVF, OIL_VISCOSITY, OIL_DENSITY, GAS_FVF, GAS_VISCOSITY,
#          GAS_DENSITY, GAS_Z_FACTOR, SOLUTION_GOR, BUBBLE_POINT
properties = OIL_FVF,OIL_VISCOSITY,GAS_FVF,GAS_VISCOSITY,SOLUTION_GOR

# Training
learning_rate = 1e-3
batch_size = 256
epochs = 200
validation_split = 0.1

# Constraints
enforce_monotonicity = true
enforce_positivity = true

# Fallback to correlation if error exceeds threshold
fallback_threshold = 0.05

# =============================================================================
# Neural Flash Calculator
# =============================================================================
[neural_flash]
enabled = true
model_path = ml_models/surrogates/flash_model.pt

# Number of components
num_components = 5

# Architecture
hidden_layers = 256,512,512,256
activation = gelu

# Training
learning_rate = 1e-3
batch_size = 128
epochs = 500

# Physics constraints
enforce_mass_balance = true
enforce_fugacity_equality = false

# Stability prediction
predict_stability = true

# =============================================================================
# Neural Relative Permeability
# =============================================================================
[neural_relperm]
enabled = true
model_path = ml_models/surrogates/relperm_model.pt

# Number of phases
num_phases = 3

# Architecture
hidden_layers = 64,128,128,64
activation = softplus

# Saturation bounds
Swc = 0.2
Sor = 0.2
Sgc = 0.05

# Training
learning_rate = 1e-3
epochs = 200

# Constraints
enforce_endpoint_values = true
enforce_monotonicity = true

# =============================================================================
# Neural Preconditioner
# =============================================================================
[neural_preconditioner]
enabled = false
model_path = ml_models/surrogates/preconditioner_model.pt

# Architecture
hidden_layers = 512,1024,1024,512
activation = gelu

# Strategy
# Options: DIRECT, RESIDUAL, DEFLATION, COARSE_GRID
strategy = RESIDUAL

# Reference preconditioner (for RESIDUAL strategy)
reference_precond = ILU0

# Training
learning_rate = 1e-4
batch_size = 32
epochs = 100

# Use eigenspace information
use_eigenspace = false
num_eigenvectors = 10

# =============================================================================
# Usage Example
# =============================================================================
# In your config file, add:
#   ml_solver_method = NEURAL_SURROGATE
#   neural_pvt_enabled = true
#   neural_flash_enabled = true
#   neural_relperm_enabled = true
# =============================================================================
