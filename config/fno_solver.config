# =============================================================================
# FSRM Configuration: Fourier Neural Operator (FNO) Solver
# =============================================================================
# This configuration demonstrates using FNO as an alternative to numerical solvers.
# FNO can significantly accelerate simulations after training on numerical data.

[SIMULATION]
name = FNO_Demo
start_time = 0.0
end_time = 10.0
dt_initial = 0.001
output_frequency = 100
output_format = HDF5

# Solver method selection
# Options: NUMERICAL, FNO, HYBRID_FNO_REFINE, HYBRID_COARSE_FNO, ENSEMBLE
solver_method = FNO

[GRID]
nx = 64
ny = 64
nz = 1
Lx = 10000.0
Ly = 10000.0
Lz = 100.0

[ROCK]
porosity = 0.20
permeability_x = 100.0
permeability_y = 100.0
youngs_modulus = 30.0e9
poissons_ratio = 0.25
density = 2700.0

# =============================================================================
# FNO Model Configuration
# =============================================================================

[FNO]
# Enable/disable FNO
enabled = true

# Architecture
input_channels = 3       # Number of input fields (e.g., pressure, vx, vy)
output_channels = 3      # Number of output fields
hidden_channels = 64     # Width of hidden layers
num_layers = 4           # Number of FNO layers
num_modes = 16           # Number of Fourier modes to keep

# Spatial dimensions (1, 2, or 3)
spatial_dim = 2

# Activation function: gelu, relu, tanh, silu
activation = gelu

# Normalization and residual connections
use_layer_norm = true
use_residual = true

# =============================================================================
# FNO Training Configuration
# =============================================================================

[FNO_TRAINING]
# Training hyperparameters
learning_rate = 1e-3
weight_decay = 1e-4
batch_size = 16
epochs = 100
validation_split = 0.1

# Learning rate schedule: constant, step, exponential, cosine, plateau
lr_schedule = cosine

# Early stopping
early_stopping = true
early_stopping_patience = 20
early_stopping_min_delta = 1e-5

# Data augmentation
augment_flip = true
augment_rotate = true
augment_noise = true
noise_std = 0.01

# =============================================================================
# Pre-trained Model Loading
# =============================================================================

[FNO_MODEL]
# Path to pre-trained model (optional)
model_path = 

# Load pre-trained weights
load_pretrained = false

# Save trained model
save_model = true
save_path = output/fno_model

# =============================================================================
# Hybrid Solver Configuration
# =============================================================================

[FNO_HYBRID]
# Weight for FNO prediction in ensemble mode (0-1)
# Higher = more weight on FNO, Lower = more weight on numerical
ensemble_weight = 0.8

# Number of numerical refinement iterations (for HYBRID_FNO_REFINE mode)
refinement_iterations = 3

# Coarse grid factor for HYBRID_COARSE_FNO mode
coarse_factor = 4

# Error threshold for adaptive switching between FNO and numerical
error_threshold = 0.05

# =============================================================================
# GPU Acceleration
# =============================================================================

[FNO_GPU]
use_gpu = true
gpu_device = 0
# Fraction of GPU memory to use (0-1)
memory_fraction = 0.8

# =============================================================================
# Data Generation from Numerical Simulations
# =============================================================================

[FNO_DATA]
# Generate training data from numerical solver
generate_data = true

# Number of samples to generate
num_samples = 1000

# Path to save/load generated dataset
dataset_path = data/fno_training_data.bin

# Variation ranges for initial conditions
pressure_range = 10.0e6, 30.0e6
velocity_range = -1.0, 1.0

# Physics parameter variations (for conditional FNO)
vary_permeability = true
permeability_range = 50.0, 200.0

vary_porosity = true
porosity_range = 0.15, 0.25

# =============================================================================
# Physics-Informed Learning
# =============================================================================

[FNO_PHYSICS]
# Add physics-based loss terms
physics_informed = true

# Weight of physics loss relative to data loss
physics_weight = 0.1

# Physics equations to enforce:
# - wave: wave equation residual
# - diffusion: diffusion equation residual
# - elastic: elastic wave equation
# - poroelastic: poroelastic equations
physics_equations = elastic

# =============================================================================
# Output and Monitoring
# =============================================================================

[FNO_OUTPUT]
# Verbose training output
verbose = true

# Save training history
save_history = true
history_path = output/fno_training_history.csv

# Visualize spectral filters
visualize_filters = false
filter_output_path = output/fno_filters

# Log interval during training
log_interval = 10
