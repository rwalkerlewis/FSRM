# ============================================================================
# Induced Seismicity with Off-Fault Plasticity
# ============================================================================
# NEW FEATURES:
# - Drucker-Prager plasticity for damage zones
# - Reservoir injection coupled with dynamic rupture
# - Thermal pressurization
# Combines ALL advanced features in one simulation!
# ============================================================================

[SIMULATION]
start_time = 0.0
end_time = 86400.0                 # 1 day = long-term injection
dt_initial = 10.0                  # Start with large timesteps
dt_min = 0.0001                    # Can go small for earthquake
dt_max = 100.0                     # Adaptive
output_frequency = 100
output_directory = output/induced_seis_plasticity

# Advanced numerics
use_discontinuous_galerkin = true
dg_order = 3
use_ader_time_integration = true
enable_local_time_stepping = true
lts_rate = 3

# Coupled physics (FSRM unique advantage!)
enable_poroelastodynamics = true   # Fluid + solid + waves
enable_dynamic_rupture = true
enable_plasticity = true           # NEW!
enable_thermal = true
enable_multi_phase_flow = false    # Could add for CO2/brine

# Static-to-dynamic triggering
use_static_triggering = true
dynamic_trigger_threshold = 5.0e6  # Pa (Coulomb stress)
dynamic_event_duration = 10.0      # Switch to dynamics for 10 s

use_gpu = true

[GRID]
nx = 100
ny = 100
nz = 50
Lx = 5000.0                        # 5 km x 5 km x 2.5 km
Ly = 5000.0
Lz = 2500.0

[ROCK]
# Reservoir rock (quasi-static properties)
youngs_modulus = 25e9
poisson_ratio = 0.25
density = 2600.0
porosity = 0.15
permeability_x = 10.0              # mD
permeability_y = 10.0
permeability_z = 1.0               # Anisotropic

# Dynamic properties
p_wave_velocity = 5000.0
s_wave_velocity = 2887.0
quality_factor_p = 50.0
quality_factor_s = 25.0

# Biot poroelasticity
biot_coefficient = 0.8
biot_modulus = 10e9

# NEW: Plasticity parameters (Drucker-Prager)
enable_plasticity = true
yield_criterion = DRUCKER_PRAGER
friction_angle = 30.0              # degrees
cohesion = 2.0e6                   # Pa
dilation_angle = 10.0              # degrees
tensile_strength = 0.5e6           # Pa

# Strain softening (damage accumulates)
hardening_law = STRAIN_SOFTENING
softening_modulus = -100e9         # Negative = softening
residual_cohesion = 0.2e6          # Drops to 0.2 MPa
residual_friction_angle = 20.0     # Drops to 20 degrees

[FLUID]
fluid_density = 1000.0             # Water
water_viscosity = 1.0e-3
fluid_compressibility = 4.5e-10

[WELL1]
# Injection well
name = INJECT1
type = INJECTOR
i = 50
j = 50
k = 25                             # Mid-depth
control_mode = RATE
target_value = 0.1                 # m³/s = 8640 m³/day (high rate)
bhp_limit = 50e6                   # 50 MPa limit

[FAULT1]
# Pre-existing fault
type = PLANAR
strike = 45.0                      # NE-SW
dip = 60.0                         # Dipping fault
x_center = 2500.0                  # 2.5 km from injection
z_center = -1500.0
length = 3000.0
width = 2000.0

# Rate-and-state with thermal pressurization
friction_law = RATE_STATE_SLIP_WITH_TP
rs_a = 0.010
rs_b = 0.015                       # Velocity weakening
rs_L = 0.02
rs_f0 = 0.6
rs_V0 = 1.0e-6

# Thermal pressurization
enable_thermal_pressurization = true
tp_thermal_diffusivity = 1.0e-6
tp_hydraulic_diffusivity = 1.0e-4
tp_Lambda = 0.1e6
tp_half_width_shear_zone = 0.005
tp_initial_temperature = 373.15    # 100°C
tp_initial_pore_pressure = -20e6

# Initial stress (critically stressed)
initial_shear_stress = 15.0e6
initial_normal_stress = -25.0e6

[FAULT_DAMAGE_ZONE]
# Damage zone around fault with enhanced plasticity
width = 200.0                      # 200 m damage zone
cohesion_reduction = 0.5           # 50% reduction
friction_reduction = 0.8           # 20% reduction
permeability_enhancement = 10.0    # 10x higher permeability

[INITIAL_CONDITIONS]
IC1_field = PRESSURE
IC1_distribution = GRADIENT
IC1_value = 20.0e6                 # 20 MPa at surface
IC1_gradient = 0, 0, 10000         # Hydrostatic

IC2_field = TEMPERATURE
IC2_distribution = GRADIENT
IC2_value = 293.15                 # 20°C surface
IC2_gradient = 0, 0, 0.025         # 25°C/km

IC3_field = STRESS_XX
IC3_value = -30e6                  # Regional stress

IC4_field = STRESS_YY
IC4_value = -25e6

IC5_field = STRESS_ZZ
IC5_value = -35e6                  # Vertical stress

[BC1]
type = DIRICHLET
field = PRESSURE
location = ZMIN
value = 25.0e6                     # Fixed at depth

[BC2]
type = NEUMANN
field = DISPLACEMENT
location = ZMAX
value = 0.0                        # Free surface

[OUTPUT]
# Comprehensive output
output_fault_data = true
fault_output_fields = slip,slip_rate,shear_stress,normal_stress,pore_pressure,temperature,rupture_time

output_plasticity_data = true
plasticity_output_fields = plastic_strain,accumulated_plastic_strain,yield_function,damage

volume_output_fields = pressure,displacement,velocity,stress,plastic_strain,pore_pressure
volume_output_frequency = 100

# Seismicity catalog
enable_event_detection = true
event_magnitude_threshold = -2.0   # Detect microseismicity
output_event_catalog = true

[ANALYSIS]
# Track injection-induced seismicity
monitor_seismicity_rate = true
compute_coulomb_stress_changes = true
analyze_fault_stability = true

# Plasticity analysis
compute_plastic_volume = true
track_energy_dissipation = true

# Coupled analysis
analyze_pore_pressure_diffusion = true
compute_effective_permeability = true
