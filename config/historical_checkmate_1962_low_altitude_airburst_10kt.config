# ==============================================================================
# Historical-inspired Example: CHECKMATE (Operation Dominic, 1962) - Airburst
# ==============================================================================
# Purpose:
# - Add a "low-altitude airburst" Dominic-style example to complement the
#   Fishbowl EMP cases (Starfish/Bluegill/Kingfish) and surface-burst fallout cases.
# - Emphasize blast + thermal + prompt radiation with *minimal* fallout modeling.
#
# Notes (important):
# - Educational, historical-inspired scenario (not an authoritative reconstruction).
# - The key modeling intent is "airburst" (HOB > 0):
#   - crater / ejecta-driven fallout: disabled
#   - ground coupling: optional but enabled at a reduced factor to show seismic loading
# ==============================================================================

[SIMULATION]
name = historical_checkmate_1962_airburst_10kt
description = Dominic-inspired 10 kt low-altitude airburst (blast + thermal + prompt radiation)

start_time = 0.0
end_time = 300.0

# Keep early-time resolution for fireball/shock formation, but less extreme than
# full EMP-focused runs.
dt_initial = 2.0e-9
dt_min = 1.0e-11
dt_max = 0.2

adaptive_dt = true
phase_adaptive = true
phase1_end = 1.0e-3
phase1_dt_max = 2.0e-7
phase2_end = 0.1
phase2_dt_max = 2.0e-5
phase3_end = 10.0
phase3_dt_max = 0.02

output_frequency = 200
output_format = HDF5
enable_checkpointing = true
checkpoint_frequency = 10000

fluid_model = COMPRESSIBLE_NS
solid_model = ELASTODYNAMIC

enable_atmosphere = true
enable_geomechanics = true
enable_elastodynamics = true
enable_thermal = true
enable_radiation = true

# Airburst: EMP/ionosphere are not the focus; keep them off.
enable_electromagnetic = false
enable_ionization = false

coupling_mode = FULLY_COUPLED
atmosphere_ground_coupling = true
radiation_thermal_coupling = true

use_gpu = true
gpu_mode = AUTO

# ==============================================================================
# Device
# ==============================================================================
[NUCLEAR_DEVICE]
# Use fission-only for a clean "prompt" baseline
# (Thermonuclear is fine too; this is just simpler for a 10 kt class example.)
type = NUCLEAR_FISSION
yield_kt = 10.0
fission_fraction = 1.0

# Low-altitude airburst height-of-burst (HOB)
# Representative few-kilometer altitude.
burst_height = 3000.0
location_x = 50000.0
location_y = 50000.0
location_z = 3000.0

# ==============================================================================
# Fireball / Thermal
# ==============================================================================
[FIREBALL]
model = BRODE

# For small yields, the classic double-flash is less pronounced; keep disabled.
thermal_fraction = 0.35
thermal_pulse_duration = 1.0
enable_double_flash = false

# ==============================================================================
# Atmosphere
# ==============================================================================
[ATMOSPHERE]
model = EXTENDED
base_profile = US_STANDARD_1976

ground_level = 0.0
top_of_domain = 30000.0
num_layers = 40
layer_type = EXPONENTIAL

[ATMOSPHERE.WIND]
enable_wind = true
wind_profile_type = POWER_LAW
surface_wind_speed = 6.0
wind_direction = 270.0
reference_height = 10.0
surface_roughness = 0.05
wind_shear_exponent = 0.18
enable_jet_stream = false

[ATMOSPHERE.HUMIDITY]
relative_humidity = 0.40
enable_humidity_profile = false

# ==============================================================================
# Blast Wave
# ==============================================================================
[BLAST_WAVE]
model = SEDOV_TAYLOR

# Airburst: include ground reflection to show Mach stem formation.
enable_ground_reflection = true
ground_reflection_factor = 1.6
include_negative_phase = true

# ==============================================================================
# Radiation Transport (prompt only)
# ==============================================================================
[RADIATION_TRANSPORT]
enabled = true
method = MONTE_CARLO
num_particles = 1200000

[RADIATION_TRANSPORT.PROMPT]
enabled = true
gamma_yield_fraction = 0.007
neutron_yield_fraction = 0.002
xray_yield_fraction = 0.70
xray_absorption_altitude = 8000.0

# Disable fallout / fission-product inventory for an airburst-focused run
[RADIATION_TRANSPORT.FISSION_PRODUCTS]
enabled = false

[RADIATION_TRANSPORT.FALLOUT]
enabled = false

[RADIATION_TRANSPORT.DISPERSAL]
enabled = false

[RADIATION_TRANSPORT.DOSE]
enabled = true
compute_prompt_dose = true
compute_cloud_shine = false
compute_ground_shine = false
compute_inhalation = false
output_contamination_map = false

# ==============================================================================
# Ground Material (generic soft soil)
# ==============================================================================
[ROCK]
name = ALLUVIUM
constitutive_model = ELASTOPLASTIC_MC

youngs_modulus = 700.0e6
poisson_ratio = 0.35
density = 1800.0

p_wave_velocity = 600.0
s_wave_velocity = 300.0

failure_criterion = MOHR_COULOMB
cohesion = 80.0e3
friction_angle = 30.0
tensile_strength = 15.0e3

# No crater formation for airburst
enable_crater_formation = false

[GROUND_COUPLING]
coupling_type = IMPEDANCE_MATCHING
surface_reflection = true
air_blast_ground_coupling = true

# Airburst: reduced coupling factor vs surface burst
coupling_factor = 0.005

# ==============================================================================
# Grid
# ==============================================================================
[GRID]
# Compact domain for a quick airburst example
nx = 280
ny = 280
nz = 180

Lx = 100000.0
Ly = 100000.0
Lz = 80000.0

origin_x = 0.0
origin_y = 0.0
origin_z = -20000.0

use_multidomain = true

[GRID.GROUND]
z_min = -20000.0
z_max = 0.0
nz = 40
material = SOLID

[GRID.ATMOSPHERE]
z_min = 0.0
z_max = 60000.0
nz = 140
material = GAS

[amr]
enabled = true
method = plex_refine

[amr.criterion]
type = combined
weight_shock = 1.0
weight_temperature = 0.5
weight_radiation = 0.3

[amr.limits]
max_refinement_level = 4
max_cells = 12000000
min_cell_size = 10.0

[amr.features.burst]
x = 50000.0
y = 50000.0
z = 3000.0
radius = 6000.0
level = 4

# ==============================================================================
# Receivers
# ==============================================================================
[RECEIVERS]
output_format = HDF5
sampling_rate = 1000.0

[RECEIVER_ARRAY_PRESSURE]
type = LINE
start = 50000.0, 50000.0, 2.0
end = 100000.0, 50000.0, 2.0
num_stations = 50
fields = pressure, overpressure, temperature, velocity

[RECEIVER_ARRAY_RADIATION]
type = GRID
x_range = 45000.0, 75000.0
y_range = 45000.0, 75000.0
z = 1.0
nx = 10
ny = 10
fields = gamma_dose_rate, total_dose

# ==============================================================================
# Output
# ==============================================================================
[OUTPUT]
format = HDF5
path = output/historical_checkmate_airburst_10kt

save_pressure = true
save_temperature = true
save_density = true
save_velocity = true

save_displacement = true
save_stress = true

save_dose_rate = true
save_accumulated_dose = true

volume_output_frequency = 1000
surface_output_frequency = 200

save_overpressure_contours = true
overpressure_levels = 0.01, 0.03, 0.07, 0.14, 0.35, 0.7, 1.4

[ANALYSIS]
compute_blast_damage = true
compute_thermal_damage = true
compute_radiation_effects = true
compute_fallout_pattern = false
output_damage_map = true
