# Linear Elastic Fracture Mechanics (LEFM) Example
# Hydraulic fracture growth from pressurized well
#
# Demonstrates:
# - Fracture initiation when K_I = K_Ic
# - Propagation based on LEFM: v = f(K_I - K_Ic)
# - Coupled fluid-solid-fracture physics
# - Time evolution of fracture geometry

[SIMULATION]
start_time = 0.0
end_time = 3600.0                     # 1 hour treatment
dt_initial = 1.0                      # 1 second (fine for initiation)
dt_min = 0.1                          # 0.1 second minimum
dt_max = 10.0                         # 10 seconds maximum
max_timesteps = 5000

output_frequency = 60                 # Output every 60 steps
output_format = VTK
enable_checkpointing = true
checkpoint_frequency = 100

# Tight tolerances for accurate LEFM
rtol = 1.0e-7
atol = 1.0e-9
max_nonlinear_iterations = 100
max_linear_iterations = 5000

fluid_model = SINGLE_COMPONENT
solid_model = ELASTIC                 # Linear elasticity for LEFM

enable_geomechanics = true            # Critical for LEFM
enable_thermal = false
enable_fractures = true               # Hydraulic fracture
enable_particle_transport = false
enable_faults = false
enable_tidal_forces = false
adaptive_timestepping = true

[GRID]
# Fine mesh for accurate stress field near wellbore
nx = 80
ny = 80
nz = 40

# Domain: 400m x 400m x 200m
Lx = 400.0
Ly = 400.0
Lz = 200.0

use_unstructured = false

[ROCK]
# Shale formation properties
porosity = 0.05                       # Low porosity (5%)
permeability_x = 0.0001               # 0.1 microDarcy (very tight)
permeability_y = 0.0001
permeability_z = 0.00001

compressibility = 5.0e-10             # 1/Pa

# Elastic properties - critical for LEFM
youngs_modulus = 25.0e9               # 25 GPa (typical shale)
poisson_ratio = 0.20                  # Lower Poisson's ratio
density = 2400.0                      # kg/m³
biot_coefficient = 0.7

# Not using viscoelasticity (pure LEFM)
relaxation_time = 1.0e10
viscosity = 1.0e25

thermal_conductivity = 1.8
heat_capacity = 800.0
thermal_expansion = 8.0e-6

# LEFM fracture parameters - CRITICAL
fracture_toughness = 1.0e6            # K_Ic = 1.0 MPa·m^0.5 (typical shale)
fracture_energy = 40.0                # G_c = 40 J/m² (from K_Ic²/E')

[FLUID]
# Frac fluid (slickwater)
density = 1000.0                      # kg/m³
viscosity = 0.001                     # Pa·s (1 cP, low viscosity)
compressibility = 4.5e-10             # 1/Pa

# Not using multiphase
oil_density_std = 1000.0
gas_density_std = 0.0
water_density_std = 1000.0

oil_viscosity = 0.001
gas_viscosity = 0.00001
water_viscosity = 0.001

solution_GOR = 0.0

[FRACTURE1]
# Initial notch/perforation for stress concentration
type = HYDRAULIC
location = 200.0, 200.0, 100.0, 0.0, 1.0, 0.0  # Center, E-W orientation

# Initial conditions (small notch)
aperture = 0.0001                     # 0.1 mm initial notch
permeability = 1.0e-12                # Initial permeability

# LEFM parameters - drives propagation
toughness = 1.0e6                     # K_Ic = 1.0 MPa·m^0.5
energy = 40.0                         # G_c = 40 J/m²

enable_propagation = true             # Allow LEFM-based growth
enable_proppant = false               # No proppant for pure LEFM demo

[WELL1]
# High-pressure injection well
name = FRAC_WELL
type = INJECTOR
i = 40                                # Grid center
j = 40
k = 20

control_mode = RATE
target_value = 0.05                   # 50 L/s = ~20 bpm (typical)
max_rate = 0.1                        # 100 L/s maximum
min_bhp = 60.0e6                      # 60 MPa maximum BHP

diameter = 0.15                       # 6 inch wellbore
skin = 0.0                            # No skin (perforated)

[BC1]
# Far-field minimum horizontal stress (σ_h)
type = NEUMANN
field = DISPLACEMENT
location = XMIN
value = 0.0
gradient = -30.0e6                    # 30 MPa compressive

[BC2]
type = NEUMANN
field = DISPLACEMENT
location = XMAX
value = 0.0
gradient = 30.0e6

[BC3]
# Far-field maximum horizontal stress (σ_H)
type = NEUMANN
field = DISPLACEMENT
location = YMIN
value = 0.0
gradient = -35.0e6                    # 35 MPa compressive

[BC4]
type = NEUMANN
field = DISPLACEMENT
location = YMAX
value = 0.0
gradient = 35.0e6

[BC5]
# Vertical stress (overburden)
type = NEUMANN
field = DISPLACEMENT
location = ZMAX
value = 0.0
gradient = -40.0e6                    # 40 MPa vertical stress

[BC6]
# Fixed bottom (no vertical displacement)
type = DIRICHLET
field = DISPLACEMENT
location = ZMIN
value = 0.0

[BC7]
# Far-field pore pressure
type = DIRICHLET
field = PRESSURE
location = XMIN
value = 25.0e6                        # 25 MPa pore pressure

[BC8]
type = DIRICHLET
field = PRESSURE
location = XMAX
value = 25.0e6

[BC9]
type = DIRICHLET
field = PRESSURE
location = YMIN
value = 25.0e6

[BC10]
type = DIRICHLET
field = PRESSURE
location = YMAX
value = 25.0e6

[IC1]
# Initial pore pressure (hydrostatic)
field = PRESSURE
distribution = UNIFORM
value = 25.0e6                        # 25 MPa
gradient = 0.0, 0.0, 0.0

[IC2]
# Initial stress state (in equilibrium with BCs)
field = DISPLACEMENT
distribution = UNIFORM
value = 0.0
gradient = 0.0, 0.0, 0.0

# LEFM Theory Background
# ======================
#
# Stress Intensity Factor:
#   K_I = Y * σ * sqrt(π*a)
#   where Y = geometry factor
#         σ = applied stress
#         a = crack half-length
#
# Initiation Criterion:
#   Fracture initiates when K_I = K_Ic
#
# Propagation:
#   Velocity: v = C * (K_I - K_Ic) / K_Ic
#   where C is material constant
#
# Width Profile (Sneddon solution for pressurized crack):
#   w(x) = 4*(1-ν²)/E * sqrt(a² - x²) * (P - σ_min)
#
# Energy Release Rate:
#   G = K_I² * (1 - ν²) / E
#   Propagation when G = G_c
#
# Fracture will propagate perpendicular to minimum principal stress (σ_h = 30 MPa)
# Net pressure = P_frac - σ_min drives width and must overcome toughness
#
# Expected Behavior:
# ------------------
# 1. Pressure builds at wellbore (0-60s)
# 2. K_I increases with pressure
# 3. Initiation when K_I = 1.0 MPa·m^0.5
# 4. Rapid initial propagation
# 5. Slowing as fracture lengthens (K_I decreases)
# 6. Competition between:
#    - Pressure drive (injection rate)
#    - Toughness resistance (K_Ic)
#    - Viscous dissipation (fluid viscosity)
#    - Leak-off (Carter's law)
#
# Scaling Regimes:
# ----------------
# Toughness-dominated:  L ~ t^(4/5)  (PKN)
# Viscosity-dominated:  L ~ t^(4/5)  (different coefficients)
# Leak-off-dominated:   L ~ t^(2/3)
#
# This example is primarily toughness-dominated due to:
# - Low viscosity fluid (1 cP)
# - Low leak-off (tight formation)
# - Moderate K_Ic (1.0 MPa·m^0.5)
