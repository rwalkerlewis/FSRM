# ==============================================================================
# Historical-inspired Example: KINGFISH (Operation Dominic / Fishbowl, 1962)
# ==============================================================================
# Purpose:
# - Provide a second high-altitude "Fishbowl" style configuration alongside
#   `historical_starfish_prime_1962_high_altitude_emp.config`.
# - Focus on EMP + ionospheric disturbance + wide-footprint receiver outputs.
#
# Notes (important):
# - This is an educational, *historical-inspired* scenario, not an authoritative
#   reconstruction.
# - Yields/altitudes are set to representative values for a "high-altitude EMP"
#   case at lower yield than Starfish Prime.
# - For the full EMP/ionosphere knobs and AMR tuning, compare with:
#   - config/atmospheric_nuclear_test_high_altitude_emp_1400kt.config
# ==============================================================================

[SIMULATION]
name = historical_kingfish_1962_emp
description = Kingfish-inspired ~410 kt high-altitude burst focusing on EMP + ionospheric effects

start_time = 0.0
end_time = 120.0

# Keep nanosecond-scale resolution for E1
dt_initial = 1.0e-8
dt_min = 1.0e-10
dt_max = 0.05

adaptive_dt = true
output_frequency = 200
output_format = HDF5
enable_checkpointing = true
checkpoint_frequency = 10000

fluid_model = COMPRESSIBLE_NS
solid_model = ELASTODYNAMIC

enable_atmosphere = true
enable_electromagnetic = true
enable_ionization = true

# Optional modules (kept on for diagnostics; ground coupling is disabled)
enable_radiation = true
enable_thermal = true

coupling_mode = LOOSELY_COUPLED
atmosphere_ground_coupling = false
radiation_thermal_coupling = true
emp_ionization_coupling = true

use_gpu = true
gpu_mode = AUTO

# ------------------------------------------------------------------------------
# Geography: burst region in WGS84 (lon/lat) + local origin
# ------------------------------------------------------------------------------
[GRID]
# Regional domain (meters). Coordinates are in the model CRS.
# Keep this similar to Starfish so plots/receivers are comparable.
nx = 320
ny = 320
nz = 240
Lx = 500000.0
Ly = 500000.0
Lz = 500000.0
origin_x = 0.0
origin_y = 0.0
origin_z = 0.0

# CRS plumbing is optional for the solver, but helps keep "historical" configs consistent
input_crs = EPSG:4326
model_crs = EPSG:32602
use_local_coordinates = true

# Johnston Atoll region (approx) as local origin
local_origin_x = -169.53
local_origin_y = 16.74
local_origin_z = 0.0

# ==============================================================================
# Device
# ==============================================================================
[NUCLEAR_DEVICE]
type = THERMONUCLEAR
yield_kt = 410.0

# Moderate fission fraction for prompt gamma production (tunable)
fission_fraction = 0.35

# High altitude burst (meters above sea level, in model coordinates)
# Representative "~95 km" style altitude (within the 500 km domain).
burst_height = 95000.0
location_x = 250000.0
location_y = 250000.0
location_z = 95000.0

# ==============================================================================
# Atmosphere / Ionosphere
# ==============================================================================
[ATMOSPHERE]
model = EXTENDED
base_profile = US_STANDARD_1976
ground_level = 0.0
top_of_domain = 500000.0
num_layers = 80
layer_type = EXPONENTIAL

[ATMOSPHERE.WIND]
enable_wind = false

[IONOSPHERE]
enabled = true
background_model = IRI
daytime = true

# Keep layers within-domain
D_layer_altitude = 60000.0
E_layer_altitude = 120000.0
F_layer_altitude = 300000.0

xray_ionization = true
enhanced_ionization_duration = 3600.0
compute_radio_blackout = true
frequency_cutoff = 30.0e6

# ==============================================================================
# EMP
# ==============================================================================
[ELECTROMAGNETIC_PULSE]
enabled = true
source_mechanism = COMPTON_CURRENT

[EMP.E1]
enabled = true
pulse_type = FAST
rise_time = 2.5e-9
decay_time = 1.0e-6

# Lower-yield case: peak field reduced vs 1.4 Mt template
peak_field = 30000.0

# Prompt gamma pulse and fluence (tunable)
gamma_emission_time = 100.0e-9
gamma_fluence = 2.0e13
compton_electron_energy = 1.0

geomagnetic_field = 50.0e-6
geomagnetic_dip = 60.0
source_region_altitude = 30000.0
atmosphere_conductivity_profile = EXPONENTIAL

[EMP.E2]
enabled = true
pulse_type = INTERMEDIATE
rise_time = 1.0e-6
duration = 1.0e-3
peak_field = 300.0

[EMP.E3]
enabled = true
pulse_type = SLOW
rise_time = 0.5
duration = 120.0
peak_field = 3.0
fireball_conductivity = 1.0e6
magnetic_field_distortion = true

# ==============================================================================
# Radiation (simplified but enabled for prompt dose-rate diagnostics)
# ==============================================================================
[RADIATION_TRANSPORT]
enabled = true
method = MONTE_CARLO
num_particles = 2000000

[RADIATION_TRANSPORT.PROMPT]
enabled = true
gamma_yield_fraction = 0.006
neutron_yield_fraction = 0.003

# ==============================================================================
# Receivers (EMP field sensors across a wide footprint)
# ==============================================================================
[RECEIVERS]
output_format = HDF5
sampling_rate = 20000.0

[RECEIVER_ARRAY_EMP]
type = LINE
start = 250000.0, 250000.0, 10.0
end = 450000.0, 250000.0, 10.0
num_stations = 32
fields = electric_field_x, electric_field_y, electric_field_z, magnetic_field

# ==============================================================================
# Output
# ==============================================================================
[OUTPUT]
format = HDF5
path = output/historical_kingfish_emp

save_electric_field = true
save_magnetic_field = true
save_induced_current = true
save_dose_rate = true
save_temperature = true

volume_output_frequency = 500
surface_output_frequency = 100
