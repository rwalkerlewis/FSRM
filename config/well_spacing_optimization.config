# =============================================================================
# Well Spacing and Hydraulic Fracture Placement Optimization
# =============================================================================
# This configuration demonstrates optimization of:
# - Well spacing to minimize interference and maximize recovery
# - Hydraulic fracture stage placement
# - Cluster spacing within stages
# - Proppant loading optimization
# - Economic analysis for NPV maximization
#
# The example models an unconventional shale reservoir development with
# multiple horizontal wells and multi-stage hydraulic fracturing.
#
# Key optimization variables:
# 1. Inter-well spacing (distance between parallel horizontal wells)
# 2. Intra-well fracture spacing (stage spacing along lateral)
# 3. Cluster spacing within each stage
# 4. Fracture half-length (controlled by treatment design)
# 5. Proppant concentration and fluid volumes
#
# Usage:
#   ./well_spacing_optimization -c config/well_spacing_optimization.config
#   mpirun -np 4 ./well_spacing_optimization -c config/well_spacing_optimization.config
# =============================================================================

[SIMULATION]
name = well_spacing_optimization
start_time = 0.0
end_time = 315360000.0               # 10 years production (seconds)
dt_initial = 86400.0                 # 1 day
dt_min = 3600.0                      # 1 hour
dt_max = 2592000.0                   # 30 days
max_timesteps = 5000
output_frequency = 30
output_format = HDF5                 # HDF5 (default) or VTK

# Physics configuration
fluid_model = BLACK_OIL
solid_model = POROELASTIC
enable_geomechanics = true
enable_thermal = false
enable_fractures = true
enable_stress_shadowing = true
enable_well_interference = true
enable_production_optimization = true
enable_economic_analysis = true

# Solver settings
rtol = 1.0e-6
atol = 1.0e-8
max_nonlinear_iterations = 50
max_linear_iterations = 2000
adaptive_timestepping = true

# =============================================================================
# OPTIMIZATION SETTINGS
# =============================================================================

[OPTIMIZATION]
enabled = true
objective = MAX_NPV                  # MAX_NPV, MAX_EUR, MAX_IRR, MIN_COST

# Optimization algorithm
algorithm = GRID_SEARCH              # GRID_SEARCH, GRADIENT, GENETIC, BAYESIAN
max_iterations = 100
convergence_tolerance = 1.0e-4

# Parameter bounds for well spacing (m)
well_spacing_min = 150.0             # 150 m (~500 ft) minimum
well_spacing_max = 450.0             # 450 m (~1500 ft) maximum
well_spacing_step = 30.0             # 30 m step for grid search

# Parameter bounds for stage spacing (m)
stage_spacing_min = 30.0             # 30 m (~100 ft)
stage_spacing_max = 90.0             # 90 m (~300 ft)
stage_spacing_step = 10.0

# Parameter bounds for cluster spacing (m)
cluster_spacing_min = 6.0            # 6 m (~20 ft)
cluster_spacing_max = 18.0           # 18 m (~60 ft)
cluster_spacing_step = 3.0

# Parameter bounds for fracture half-length (m)
frac_half_length_min = 75.0          # 75 m (~250 ft)
frac_half_length_max = 225.0         # 225 m (~750 ft)
frac_half_length_step = 25.0

# Constraints
max_wells_per_section = 8
min_wells_per_section = 2
section_width = 1609.34              # 1 mile (m)
section_length = 1609.34             # 1 mile (m)

# =============================================================================
# GRID - Development Section
# =============================================================================

[GRID]
nx = 160
ny = 160
nz = 10

# Domain: 1 mile x 1 mile x 60 m thick pay zone
Lx = 1609.34                         # 1 mile = 1609.34 m
Ly = 1609.34                         # 1 mile
Lz = 60.0                            # Pay zone thickness

mesh_type = CARTESIAN
use_unstructured = false

# Local grid refinement around wells (optional)
enable_lgr = false

# =============================================================================
# ROCK PROPERTIES - Unconventional Shale
# =============================================================================

[ROCK]
formation_name = WOLFCAMP_SHALE
constitutive_model = POROELASTIC

# Matrix properties (tight shale)
porosity = 0.06                      # 6% porosity
permeability_x = 0.0001              # 100 nanodarcy
permeability_y = 0.0001              # 100 nanodarcy
permeability_z = 0.00001             # 10 nanodarcy (vertical)
compressibility = 5.0e-10            # 1/Pa

# Mechanical properties
density = 2550.0                     # kg/m³
youngs_modulus = 35.0e9              # 35 GPa
poisson_ratio = 0.22
biot_coefficient = 0.75

# Fracture properties
tensile_strength = 6.0e6             # 6 MPa
fracture_toughness = 1.2e6           # 1.2 MPa·m^0.5
fracture_energy = 50.0               # J/m²

# Stress-dependent permeability
permeability_model = EXPONENTIAL
permeability_stress_coeff = 1.5e-8   # Stress sensitivity

# =============================================================================
# IN-SITU STRESS (for stress shadowing calculations)
# =============================================================================

[STRESS]
# Reference depth and stress gradients
reference_depth = 2500.0             # 2500 m TVD (~8200 ft)

# In-situ stresses at reference depth
shmin = 40.0e6                       # Minimum horizontal stress (Pa)
shmax = 48.0e6                       # Maximum horizontal stress (Pa)
sv = 55.0e6                          # Vertical stress (Pa)
pore_pressure = 32.0e6               # Pore pressure (Pa)

# Stress gradients (Pa/m)
shmin_gradient = 16.3e3              # ~0.72 psi/ft
shmax_gradient = 19.3e3              # ~0.85 psi/ft
sv_gradient = 22.6e3                 # ~1.0 psi/ft (overburden)
pp_gradient = 10.2e3                 # ~0.45 psi/ft (normal pressure)

# Stress orientation
shmax_azimuth = 45.0                 # N45E azimuth for SHmax

# =============================================================================
# FLUID PROPERTIES - Light Oil/Condensate
# =============================================================================

[FLUID]
type = BLACK_OIL

# Oil properties
oil_density_std = 780.0              # kg/m³ at standard conditions (45 API)
oil_viscosity = 0.0015               # Pa·s (1.5 cP)
oil_compressibility = 1.5e-9         # 1/Pa
oil_fvf = 1.35                       # Formation volume factor

# Gas properties
gas_density_std = 0.75               # kg/m³
gas_viscosity = 0.000015             # Pa·s (0.015 cP)
gas_compressibility = 2.0e-8         # 1/Pa
gas_fvf = 0.004                      # At reservoir conditions

# Water properties
water_density_std = 1050.0           # Formation brine
water_viscosity = 0.0008             # Pa·s (0.8 cP)
water_compressibility = 4.5e-10      # 1/Pa

# PVT
solution_gor = 600.0                 # scf/stb
bubble_point_pressure = 25.0e6       # Pa

# =============================================================================
# WELL CONFIGURATION - Template for Optimization
# =============================================================================
# The optimizer will create multiple wells based on these templates
# and the spacing parameters being optimized

[WELL_TEMPLATE]
well_type = HORIZONTAL
trajectory_type = GEOMETRIC          # Simple horizontal
vertical_depth = 2500.0              # Landing TVD (m)
lateral_length = 2400.0              # 2400 m (~8000 ft) lateral
lateral_azimuth = 90.0               # E-W lateral direction (perpendicular to SHmax)

# Wellbore properties
casing_id = 0.114                    # 4.5" casing ID (m)
casing_od = 0.127                    # 5" casing OD (m)
roughness = 0.0001                   # Pipe roughness (m)

# Completion
completion_type = PLUG_AND_PERF
perfs_per_cluster = 4
perforation_diameter = 0.0095        # 0.37" perfs
perforation_phasing = 60             # degrees

# Production constraints
max_oil_rate = 500.0                 # m³/day (~3150 bbl/day) per well
min_bhp = 7.0e6                      # Minimum BHP (Pa)
max_gas_rate = 500000.0              # m³/day
max_water_rate = 200.0               # m³/day

# Initial production target
initial_control = BHP
initial_bhp = 10.0e6                 # 10 MPa drawdown from ~32 MPa res pressure

# =============================================================================
# HYDRAULIC FRACTURE TEMPLATE - For Each Stage
# =============================================================================

[FRACTURE_TEMPLATE]
type = HYDRAULIC
model = P3D                          # PKN, KGD, or P3D

# Fracture geometry targets (from optimization or design)
target_half_length = 150.0           # 150 m target half-length
target_height = 50.0                 # 50 m (limited by barriers)
target_conductivity = 5.0e-12        # m³ (= 5000 mD·ft)

# Fracture properties
initial_aperture = 0.003             # 3 mm propped width
toughness = 1.2e6                    # Pa·m^0.5
energy = 50.0                        # J/m²

# Proppant
enable_proppant = true
proppant_type = 40_70_SAND
proppant_density = 2650.0            # kg/m³
proppant_diameter = 0.0003           # 300 micron
proppant_concentration = 600.0       # kg/m³ (~5 ppa average)
proppant_porosity = 0.35

# Proppant permeability at closure (stress vs perm)
proppant_perm_data = """
stress_mpa, permeability_darcy
20.0, 100.0
30.0, 50.0
40.0, 25.0
50.0, 12.0
60.0, 6.0
"""

# Leak-off
enable_leakoff = true
leakoff_coefficient = 5.0e-5         # m/s^0.5 (Carter)
spurt_loss = 0.001                   # m³/m² initial loss

# =============================================================================
# STAGE DESIGN TEMPLATE
# =============================================================================

[STAGE_TEMPLATE]
clusters_per_stage = 4               # Baseline (optimizable)

# Treatment schedule per stage
pad_volume = 150.0                   # m³ (~950 bbl)
pad_rate = 0.13                      # m³/s (~50 bpm)

# Proppant stages
proppant_schedule = """
stage, volume_m3, concentration_kg_m3, rate_m3_s
1, 50, 120, 0.13
2, 60, 240, 0.13
3, 60, 360, 0.13
4, 70, 480, 0.12
5, 70, 600, 0.12
6, 50, 600, 0.10
"""

flush_volume = 25.0                  # m³
flush_rate = 0.10                    # m³/s

# Total per stage: ~510 m³ fluid, ~80,000 kg proppant

# =============================================================================
# STRESS SHADOWING MODEL
# =============================================================================

[STRESS_SHADOWING]
enabled = true
calculation_method = RECTANGULAR_DDM  # SNEDDON_PENNY or RECTANGULAR_DDM
update_frequency = 1                  # Recalculate every timestep
include_poroelastic = true

# Stress shadow effect modeling
max_stress_shadow_distance = 500.0   # m - beyond this, ignore
critical_stress_increase = 2.0e6     # Pa - significant shadow threshold

# Inter-fracture effects
model_fracture_interaction = true
interaction_matrix_update = DYNAMIC  # STATIC or DYNAMIC

# =============================================================================
# WELL INTERFERENCE MODEL
# =============================================================================

[WELL_INTERFERENCE]
enabled = true

# Pressure interference
pressure_interference_model = SUPERPOSITION
boundary_effects = true

# Fracture communication
frac_hit_detection = true
frac_hit_threshold = 0.1             # 10% communication = frac hit

# Interference EUR reduction model
# EUR_multi = EUR_single * f(spacing/frac_length)
interference_model = HYPERBOLIC
# Parameters: EUR_ratio = 1 - a / (1 + b * (spacing / frac_length))
interference_a = 0.4                 # Max EUR reduction (40%)
interference_b = 2.0                 # Decay rate

# Parent-child well effects (if applicable)
parent_child_modeling = false

# =============================================================================
# PRODUCTION MODEL
# =============================================================================

[PRODUCTION_MODEL]
# Decline curve parameters (for rapid screening)
decline_model = MODIFIED_HYPERBOLIC
initial_decline_rate = 0.08          # 8% per month initially
b_factor = 1.2                       # Hyperbolic b factor
terminal_decline_rate = 0.005        # 0.5% per month terminal

# Flowing material balance
enable_flowing_material_balance = true
connected_pore_volume_fraction = 0.15

# GOR evolution
initial_gor = 600.0                  # scf/stb
gor_increase_rate = 0.1              # 10% per year

# Water cut evolution  
initial_water_cut = 0.1              # 10% initial
final_water_cut = 0.6                # 60% ultimate
water_cut_time_constant = 730.0      # days to reach 50% of final

# =============================================================================
# ECONOMIC ANALYSIS
# =============================================================================

[ECONOMICS]
enabled = true
evaluation_period = 30.0             # 30 year evaluation
discount_rate = 0.10                 # 10% annual discount rate
working_interest = 1.0               # 100% WI for comparison

# Commodity prices (base case)
oil_price = 75.0                     # $/bbl
gas_price = 3.50                     # $/mcf
ngl_price = 30.0                     # $/bbl
ngl_yield = 50.0                     # bbl NGL / MMcf gas

# Price scenarios for sensitivity
oil_price_low = 50.0                 # $/bbl
oil_price_high = 100.0               # $/bbl
gas_price_low = 2.50                 # $/mcf
gas_price_high = 5.00                # $/mcf

# Drilling costs
drilling_cost_vertical = 1500000.0   # $ for vertical section
drilling_cost_per_meter_lateral = 400.0  # $/m lateral
total_drilling_days = 25             # days
rig_rate_per_day = 35000.0           # $/day

# Completion costs
completion_cost_per_stage = 100000.0 # $ per stage
proppant_cost_per_kg = 0.18          # $/kg (~$0.08/lb)
fluid_cost_per_m3 = 3.00             # $/m³ (~$0.50/bbl)
perforation_cost_per_cluster = 5000.0  # $ per cluster
plug_cost = 15000.0                  # $ per plug

# Facilities
facilities_cost_per_well = 200000.0  # $ per well
pipeline_cost_per_meter = 150.0      # $/m to sales

# Operating costs
fixed_opex_per_well = 3000.0         # $/month per well
loe_per_boe = 8.0                    # $/BOE lifting cost
water_disposal_cost = 1.50           # $/bbl water

# Taxes and royalties
severance_tax_rate = 0.046           # 4.6% (Texas)
royalty_rate = 0.25                  # 25% royalty burden
ad_valorem_rate = 0.02               # 2% ad valorem

# Economic limits
economic_limit_oil = 1.0             # bbl/day (single well)
economic_limit_gas = 5.0             # mcf/day

# =============================================================================
# SENSITIVITY ANALYSIS
# =============================================================================

[SENSITIVITY]
enabled = true

# Parameters for tornado chart
sensitivity_parameters = """
parameter, low_mult, high_mult
oil_price, 0.67, 1.33
well_spacing, 0.75, 1.25
stage_spacing, 0.75, 1.25
drilling_cost, 0.80, 1.20
completion_cost, 0.80, 1.20
eur, 0.80, 1.20
"""

# Monte Carlo settings
monte_carlo_enabled = true
monte_carlo_iterations = 1000
monte_carlo_seed = 42

# Uncertain variables for Monte Carlo
uncertain_variables = """
variable, distribution, param1, param2
oil_price, LOGNORMAL, 75.0, 15.0
eur_multiplier, NORMAL, 1.0, 0.15
drilling_cost, TRIANGULAR, 0.9, 1.0, 1.2
completion_cost, TRIANGULAR, 0.85, 1.0, 1.15
"""

# =============================================================================
# BOUNDARY CONDITIONS
# =============================================================================

[BC1]
type = DIRICHLET
field = PRESSURE
location = MODEL_BOUNDARY
value = 32.0e6                       # Far-field reservoir pressure

[BC2]
type = DIRICHLET
field = DISPLACEMENT
location = MODEL_BOUNDARY
value = 0.0                          # Fixed far-field

# =============================================================================
# INITIAL CONDITIONS
# =============================================================================

[IC1]
field = PRESSURE
distribution = GRADIENT
value = 32.0e6                       # Reference pressure at datum
gradient = 0, 0, 10200               # Hydrostatic gradient (Pa/m)

[IC2]
field = SATURATION_OIL
distribution = UNIFORM
value = 0.70                         # 70% oil saturation

[IC3]
field = SATURATION_WATER
distribution = UNIFORM
value = 0.25                         # 25% connate water

[IC4]
field = SATURATION_GAS
distribution = UNIFORM
value = 0.05                         # 5% free gas (above bubble point)

# =============================================================================
# OUTPUT SETTINGS
# =============================================================================

[OUTPUT]
format = HDF5                        # HDF5 or VTK
path = output/well_spacing_optimization
frequency = 30                       # Output every 30 timesteps

# Field outputs
output_pressure = true
output_saturation = true
output_displacement = true
output_stress = true
output_permeability = true
output_fracture_geometry = true
output_well_rates = true

# Optimization outputs
output_optimization_history = true
output_response_surface = true
output_sensitivity_tornado = true
output_monte_carlo_distribution = true

# Economics outputs
output_npv_map = true
output_cashflow = true
output_rate_schedule = true

# =============================================================================
# WELL CONFIGURATIONS FOR OPTIMIZATION SWEEP
# =============================================================================
# These are specific configurations to evaluate in the grid search
# The optimizer will interpolate/evaluate between these

[SCENARIO_BASELINE]
name = baseline
num_wells = 4
well_spacing = 300.0                 # m
stage_spacing = 60.0                 # m
cluster_spacing = 12.0               # m
clusters_per_stage = 4
frac_half_length = 150.0             # m

[SCENARIO_TIGHT]
name = tight_spacing
num_wells = 6
well_spacing = 200.0                 # m
stage_spacing = 45.0                 # m
cluster_spacing = 9.0                # m
clusters_per_stage = 5
frac_half_length = 120.0             # m

[SCENARIO_WIDE]
name = wide_spacing
num_wells = 3
well_spacing = 400.0                 # m
stage_spacing = 75.0                 # m
cluster_spacing = 15.0               # m
clusters_per_stage = 3
frac_half_length = 180.0             # m

[SCENARIO_AGGRESSIVE]
name = aggressive_completion
num_wells = 5
well_spacing = 250.0                 # m
stage_spacing = 50.0                 # m
cluster_spacing = 10.0               # m
clusters_per_stage = 5
frac_half_length = 200.0             # m

# =============================================================================
# NOTES
# =============================================================================
# 
# OPTIMIZATION APPROACH:
# ----------------------
# 1. Grid Search: Evaluates discrete combinations of spacing parameters
#    - Well spacing: 150, 180, ..., 450 m (11 values)
#    - Stage spacing: 30, 40, ..., 90 m (7 values)
#    - This creates ~77 scenarios per well count configuration
#
# 2. Response Surface: Builds interpolated surface of NPV vs parameters
#    - Can identify optimal region between grid points
#    - Useful for visualization and communication
#
# 3. Key Trade-offs:
#    - Tighter spacing → more wells → higher EUR but higher cost and interference
#    - Wider spacing → fewer wells → lower cost but potentially undrainable rock
#    - Longer fracs → more contact but stress shadow and cost
#    - More clusters → better distribution but limited entry issues
#
# INTERFERENCE EFFECTS MODELED:
# ----------------------------
# 1. Pressure interference: Superposition of pressure sinks
# 2. Stress shadowing: Reduced fracture initiation pressure
# 3. Frac hits: Communication between wells through fractures
# 4. Production interference: Reduced EUR per well with tighter spacing
#
# EXPECTED OPTIMAL REGION (typical Permian):
# -----------------------------------------
# - Well spacing: 200-300 m (660-1000 ft)
# - Stage spacing: 45-60 m (150-200 ft)
# - Cluster spacing: 9-15 m (30-50 ft)
# - Frac half-length: 120-180 m (400-600 ft)
#
# REFERENCE VALUES:
# -----------------
# - Single well EUR (isolated): ~300-500 MBOE
# - D&C cost per well: $6-10 MM
# - NPV per well (base oil price): $2-5 MM
# - Section NPV (4-6 wells): $10-25 MM
#
# =============================================================================
