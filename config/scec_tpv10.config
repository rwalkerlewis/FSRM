# SCEC TPV10 Configuration
# Dynamic Rupture with Branching Fault

[SIMULATION]
name = SCEC_TPV10_BranchingFault
start_time = 0.0
end_time = 15.0                   # 15 seconds
dt_initial = 0.005                # 5 ms
dt_min = 0.0001
dt_max = 0.01
max_time_steps = 6000
output_frequency = 20
output_format = HDF5
output_dir = output/scec_tpv10

# Physics models
fluid_model = NONE
enable_geomechanics = true
enable_elastodynamics = true
enable_faults = true
enable_fault_branching = true

# Solver settings
time_integration = NEWMARK_BETA
newmark_beta = 0.25
newmark_gamma = 0.5
rtol = 1.0e-6
atol = 1.0e-8
max_iterations = 30

[GRID]
type = CARTESIAN
# Same domain as TPV5
nx = 192
ny = 192
nz = 96
Lx = 48000.0
Ly = 48000.0
Lz = 24000.0

# Extra refinement near branch junction
use_adaptive_refinement = true
refinement_zone_x = 18000, 30000
refinement_zone_y = 18000, 30000
refinement_factor = 3             # Higher resolution for branch

[ROCK]
# Same elastic properties as TPV5
density = 2670.0
shear_modulus = 32.04e9
lame_lambda = 32.04e9
youngs_modulus = 80.0e9
poisson_ratio = 0.25

[FAULT1]
# Main strike-slip fault (same as TPV5)
name = MainFault
type = DYNAMIC_RUPTURE

location = 24000, 24000, 0
strike = 0.0
dip = 90.0
length = 30000.0
width = 15000.0

# Rate-and-state friction on main fault
friction_law = RATE_AND_STATE
reference_friction = 0.6
a_parameter = 0.008               # Direct effect
b_parameter = 0.012               # Evolution effect
Dc_parameter = 0.02               # Critical slip distance (m)
V0 = 1.0e-6                       # Reference slip rate (m/s)
f0 = 0.6                          # Reference friction

# Initial stress
initial_shear_stress = 81.6e6
initial_normal_stress = -120.0e6

# Nucleation patch
nucleation_type = SQUARE_ASPERITY
nucleation_center = -6000, 0, -7500   # 6 km before branch point
nucleation_radius = 1500.0
forced_rupture_time = 0.5
forced_rupture_duration = 0.3

[FAULT2]
# Branch fault at 30° angle
name = BranchFault
type = DYNAMIC_RUPTURE

# Branch point: 18 km from left edge of main fault
# Branch extends at 30° from main fault
branch_from_fault = MainFault
branch_point = 18000, 24000, -7500    # Junction point
branch_angle = 30.0                   # degrees from main fault
branch_length = 15000.0               # 15 km
branch_width = 15000.0                # Full seismogenic width

# Same friction law as main fault
friction_law = RATE_AND_STATE
reference_friction = 0.6
a_parameter = 0.008
b_parameter = 0.012
Dc_parameter = 0.02
V0 = 1.0e-6
f0 = 0.6

# Initial stress on branch (optimally oriented for rupture propagation)
initial_shear_stress = 75.0e6     # Lower than main fault
initial_normal_stress = -120.0e6

# Branch activation threshold
activation_stress_threshold = 70.0e6   # Minimum stress for branch rupture

[BOUNDARY]
boundary_type = ABSORBING

[BC1]
type = FREE_SURFACE
location = ZMAX
field = DISPLACEMENT

[BC2]
type = ABSORBING
location = XMIN, XMAX, YMIN, YMAX, ZMIN
field = DISPLACEMENT
absorbing_type = PML

[RECEIVERS]
num_receivers = 15

# Stations along main fault
receiver1_location = 12000, 24000, 0
receiver2_location = 18000, 24000, 0     # At branch point
receiver3_location = 24000, 24000, 0
receiver4_location = 30000, 24000, 0

# Stations along branch fault projection
receiver5_location = 21000, 28000, 0     # On branch side
receiver6_location = 24000, 31000, 0
receiver7_location = 27000, 34000, 0

# Stations on opposite side
receiver8_location = 21000, 20000, 0
receiver9_location = 24000, 17000, 0

# Far-field stations
receiver10_location = 18000, 36000, 0
receiver11_location = 30000, 36000, 0
receiver12_location = 36000, 24000, 0
receiver13_location = 24000, 12000, 0
receiver14_location = 12000, 12000, 0
receiver15_location = 36000, 36000, 0

output_velocity = true
output_displacement = true

[OUTPUT]
save_displacement = true
save_velocity = true
save_stress = true
save_slip = true
save_slip_rate = true
save_rupture_time = true
save_branch_activation_time = true    # Time when branch starts slipping
save_branch_slip_fraction = true      # Fraction of branch that ruptures

# Detailed fault output
save_volume_data = true
save_surface_data = true
save_fault_data = true

# Analysis of branch interaction
compute_branch_metrics = true

[VERIFICATION]
enable_verification = true
reference_solution_dir = data/scec_tpv10_reference
# TPV10 is known for large variability between codes
tolerance_slip = 0.2              # 20% tolerance
tolerance_rupture_time = 0.3
