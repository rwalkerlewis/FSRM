# SCEC LOH.1 Configuration
# Layer Over Halfspace - Wave Propagation Verification

[SIMULATION]
name = SCEC_LOH1_WavePropagation
start_time = 0.0
end_time = 9.0                    # 9 seconds
dt_initial = 0.008                # 8 ms
dt_min = 0.001                    # 1 ms  
dt_max = 0.01                     # 10 ms
max_time_steps = 2000
output_frequency = 10             # Every 0.08 seconds
output_format = HDF5
output_dir = output/scec_loh1

# Physics models
fluid_model = NONE
enable_geomechanics = true
enable_elastodynamics = true
enable_faults = false

# Solver settings
time_integration = NEWMARK_BETA
newmark_beta = 0.25
newmark_gamma = 0.5
rtol = 1.0e-6
atol = 1.0e-8
max_iterations = 20

[GRID]
type = CARTESIAN
# Domain: 30 km × 30 km × 17 km
nx = 150                          # 200 m cell size
ny = 150
nz = 85                           # 200 m cell size
Lx = 30000.0                      # meters
Ly = 30000.0
Lz = 17000.0

# Mesh refinement near source and receivers
use_adaptive_refinement = true
refinement_zone_x = 12000, 18000
refinement_zone_y = 12000, 18000
refinement_zone_z = 0, 4000       # Near source depth
refinement_factor = 2

[ROCK]
# Layered material properties
# Layer 1: 0-1 km depth (from surface at z=0)
# Halfspace: >1 km depth

use_layered_materials = true
num_layers = 2

# Layer 1: Sedimentary layer (0-1 km)
[LAYER1]
z_top = 0.0
z_bottom = 1000.0
density = 2600.0                  # kg/m³

# V_p = 4000 m/s, V_s = 2000 m/s
# μ = ρ V_s² = 2600 × 2000² = 10.4 GPa
# λ + 2μ = ρ V_p² = 2600 × 4000² = 41.6 GPa
# λ = 41.6 - 2×10.4 = 20.8 GPa

shear_modulus = 10.4e9            # Pa
lame_lambda = 20.8e9              # Pa
poisson_ratio = 0.333             # (λ/2(λ+μ))

# For reference:
# V_p = sqrt((λ + 2μ)/ρ) = 4000 m/s
# V_s = sqrt(μ/ρ) = 2000 m/s

# Quality factors (attenuation)
quality_factor_P = 10000.0        # High Q = low attenuation
quality_factor_S = 10000.0

# Layer 2: Basement halfspace (>1 km)
[LAYER2]
z_top = 1000.0
z_bottom = 17000.0
density = 2700.0                  # kg/m³

# V_p = 6000 m/s, V_s = 3464 m/s
# μ = ρ V_s² = 2700 × 3464² = 32.04 GPa
# λ = 32.04 GPa (for ν = 0.25)

shear_modulus = 32.04e9           # Pa
lame_lambda = 32.04e9             # Pa
poisson_ratio = 0.25

quality_factor_P = 10000.0
quality_factor_S = 10000.0

[SOURCE]
# Point explosion source
source_type = EXPLOSION
source_mechanism = MOMENT_TENSOR

# Source location: 15 km, 15 km, 2 km depth
source_location = 15000, 15000, 2000

# Source time function: Ricker wavelet
time_function = RICKER
dominant_frequency = 2.0          # Hz (f0 = 2 Hz)
source_duration = 1.0             # seconds

# Moment magnitude
moment_magnitude = 4.0            # M_w = 4.0
seismic_moment = 1.0e15           # N⋅m (derived from M_w)

# Explosion moment tensor (isotropic)
M_xx = 1.0
M_yy = 1.0
M_zz = 1.0
M_xy = 0.0
M_xz = 0.0
M_yz = 0.0

[RECEIVERS]
# 10 receivers at free surface
num_receivers = 10

# Receivers along x-axis at surface (y = 15 km, z = 0)
receiver1_location = 3000, 15000, 0      # 12 km from source
receiver2_location = 6000, 15000, 0      # 9 km
receiver3_location = 9000, 15000, 0      # 6 km
receiver4_location = 12000, 15000, 0     # 3 km
receiver5_location = 15000, 15000, 0     # Directly above source
receiver6_location = 18000, 15000, 0     # 3 km
receiver7_location = 21000, 15000, 0     # 6 km
receiver8_location = 24000, 15000, 0     # 9 km
receiver9_location = 27000, 15000, 0     # 12 km

# One off-axis receiver
receiver10_location = 15000, 21000, 0    # 6 km perpendicular

# Output 3-component velocity (primary observable)
output_velocity = true
output_displacement = true
output_acceleration = false

# High-frequency sampling for waveforms
receiver_sampling_rate = 0.005    # 5 ms (200 Hz)

[BOUNDARY]
# Free surface at top
[BC1]
type = FREE_SURFACE
location = ZMAX                   # z = 0 (top)
field = DISPLACEMENT

# Absorbing boundaries on sides and bottom
[BC2]
type = ABSORBING
location = XMIN, XMAX, YMIN, YMAX, ZMIN
field = DISPLACEMENT
absorbing_type = PML
pml_thickness = 10                # 10 cells (2 km)
pml_strength = 1.0

[OUTPUT]
save_displacement = true
save_velocity = true
save_stress = false               # Not needed for wave propagation
save_strain = false

# Visualization
save_volume_data = true
save_surface_data = true          # Surface motion

# Seismogram output
save_seismograms = true
seismogram_format = ASCII         # For easy comparison
seismogram_components = VX, VY, VZ

# Wave snapshots
save_wavefield_snapshots = true
snapshot_interval = 0.5           # Every 0.5 seconds

[VERIFICATION]
# Compare with SCEC reference solutions
enable_verification = true
reference_solution_dir = data/scec_loh1_reference

# LOH.1 reference solutions available from multiple codes
# Verify against analytical solution where available

# Tolerances (LOH.1 has tight tolerances)
tolerance_peak_velocity = 0.05    # 5% on peak velocity
tolerance_arrival_time = 0.05     # 0.05 second on arrival time
tolerance_waveform = 0.10         # 10% RMS waveform error

# Metrics to compute
compute_arrival_times = true      # P-wave, S-wave arrivals
compute_peak_values = true        # Peak velocity/displacement
compute_spectral_content = true   # Fourier spectra
compute_phase_velocity = true     # Apparent phase velocity

[ANALYSIS]
# Analysis specific to LOH.1
enable_wave_analysis = true

# Measure:
# - P-wave arrival time and amplitude
# - S-wave arrival time and amplitude  
# - Surface wave dispersion
# - Reflection/refraction at layer boundary

# Theoretical travel times (for validation)
# Direct P: t = distance / V_p(halfspace)
# Direct S: t = distance / V_s(halfspace)
# Layer-reflected phases
# Head waves along interface

compute_theoretical_times = true
plot_comparison = true            # Generate comparison plots
