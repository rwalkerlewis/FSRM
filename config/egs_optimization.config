# Enhanced Geothermal System (EGS) Optimization Configuration
# Multi-objective optimization with stochastic subsurface representation
#
# This configuration sets up an EGS optimization problem that considers:
# - Stochastic permeability fields with spatial correlation
# - Discrete fracture networks
# - Pre-existing fault networks for seismicity modeling
# - Multi-objective optimization (thermal power, NPV, seismicity)
# - Monte Carlo uncertainty quantification
#
# Usage:
#   ./egs_optimization -c config/egs_optimization.config
#   ./egs_optimization -c config/egs_optimization.config -mc 50 -quick
#   mpirun -np 4 ./egs_optimization -c config/egs_optimization.config

[SIMULATION]
# Simulation control
start_time = 0.0
end_time = 946080000.0               # 30 years in seconds
operation_years = 30.0               # Operation period for economics
dt_initial = 86400.0                 # 1 day
dt_min = 3600.0                      # 1 hour
dt_max = 2592000.0                   # 30 days
max_timesteps = 10000

# Output settings
output_frequency = 50
output_format = HDF5
enable_checkpointing = true
checkpoint_frequency = 100
output_dir = output/egs_optimization

# Solver settings
rtol = 1.0e-5
atol = 1.0e-7
max_nonlinear_iterations = 100
max_linear_iterations = 5000

# Physics models
fluid_model = SINGLE_COMPONENT       # Hot water
solid_model = THERMOELASTIC

# Enable coupled physics
enable_geomechanics = true           # Mechanical deformation
enable_thermal = true                # Heat transport - essential for EGS
enable_fractures = true              # Discrete fracture network
enable_faults = true                 # Pre-existing faults for seismicity
enable_particle_transport = false
enable_tidal_forces = false
adaptive_timestepping = true

[GRID]
# Domain: 2 km x 2 km x 1.5 km deep reservoir
nx = 40
ny = 40
nz = 30
Lx = 2000.0                          # m - domain width (E-W)
Ly = 2000.0                          # m - domain length (N-S)
Lz = 1500.0                          # m - domain depth

# Mesh type
use_unstructured = false
mesh_refinement = none

[ROCK]
# Granite basement properties (typical EGS host rock)
porosity = 0.01                      # 1% matrix porosity (very low)
permeability_x = 1.0e-18             # m² (~1 nanodarcy - very tight)
permeability_y = 1.0e-18
permeability_z = 5.0e-19             # Slightly lower vertical perm

compressibility = 3.0e-10            # 1/Pa - very stiff rock

# Mechanical properties - crystalline basement
youngs_modulus = 50.0e9              # 50 GPa (stiff granite)
poisson_ratio = 0.25
density = 2650.0                     # kg/m³
biot_coefficient = 0.5               # Low due to low porosity

# Thermal properties - critical for EGS performance
thermal_conductivity = 3.0           # W/(m·K) - granite
heat_capacity = 790.0                # J/(kg·K)
thermal_expansion = 8.0e-6           # 1/K - thermal stress important

# Fracture/failure properties
fracture_toughness = 2.0e6           # Pa·m^0.5 - high for granite
fracture_energy = 200.0              # J/m²
tensile_strength = 10.0e6            # 10 MPa

[FLUID]
# Hot geothermal brine properties
density = 900.0                      # kg/m³ (hot water less dense)
viscosity = 0.00015                  # Pa·s (~0.15 cP at 200°C)
compressibility = 5.0e-10            # 1/Pa

# Thermal properties
fluid_thermal_conductivity = 0.65    # W/(m·K)
fluid_heat_capacity = 4180.0         # J/(kg·K)

# Not using black oil model
oil_density_std = 900.0
gas_density_std = 0.1
water_density_std = 900.0
oil_viscosity = 0.00015
gas_viscosity = 0.00001
water_viscosity = 0.00015
solution_GOR = 0.0

[THERMAL]
# Initial reservoir temperature
reservoir_temperature = 200.0        # °C - typical EGS target
surface_temperature = 15.0           # °C
geothermal_gradient = 0.035          # °C/m (35°C/km)

# Injection temperature
injection_temperature = 40.0         # °C - reinjection after heat extraction

# Thermal recovery parameters
min_production_temperature = 100.0   # °C - minimum useful temperature
thermal_breakthrough_threshold = 10.0 # °C drop from initial

[STOCHASTIC]
# Geostatistical parameters for subsurface uncertainty

# Permeability field (log-normal distribution)
mean_log_permeability = -15.0        # log10(k in m²) = -15 → k = 1e-15 m²
variance_log_permeability = 1.0      # 1 order of magnitude std
correlation_length = 100.0           # m - spatial correlation

# Porosity variation
mean_porosity = 0.01
variance_porosity = 0.0001

# Thermal conductivity variation
mean_thermal_conductivity = 3.0      # W/(m·K)
variance_thermal_conductivity = 0.09 # (0.3)² std

# Discrete fracture network (DFN)
fracture_density_p32 = 0.01          # m²/m³ - fracture intensity
mean_fracture_length = 100.0         # m
std_fracture_length = 30.0           # m
mean_fracture_height = 80.0          # m
std_fracture_height = 25.0           # m
mean_fracture_aperture = 5.0e-4      # m (0.5 mm)
preferred_fracture_strike = 45.0     # degrees from N
fracture_strike_std = 20.0           # degrees
preferred_fracture_dip = 80.0        # degrees from horizontal
fracture_dip_std = 10.0              # degrees

# Fault network for induced seismicity
fault_density = 0.001                # faults/m² (area density)
mean_fault_length = 500.0            # m
mean_fault_width = 300.0             # m
stress_gradient = 26000.0            # Pa/m (lithostatic)
pore_pressure_gradient = 10000.0     # Pa/m (hydrostatic)

# Monte Carlo settings
num_realizations = 20                # Number of stochastic realizations
random_seed = 42                     # For reproducibility

[OPTIMIZATION]
# Well placement optimization bounds
well_spacing_min = 300.0             # m - minimum well separation
well_spacing_max = 800.0             # m - maximum well separation
well_spacing_step = 100.0            # m - grid search step

# Injection rate optimization bounds
injection_rate_min = 0.02            # m³/s (20 L/s)
injection_rate_max = 0.10            # m³/s (100 L/s)
injection_rate_step = 0.02           # m³/s

# Well configuration options
max_injectors = 2
max_producers = 2
min_injectors = 1
min_producers = 1

# Objective weights (for weighted sum approach)
weight_thermal_power = 0.40          # Maximize thermal extraction
weight_npv = 0.40                    # Maximize economic return
weight_seismicity = 0.20             # Minimize induced seismicity risk

# Risk preferences
seismicity_threshold_mw = 2.0        # Traffic light threshold
confidence_level = 0.90              # P90 for risk metrics

[ECONOMICS]
# Capital costs
drilling_cost_per_well = 10.0e6      # $ per well (including completion)
stimulation_cost = 5.0e6             # $ for hydraulic stimulation
power_plant_cost_per_kwe = 2000.0    # $/kWe installed capacity
surface_facilities = 2.0e6           # $ for surface infrastructure

# Operating costs
operating_cost_fraction = 0.05       # 5% of CAPEX annually
pumping_cost = 0.05                  # $/kWh for circulation

# Revenue parameters
electricity_price = 80.0             # $/MWh
capacity_factor = 0.90               # Plant availability
thermal_to_electric_efficiency = 0.12 # Binary cycle efficiency

# Financial parameters
discount_rate = 0.08                 # 8% real discount rate
project_lifetime = 30                # years
tax_rate = 0.25                      # Corporate tax rate
depreciation_years = 10              # MACRS depreciation

# Incentives (optional)
production_tax_credit = 0.0          # $/kWh (e.g., 0.027 for US PTC)
investment_tax_credit = 0.0          # Fraction of CAPEX

[SEISMICITY]
# Induced seismicity risk parameters

# Fault friction properties
static_friction = 0.6                # Byerlee friction
dynamic_friction = 0.4               # Residual friction
critical_slip_distance = 0.01        # m (Dc)

# Rate-state parameters
a_parameter = 0.010                  # Direct effect
b_parameter = 0.015                  # State evolution (b > a = VW)
reference_velocity = 1.0e-6          # m/s

# Seismicity thresholds (traffic light system)
green_threshold_mw = 1.0             # Below this: continue
yellow_threshold_mw = 2.0            # Above: reduce operations
red_threshold_mw = 3.0               # Above: suspend operations

# Maximum allowable probability
max_prob_exceed_mw2 = 0.10           # 10% probability of Mw > 2
max_prob_exceed_mw3 = 0.01           # 1% probability of Mw > 3

[WELL_TEMPLATE]
# Default well properties (overridden per well)
wellbore_radius = 0.1                # m
skin_factor = 0.0
completion_length = 200.0            # m - open-hole interval
well_index_model = PEACEMAN

[OUTPUT]
# Output fields for analysis
output_pressure = true
output_temperature = true
output_velocity = true
output_stress = true
output_strain = true
output_permeability = true
output_fractures = true
output_seismicity = true

# Summary outputs
write_production_summary = true
write_injection_summary = true
write_thermal_recovery_curve = true
write_seismic_catalog = true

# Visualization
vtk_output_interval = 10
hdf5_compression = true

[BOUNDARY_CONDITIONS]
# Domain boundaries
bc_type_xmin = ZERO_FLUX             # No flow at boundaries
bc_type_xmax = ZERO_FLUX
bc_type_ymin = ZERO_FLUX
bc_type_ymax = ZERO_FLUX
bc_type_zmin = ZERO_FLUX             # Bottom - no flow
bc_type_zmax = ZERO_FLUX             # Top - no flow (deep reservoir)

# Thermal boundaries
thermal_bc_zmax = FIXED_TEMPERATURE  # Surface temperature
thermal_bc_zmax_value = 15.0         # °C
thermal_bc_zmin = HEAT_FLUX          # Basal heat flow
thermal_bc_zmin_value = 0.06         # W/m² (~60 mW/m²)

[INITIAL_CONDITIONS]
# Pressure initialization
initial_pressure_model = HYDROSTATIC
reference_pressure = 1.0e5           # Pa at surface
reference_depth = 0.0                # m

# Temperature initialization
initial_temperature_model = GRADIENT
surface_temperature = 15.0           # °C
temperature_gradient = 0.035         # °C/m

# Stress initialization (for geomechanics)
initial_stress_model = LITHOSTATIC
vertical_stress_gradient = 26000.0   # Pa/m
horizontal_stress_ratio = 0.7        # Shmin/Sv
max_horizontal_stress_ratio = 1.0    # SHmax/Sv
