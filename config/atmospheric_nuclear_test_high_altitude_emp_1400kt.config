# ==============================================================================
# High-Altitude Nuclear Burst (EMP-dominant) - Starfish-Prime-style
# ==============================================================================
# Purpose:
# - Example of a high-altitude detonation where EMP + ionospheric effects dominate
#   and blast/thermal effects at the surface are minimal compared to low-altitude tests.
# - Useful for demonstrating the EMP / ionosphere configuration knobs.
#
# Notes:
# - This config is intentionally slimmer than `atmospheric_nuclear_test.config`.
# - Values are representative and intended for educational/what-if analysis.
# ==============================================================================

[SIMULATION]
name = atmospheric_nuclear_high_altitude_emp_1400kt
description = 1.4 Mt high-altitude burst focusing on EMP + ionospheric effects

start_time = 0.0
end_time = 120.0

# High-altitude case: reduce the extreme early-time resolution compared to the
# fully coupled surface/airburst config.
dt_initial = 1.0e-8
dt_min = 1.0e-10
dt_max = 0.05

adaptive_dt = true
output_frequency = 200
output_format = HDF5
enable_checkpointing = true
checkpoint_frequency = 10000

# Physics: keep EM + ionization; blast/ground coupling can be disabled/minimized
fluid_model = COMPRESSIBLE_NS
solid_model = ELASTODYNAMIC

enable_atmosphere = true
enable_electromagnetic = true
enable_ionization = true

# Optional modules (usually secondary for high altitude)
enable_geomechanics = false
enable_elastodynamics = false
enable_radiation = true
enable_thermal = true

coupling_mode = LOOSELY_COUPLED
atmosphere_ground_coupling = false
radiation_thermal_coupling = true
emp_ionization_coupling = true

use_gpu = true
gpu_mode = AUTO

# ==============================================================================
# Device
# ==============================================================================
[NUCLEAR_DEVICE]
type = THERMONUCLEAR
yield_kt = 1400.0
fission_fraction = 0.25

# High altitude burst
burst_height = 400000.0
location_x = 250000.0
location_y = 250000.0
location_z = 400000.0

# ==============================================================================
# Atmosphere / Domain
# ==============================================================================
[ATMOSPHERE]
model = EXTENDED
base_profile = US_STANDARD_1976

ground_level = 0.0
top_of_domain = 500000.0
num_layers = 80
layer_type = EXPONENTIAL

# Reduce near-surface complexity; winds are less critical here
[ATMOSPHERE.WIND]
enable_wind = false

# ==============================================================================
# EMP (focus)
# ==============================================================================
[ELECTROMAGNETIC_PULSE]
enabled = true
source_mechanism = COMPTON_CURRENT

[EMP.E1]
enabled = true
pulse_type = FAST
rise_time = 2.5e-9
decay_time = 1.0e-6

# At high altitude, peak fields can be very large over wide footprints.
peak_field = 50000.0

gamma_emission_time = 100.0e-9
gamma_fluence = 5.0e13
compton_electron_energy = 1.0

geomagnetic_field = 50.0e-6
geomagnetic_dip = 60.0

# Compton electrons are generated primarily in the upper atmosphere (tens of km)
source_region_altitude = 30000.0
atmosphere_conductivity_profile = EXPONENTIAL

[EMP.E2]
enabled = true
pulse_type = INTERMEDIATE
rise_time = 1.0e-6
duration = 1.0e-3
peak_field = 500.0

[EMP.E3]
enabled = true
pulse_type = SLOW
rise_time = 0.5
duration = 120.0
peak_field = 5.0
fireball_conductivity = 1.0e6
magnetic_field_distortion = true

[EMP.GROUND_EFFECTS]
ground_conductivity = 0.01
enable_ground_wave = true
enable_sky_wave = true
ionosphere_reflection = true
enable_line_coupling = true
power_line_length = 50000.0

# ==============================================================================
# Ionosphere (focus)
# ==============================================================================
[IONOSPHERE]
enabled = true
background_model = IRI
daytime = true

# Keep these within-domain; high-altitude details are simplified
D_layer_altitude = 60000.0
E_layer_altitude = 120000.0
F_layer_altitude = 300000.0

xray_ionization = true
enhanced_ionization_duration = 7200.0

compute_radio_blackout = true
frequency_cutoff = 30.0e6

# ==============================================================================
# Radiation (optional, simplified)
# ==============================================================================
[RADIATION_TRANSPORT]
enabled = true
method = MONTE_CARLO
num_particles = 2000000

[RADIATION_TRANSPORT.PROMPT]
enabled = true
gamma_yield_fraction = 0.006
neutron_yield_fraction = 0.003

# ==============================================================================
# Grid
# ==============================================================================
[GRID]
nx = 320
ny = 320
nz = 240

Lx = 500000.0
Ly = 500000.0
Lz = 500000.0

origin_x = 0.0
origin_y = 0.0
origin_z = 0.0

use_multidomain = false

[amr]
enabled = true
method = plex_refine

[amr.criterion]
type = combined
weight_shock = 0.2
weight_temperature = 0.3
weight_radiation = 0.6

[amr.limits]
max_refinement_level = 4
max_cells = 15000000
min_cell_size = 20.0

[amr.features.burst]
x = 250000.0
y = 250000.0
z = 400000.0
radius = 30000.0
level = 4

# ==============================================================================
# Receivers (EMP field sensors across a wide footprint)
# ==============================================================================
[RECEIVERS]
output_format = HDF5
sampling_rate = 20000.0

[RECEIVER_ARRAY_EMP]
type = LINE
start = 250000.0, 250000.0, 10.0
end = 450000.0, 250000.0, 10.0
num_stations = 32
fields = electric_field_x, electric_field_y, electric_field_z, magnetic_field

# ==============================================================================
# Output
# ==============================================================================
[OUTPUT]
format = HDF5
path = output/atmospheric_high_altitude_emp_1400kt

save_electric_field = true
save_magnetic_field = true
save_induced_current = true
save_dose_rate = true
save_temperature = true

volume_output_frequency = 500
surface_output_frequency = 100

