# ==============================================================================
# Cascadia Subduction Zone M9.0 Earthquake and Tsunami Simulation
# ==============================================================================
#
# This configuration models a full-margin rupture of the Cascadia Subduction
# Zone (CSZ), similar to the great earthquake of January 26, 1700 CE.
#
# The simulation couples:
#   1. Seismic source (finite fault rupture model)
#   2. Coseismic seafloor deformation (Okada dislocation)
#   3. Tsunami generation and propagation (shallow water equations)
#   4. Coastal inundation and runup
#
# Historical/geological context:
# - The 1700 CE event was approximately Mw 9.0
# - Produced tsunami observed in Japan (~20 hours later)
# - Paleoseismic evidence suggests 10-20 m slip near trench
# - Recurrence interval: ~200-600 years (last event: 324 years ago)
#
# References:
#   - Satake et al. (2003) - 1700 tsunami in Japan
#   - Goldfinger et al. (2012) - Turbidite record
#   - Wang et al. (2013) - Slip distribution models
#   - Witter et al. (2013) - Paleotsunami deposits
#   - USGS SLAB2.0 - Subduction geometry
#
# ==============================================================================

[SIMULATION]
name = cascadia_m9_tsunami
description = M9.0 Cascadia Subduction Zone earthquake and trans-Pacific tsunami

# Time parameters
start_time = 0.0
end_time = 14400.0              # 4 hours for local tsunami
dt_initial = 0.5                # Time step (seconds)
dt_min = 0.01
dt_max = 2.0

# Extended simulation for trans-Pacific
# end_time = 86400.0            # 24 hours for Japan arrival

# Output settings
output_frequency = 120          # Every 2 minutes
output_format = HDF5
output_dir = output/cascadia_tsunami

# Physics coupling
enable_geomechanics = true
enable_elastodynamics = false   # Focus on tsunami, not seismic waves
enable_tsunami = true
enable_solid_earth_coupling = true

# GPU acceleration (recommended for large grids)
use_gpu = true
gpu_mode = CPU_FALLBACK

# Solver settings
rtol = 1.0e-6
atol = 1.0e-8

# ==============================================================================
# Domain Configuration
# ==============================================================================

[DOMAIN]
# West Coast of North America - full Cascadia region
# Extends from Cape Mendocino to Vancouver Island

lon_min = -132.0                # Western boundary (deep Pacific)
lon_max = -122.0                # Eastern boundary (coast/land)
lat_min = 39.0                  # Cape Mendocino, CA
lat_max = 51.0                  # Vancouver Island, BC

# Grid resolution (arc-minutes)
base_resolution_arcmin = 2.0    # ~3.7 km in deep ocean
coastal_resolution_arcmin = 0.5 # ~0.9 km near coast

# Coordinate reference
coordinate_system = WGS84
vertical_datum = MSL            # Mean Sea Level

# ==============================================================================
# Bathymetry Configuration
# ==============================================================================
# Uses GEBCO 2023 global bathymetry or synthetic test data

[BATHYMETRY]
source = GEBCO                  # GEBCO, ETOPO, USER_FILE, SYNTHETIC

# GEBCO 2023 data file path (if available)
gebco_file = data/GEBCO_2023_Cascadia.nc

# Alternatively, use synthetic continental shelf profile
# source = SYNTHETIC
# shelf_depth = 200.0           # Continental shelf depth (m)
# slope_angle = 5.0             # Continental slope angle (degrees)
# deep_ocean_depth = 3500.0     # Abyssal plain depth (m)
# shelf_width_km = 50.0
# slope_width_km = 80.0

# High-resolution coastal DEMs (for inundation)
use_coastal_lidar = false
lidar_regions = Crescent_City, Westport, Long_Beach

# Minimum depth for numerics
minimum_depth = 5.0             # meters

# ==============================================================================
# Cascadia Subduction Zone Fault Model
# ==============================================================================
# Based on USGS SLAB2.0 geometry and Wang et al. (2013) slip models

[FAULT_MODEL]
name = Cascadia_Full_Margin_M9
type = MEGATHRUST

# Fault geometry (full margin rupture)
north_latitude = 50.0           # Northern tip (Explorer plate boundary)
south_latitude = 40.5           # Cape Mendocino Triple Junction
trench_longitude = -125.0       # Approximate deformation front

# Along-strike length: ~1100 km
fault_length_km = 1100.0

# Down-dip width (locked zone + transition)
rupture_width_km = 120.0        # Seismogenic zone width

# Geometry varies along strike
average_strike = 350.0          # degrees (approximately N-S)
shallow_dip = 8.0               # degrees at trench (very shallow)
deep_dip = 18.0                 # degrees below transition
dip_transition_depth = 20.0     # km

# Subfault discretization
num_subfaults_along_strike = 60
num_subfaults_down_dip = 12
# Total: 720 subfaults

# ==============================================================================
# Slip Distribution Model
# ==============================================================================
# Based on paleoseismic and paleotsunami constraints

[SLIP_MODEL]
type = HETEROGENEOUS

# Average properties
average_slip = 17.0             # meters (full-margin average)
peak_slip = 35.0                # meters (high-slip patches)

# Slip distribution function
# Higher slip near trench, tapering down-dip
slip_depth_decay = 0.5          # Fraction retained at full depth
slip_along_strike_variation = SINUSOIDAL  # Adds realistic heterogeneity

# High-slip asperity locations (latitude, relative slip factor)
# Based on turbidite correlation (Goldfinger et al., 2012)
asperity_1_latitude = 46.5      # Central Oregon
asperity_1_slip_factor = 1.5
asperity_2_latitude = 42.5      # Southern Oregon
asperity_2_slip_factor = 1.3
asperity_3_latitude = 48.5      # Washington
asperity_3_slip_factor = 1.4

# Rake angle (slip direction)
rake = 90.0                     # Pure thrust (dip-slip)

# Optional: slip uncertainty for scenario ensemble
slip_uncertainty_fraction = 0.2

# ==============================================================================
# Rupture Dynamics
# ==============================================================================

[RUPTURE]
type = KINEMATIC                # Prescribed rupture, not spontaneous

# Hypocenter (rupture nucleation point)
hypocenter_latitude = 45.0      # Central Oregon (historical estimates)
hypocenter_longitude = -124.5
hypocenter_depth_km = 25.0

# Rupture velocity
rupture_velocity_km_s = 2.8     # km/s (typical for subduction)
rupture_velocity_mode = CONSTANT # CONSTANT, VARIABLE, SUPERSHEAR

# Rise time (duration of slip at each point)
average_rise_time = 30.0        # seconds
rise_time_scaling = SLIP_PROPORTIONAL  # Longer rise for larger slip

# Source time function
source_time_function = SMOOTHED_RAMP

# ==============================================================================
# Coseismic Deformation (Okada Model)
# ==============================================================================

[DEFORMATION]
model = OKADA_1985

# Elastic half-space properties
shear_modulus_GPa = 30.0        # Typical upper mantle
poisson_ratio = 0.25

# Apply Kajiura filter for water column response
apply_kajiura_filter = true

# Additional vertical component from horizontal shortening
include_horizontal_effects = true

# Expected deformation pattern:
# - Uplift: 3-8 m seaward of locked zone
# - Subsidence: 1-3 m at coast (coastal marshes record this)
# - Horizontal: 5-15 m seaward motion

# ==============================================================================
# Tsunami Model Configuration
# ==============================================================================

[TSUNAMI]
# Solver settings
solver = FWAVE                  # FWAVE, HLLC, ROE, GODUNOV
spatial_order = 2               # 2nd order reconstruction
time_integration = SSP_RK3      # Strong Stability Preserving RK3

# CFL condition
cfl_number = 0.8
adaptive_timestep = true

# Source treatment
source_type = KINEMATIC         # Time-dependent seafloor motion
source_rise_time = 60.0         # Seconds for source to fully develop

# Boundary conditions
boundary_west = OPEN            # Open ocean boundary
boundary_east = REFLECTIVE      # Coast (for basic run) or INUNDATION
boundary_north = OPEN
boundary_south = OPEN

# Sponge layers to absorb outgoing waves
use_sponge_layers = true
sponge_width_degrees = 0.5

# ==============================================================================
# Wetting/Drying and Inundation
# ==============================================================================

[INUNDATION]
enabled = true
method = MOMENTUM_CONSERVING    # Most accurate for runup

# Dry cell tolerance
dry_tolerance_m = 0.01          # 1 cm minimum depth

# Friction on land
enable_land_friction = true
land_friction_model = VARIABLE_MANNING

# Manning's n values by land use
manning_n_ocean = 0.025
manning_n_beach = 0.025
manning_n_urban = 0.04
manning_n_vegetation = 0.07
manning_n_forest = 0.10

# Use land cover data for friction
use_land_cover = false
land_cover_file = data/NLCD_Cascadia.tif

# ==============================================================================
# Dispersion Corrections (Optional Boussinesq terms)
# ==============================================================================

[DISPERSION]
enabled = false                 # Enable for improved nearshore accuracy
model = SGN                     # Serre-Green-Naghdi equations
threshold_depth = 50.0          # Only apply where h > 50 m

# ==============================================================================
# Nested Grids for High-Resolution Coastal Modeling
# ==============================================================================

[NESTING]
enabled = false                 # Enable for detailed local inundation

# Level 1: Oregon/Washington coast
[NESTING.LEVEL1]
name = Oregon_Coast
lon_min = -125.0
lon_max = -123.5
lat_min = 42.0
lat_max = 47.0
refinement_ratio = 3            # 3x finer than parent

# Level 2: Crescent City (historically vulnerable)
[NESTING.LEVEL2_CRESCENT_CITY]
name = Crescent_City
lon_min = -124.3
lon_max = -124.1
lat_min = 41.70
lat_max = 41.80
refinement_ratio = 9            # ~100 m resolution

# Level 2: Westport, WA
[NESTING.LEVEL2_WESTPORT]
name = Westport
lon_min = -124.2
lon_max = -124.0
lat_min = 46.85
lat_max = 46.95
refinement_ratio = 9

# ==============================================================================
# Observation Stations
# ==============================================================================
# NOAA tide gauges and DART buoys along the West Coast

[GAUGES]
output_interval = 6.0           # seconds
output_format = ASCII

# DART Deep Ocean Buoys (first arrivals)
[GAUGE_DART_46404]
name = DART_46404_Oregon
type = DART
longitude = -128.894
latitude = 45.857
depth = 2785

[GAUGE_DART_46407]
name = DART_46407_California
type = DART
longitude = -128.742
latitude = 42.641
depth = 3284

[GAUGE_DART_46419]
name = DART_46419_Washington
type = DART
longitude = -129.584
latitude = 48.764
depth = 2762

# NOAA Tide Gauges
[GAUGE_CRESCENT_CITY]
name = Crescent_City
type = TIDE_GAUGE
station_id = 9419750
longitude = -124.183
latitude = 41.745
# Historical vulnerability: Destroyed by 1964 Alaska tsunami

[GAUGE_HUMBOLDT]
name = Humboldt_Bay
type = TIDE_GAUGE
station_id = 9418767
longitude = -124.217
latitude = 40.767

[GAUGE_COOS_BAY]
name = Coos_Bay
type = TIDE_GAUGE
station_id = 9432780
longitude = -124.322
latitude = 43.345

[GAUGE_NEWPORT]
name = Newport
type = TIDE_GAUGE
station_id = 9435380
longitude = -124.043
latitude = 44.625

[GAUGE_ASTORIA]
name = Astoria
type = TIDE_GAUGE
station_id = 9439040
longitude = -123.768
latitude = 46.208

[GAUGE_WESTPORT]
name = Westport
type = TIDE_GAUGE
station_id = 9441102
longitude = -124.105
latitude = 46.904

[GAUGE_NEAH_BAY]
name = Neah_Bay
type = TIDE_GAUGE
station_id = 9443090
longitude = -124.612
latitude = 48.368

[GAUGE_PORT_ANGELES]
name = Port_Angeles
type = TIDE_GAUGE
station_id = 9444090
longitude = -123.440
latitude = 48.125

[GAUGE_SEATTLE]
name = Seattle
type = TIDE_GAUGE
station_id = 9447130
longitude = -122.339
latitude = 47.602
# Protected by Puget Sound - delayed/reduced arrival

[GAUGE_VICTORIA]
name = Victoria_BC
type = TIDE_GAUGE
station_id = 7120
longitude = -123.371
latitude = 48.425

[GAUGE_TOFINO]
name = Tofino_BC
type = TIDE_GAUGE
station_id = 8615
longitude = -125.913
latitude = 49.154

[GAUGE_SAN_FRANCISCO]
name = San_Francisco
type = TIDE_GAUGE
station_id = 9414290
longitude = -122.466
latitude = 37.807

[GAUGE_MONTEREY]
name = Monterey
type = TIDE_GAUGE
station_id = 9413450
longitude = -121.889
latitude = 36.605

[GAUGE_LOS_ANGELES]
name = Los_Angeles
type = TIDE_GAUGE
station_id = 9410660
longitude = -118.272
latitude = 33.720

[GAUGE_SAN_DIEGO]
name = San_Diego
type = TIDE_GAUGE
station_id = 9410170
longitude = -117.174
latitude = 32.714

# ==============================================================================
# Output Configuration
# ==============================================================================

[OUTPUT]
format = HDF5
path = output/cascadia_tsunami

# Time series output
save_gauge_timeseries = true
gauge_output_format = ASCII

# Spatial snapshots
save_eta = true                 # Sea surface elevation
save_velocity = true            # Current velocity
save_depth = true               # Total water depth
snapshot_interval = 120         # Every 2 minutes

# Maximum value tracking
save_max_eta = true
save_max_velocity = true
save_max_momentum_flux = true
save_arrival_time = true

# Inundation mapping
save_inundation_extent = true
save_runup_heights = true

# Animation
save_animation = true
animation_fps = 10

# Summary statistics
compute_energy = true
compute_coastal_hazard_indices = true

# ==============================================================================
# Expected Results
# ==============================================================================
# Based on modeling studies and historical data:
#
# DART Buoy Arrivals (first wave):
#   - DART 46404: ~15-20 minutes, amplitude ~0.3-0.5 m
#   - DART 46407: ~20-25 minutes, amplitude ~0.3-0.5 m
#   - DART 46419: ~15-20 minutes, amplitude ~0.3-0.5 m
#
# Coastal Arrivals (first wave):
#   - Crescent City: ~20-30 minutes, height 5-10 m (very exposed)
#   - Astoria: ~20-30 minutes, height 5-8 m
#   - Westport: ~25-35 minutes, height 6-10 m
#   - Neah Bay: ~30-40 minutes, height 4-8 m
#   - Seattle: ~2-3 hours (Puget Sound), height 1-3 m
#   - San Francisco: ~1.5-2 hours, height 1-3 m
#   - Los Angeles: ~3-4 hours, height 0.5-2 m
#
# Key Hazards:
#   - Crescent City: Historically vulnerable, 1964 damage
#   - Oregon Bays: Coos Bay, Yaquina Bay, Tillamook Bay
#   - Washington Coast: Long Beach Peninsula, Grays Harbor
#   - British Columbia: Tofino, Port Alberni (channeling effect)
#
# ==============================================================================

[ANALYSIS]
# Compute maximum runup along coast
compute_runup_profile = true
runup_transect_spacing_km = 5.0

# Hazard metrics
compute_hazard_map = true
hazard_thresholds_m = 0.5, 1.0, 2.0, 5.0, 10.0

# Wave period analysis
compute_spectral_analysis = true

# Comparison with paleotsunami data
# Sandy deposits at elevations:
# - Willapa Bay: 3-4 m runup (Atwater, 1987)
# - Siletz Bay: 6-8 m runup (Witter, 2003)
paleotsunami_comparison = true

# ==============================================================================
# Scenario Variations (for probabilistic hazard assessment)
# ==============================================================================

[SCENARIOS]
# Run multiple slip distributions
enable_ensemble = false
num_realizations = 10
slip_distribution = STOCHASTIC

# Segment ruptures
include_segment_scenarios = false
# Individual segments:
# - SOUTH: Cape Mendocino to central Oregon (M8.0-8.5)
# - CENTRAL: Central Oregon (M8.0)
# - NORTH: Washington to Vancouver Island (M8.0-8.5)
