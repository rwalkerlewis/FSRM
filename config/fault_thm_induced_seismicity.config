# ==============================================================================
# THM Fault: Induced Seismicity Configuration
# ==============================================================================
# This configuration demonstrates thermo-hydro-mechanical (THM) coupling for
# modeling induced seismicity during fluid injection operations.
#
# Physical scenario:
#   - Pre-existing fault at seismogenic depth (5 km)
#   - Fluid injection increases pore pressure over time
#   - Fault destabilizes when effective normal stress decreases sufficiently
#   - Slip causes permeability enhancement and thermal pressurization
#
# ==============================================================================

# ------------------------------------------------------------------------------
# Simulation Parameters
# ------------------------------------------------------------------------------
end_time = 100.0           ; Simulation duration (seconds)
dt = 0.01                  ; Time step (seconds)
output_interval = 100      ; Output every N steps

# ------------------------------------------------------------------------------
# Fault Geometry
# ------------------------------------------------------------------------------
fault_length = 5000.0      ; Along-strike length (m)
fault_depth = 5000.0       ; Depth to fault (m)
num_vertices = 51          ; Number of discretization points

# Fault orientation (for coordinate transformation)
fault_strike = 0.0         ; Strike angle (degrees, from North)
fault_dip = 90.0           ; Dip angle (degrees, vertical fault)

# ------------------------------------------------------------------------------
# Material Properties (Host Rock)
# ------------------------------------------------------------------------------
shear_modulus = 30e9       ; Shear modulus (Pa) - typical crystalline rock
bulk_modulus = 66e9        ; Bulk modulus (Pa)
density = 2700.0           ; Rock density (kg/m³)
poisson_ratio = 0.25       ; Poisson's ratio

# Elastic wave velocities (computed from above)
# V_p ≈ 6000 m/s, V_s ≈ 3300 m/s, V_R ≈ 3000 m/s

# ------------------------------------------------------------------------------
# Initial Stress State
# ------------------------------------------------------------------------------
# At 5 km depth with typical stress gradients
initial_normal_stress = 120e6    ; Total normal stress (Pa) - σ_n ≈ 24 MPa/km * 5 km
initial_shear_stress = 60e6      ; Shear stress (Pa) - close to failure
initial_pore_pressure = 50e6     ; Hydrostatic pore pressure (Pa) - 10 MPa/km * 5 km

# Effective normal stress: σ'_n = 120 - 0.9*50 = 75 MPa
# With μ = 0.6, critical shear = 0.6 * 75 = 45 MPa
# Current shear/critical = 60/45 = 1.33 -> critically stressed

# ------------------------------------------------------------------------------
# Injection Parameters
# ------------------------------------------------------------------------------
injection_pressure_rate = 1e6    ; Pressure increase rate (Pa/s) = 1 MPa/s
injection_radius = 500.0         ; Influence radius for pressure diffusion (m)

# The injection is centered at the middle of the fault.
# Pressure perturbation spreads via diffusion-like process.

# ------------------------------------------------------------------------------
# Fault Coupling Mode
# ------------------------------------------------------------------------------
fault_coupling_mode = thm  ; Options: mechanical, poroelastic, thermoelastic, thm, thmc

# THM = Thermo-Hydro-Mechanical coupling includes:
#   - Pore pressure effects on effective stress (Terzaghi/Biot)
#   - Thermal pressurization during slip
#   - Frictional heating
#   - Permeability/porosity evolution with deformation

# ------------------------------------------------------------------------------
# Friction Model
# ------------------------------------------------------------------------------
friction_model = rate_state_aging  ; Options: static, slip_weakening, rate_state_aging, rate_state_slip

# Rate-state parameters (Dieterich-Ruina formulation)
friction_coefficient = 0.6         ; Reference friction coefficient (μ_0)
reference_velocity = 1e-6          ; Reference slip velocity V_0 (m/s)
characteristic_slip = 0.01         ; Critical slip distance D_c (m)
a_parameter = 0.01                 ; Direct effect parameter (a)
b_parameter = 0.015                ; Evolution effect parameter (b)
; b - a = 0.005 > 0 implies velocity-weakening (unstable)

# Nucleation length estimate: L_c = G * D_c / ((b-a) * σ'_n)
#                           L_c ≈ 30e9 * 0.01 / (0.005 * 75e6) ≈ 800 m

# ------------------------------------------------------------------------------
# Fault Hydraulic Properties
# ------------------------------------------------------------------------------
fault_porosity = 0.1               ; Initial fault zone porosity
fault_thickness = 0.01             ; Fault core thickness (m) = 1 cm
damage_zone_thickness = 10.0       ; Damage zone thickness (m)

# Permeability (tensor in fault-local coordinates)
fault_permeability_parallel = 1e-15      ; Along-fault permeability (m²)
fault_permeability_perpendicular = 1e-17 ; Cross-fault permeability (m²)
; Typical fault zone: k_parallel >> k_normal (conduit-barrier structure)

# Poroelastic parameters
fault_biot_coefficient = 0.9       ; Biot coefficient (close to 1 for fault gouge)
fault_specific_storage = 1e-9      ; Specific storage (1/Pa)
fault_fluid_viscosity = 1e-3       ; Water viscosity (Pa·s)
fault_fluid_density = 1000.0       ; Water density (kg/m³)
fluid_compressibility = 4.5e-10    ; Water compressibility (1/Pa)

# ------------------------------------------------------------------------------
# Fault Thermal Properties
# ------------------------------------------------------------------------------
fault_reference_temperature = 423.15  ; Initial temp (K) = 150°C at 5 km (30°C/km gradient)
fault_thermal_conductivity_parallel = 3.0   ; W/m/K
fault_thermal_conductivity_normal = 2.0     ; W/m/K
fault_specific_heat_solid = 900.0    ; J/kg/K
fault_thermal_diffusivity = 1e-6     ; m²/s

# Flash heating parameters
fault_weakening_temperature = 1200.0  ; Temperature for rapid weakening (K)
fault_contact_diameter = 10e-6        ; Asperity contact size (m) = 10 μm

# ------------------------------------------------------------------------------
# Property Evolution Models
# ------------------------------------------------------------------------------
# Permeability evolution
permeability_update_model = combined  ; Options: constant, slip_dependent, 
                                      ;          stress_dependent, dilation_dependent,
                                      ;          shear_enhanced, damage_dependent, combined

# Slip-dependent enhancement: k = k_0 * exp(α * slip)
permeability_slip_coefficient = 50.0   ; Enhancement rate (1/m)

# Stress-dependent: k = k_0 * exp(-γ * σ'_n / σ_ref)
permeability_stress_coefficient = 0.2
permeability_stress_reference = 50e6   ; Reference stress (Pa)

# Bounds on permeability
permeability_minimum = 1e-20    ; Minimum permeability (m²)
permeability_maximum = 1e-10    ; Maximum permeability (m²)

# Porosity evolution
porosity_update_model = dilation       ; Options: constant, compaction, dilation, 
                                       ;          chemical, combined
porosity_dilation_coefficient = 0.05   ; Porosity increase per unit slip
porosity_minimum = 0.01
porosity_maximum = 0.5

# Recovery (healing) time scales
permeability_recovery_time = 3.15e7    ; 1 year in seconds

# ------------------------------------------------------------------------------
# Output Configuration
# ------------------------------------------------------------------------------
output_prefix = fault_thm_induced
output_format = ascii              ; Options: ascii, binary, hdf5
output_fields = slip,slip_rate,shear_stress,normal_stress,pore_pressure,temperature,permeability,porosity

# Time series output at monitoring points
monitor_points = 25                ; Vertex index for detailed monitoring (center)

# Snapshot output
snapshot_interval = 10.0           ; Write full fault state every N seconds

# ==============================================================================
# Expected Results
# ==============================================================================
# With these parameters:
#
# 1. CRITICAL PRESSURE INCREASE:
#    Initial: σ'_n = 75 MPa, τ_critical = 45 MPa, τ = 60 MPa (already over!)
#    This means the fault is super-critically stressed and will slip immediately
#    when pore pressure increases slightly.
#
#    For a more gradual onset, consider reducing initial_shear_stress to ~40 MPa
#    Then critical p increase: Δp to make τ > μ*(σ_n - α*p)
#    40 > 0.6*(120 - 0.9*(50 + Δp))
#    40 > 0.6*(120 - 45 - 0.9*Δp)
#    40 > 45 - 0.54*Δp
#    Δp > 9.3 MPa → event at t ≈ 9.3 s
#
# 2. PERMEABILITY ENHANCEMENT:
#    After slip of 1 cm: k = k_0 * exp(50 * 0.01) = k_0 * 1.65
#    After slip of 10 cm: k = k_0 * exp(50 * 0.1) = k_0 * 148
#    After slip of 1 m: k = k_0 * exp(50 * 1) = bounded to 1e-10 m²
#
# 3. THERMAL PRESSURIZATION:
#    With 10 MPa shear stress and 1 m/s slip rate:
#    Heat generation: Q = 10e6 * 1 = 10 MW/m²
#    Temperature rise (adiabatic): ΔT ≈ Q*Δt/(ρ*c*w)
#    For 0.01 s of slip in 1 cm wide zone: ΔT ≈ 10e6*0.01/(2700*900*0.01) ≈ 4 K
#
# ==============================================================================
