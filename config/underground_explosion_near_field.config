# ==============================================================================
# Underground Explosion Near-Field Configuration
# ==============================================================================
# Near-field deformation effects for underground nuclear detonations
# 
# Physical basis and references:
# - CRAM3D methodology: https://apps.dtic.mil/sti/tr/pdf/AD1064154.pdf
# - Rimer & Cherry (1982) - Nuclear test phenomenology
# - Terhune et al. (1977) - Near-field ground motion
# - Mueller & Murphy (1971) - Seismic source characteristics
# - NTS empirical scaling relations
#
# Physics implemented:
# - Shock wave propagation (Mie-Grüneisen EOS)
# - Pressure-dependent strength
# - Damage evolution and material degradation
# - Cavity formation and expansion
# - Damage zones (crushed, fractured, disturbed)
# - Spall modeling
# - Seismic source generation (RDP model)
# ==============================================================================

[SIMULATION]
name = underground_explosion_near_field
description = Near-field deformation effects of underground explosion

# Time parameters
start_time = 0.0
end_time = 5.0                       # 5 seconds for near-field evolution
dt_initial = 1.0e-6                  # 1 microsecond for shock wave
dt_min = 1.0e-9                      # Nanoseconds during strong shock
dt_max = 0.001                       # Millisecond after equilibration
max_timesteps = 500000

# Adaptive timestepping
adaptive_dt = true
cfl_number = 0.3                     # Conservative for shocks

# Output
output_frequency = 100
output_format = HDF5
enable_checkpointing = true
checkpoint_frequency = 5000

# Physics models
enable_near_field_damage = true
enable_shock_physics = true
enable_cavity_formation = true
enable_spall = true
enable_seismic_source = true

# GPU acceleration
use_gpu = true
gpu_mode = AUTO

# ==============================================================================
# Explosion Source Parameters
# ==============================================================================
[EXPLOSION_SOURCE]
type = UNDERGROUND_CONTAINED

# Device parameters (scalable from 1 kt to megatons)
yield_kt = 150.0                     # 150 kilotons yield
depth_of_burial = 1000.0             # 1 km depth (meters)

# Source location (center of domain)
source_x = 25000.0                   # meters
source_y = 25000.0
source_z = -1000.0                   # Negative = below surface

# Source time function (Mueller-Murphy model)
source_model = MUELLER_MURPHY
overshoot_factor = 1.2               # Source overshoot (1.0-1.5)
# Rise time computed automatically from yield

# Moment tensor decomposition
# Nuclear explosions are predominantly isotropic with some CLVD
# from spall and cavity asymmetry
isotropic_fraction = 0.70            # 70% isotropic explosion
clvd_fraction = 0.25                 # 25% CLVD (spall component)
double_couple_fraction = 0.05        # 5% DC (tectonic release)

# ==============================================================================
# Host Rock Properties - Granite
# ==============================================================================
[HOST_ROCK]
name = GRANITE
rock_type = CRYSTALLINE

# Density and elastic properties
host_density = 2650.0                # kg/m³
p_wave_velocity = 5500.0             # m/s
s_wave_velocity = 3200.0             # m/s
porosity = 0.01                      # Low porosity

# Equation of State (Mie-Grüneisen)
[HOST_ROCK.EOS]
eos_type = MIE_GRUNEISEN
bulk_sound_speed = 4500.0            # m/s
hugoniot_slope = 1.4                 # s in Us = c0 + s*up
gruneisen_gamma = 1.5                # Grüneisen parameter γ0
gruneisen_a = 0.5                    # First-order volume correction

# Strength model (pressure-dependent)
[HOST_ROCK.STRENGTH]
model = PRESSURE_DEPENDENT

# Y = Y0 + A * P^n for P ≥ 0
cohesion = 50.0e6                    # Y0 = 50 MPa at P=0
pressure_coefficient = 0.5           # A
pressure_exponent = 0.5              # n

# Y = Y0 + B * P for P < 0 (tension)
tension_coefficient = 5.0            # B

# Limits
max_strength = 2.0e9                 # 2 GPa cap
residual_strength = 0.1e6            # 0.1 MPa minimum

# Softening behavior
softening_strain = 0.05              # Strain for full softening
residual_strength_ratio = 0.1        # 10% residual after softening

# Dynamic effects
strain_rate_exponent = 0.1           # Rate sensitivity
reference_strain_rate = 1.0          # 1/s

# Tensile strength
static_tensile_strength = 10.0e6     # 10 MPa

# ==============================================================================
# Damage Model
# ==============================================================================
[DAMAGE]
model = SCALAR_CONTINUUM

# Strain-based damage initiation
damage_strain_threshold = 0.001      # 0.1% strain threshold
damage_strain_saturation = 0.10      # Full damage at 10% strain

# Pressure-based damage (crushing)
damage_pressure_threshold = 1.0e9    # 1 GPa
damage_pressure_saturation = 10.0e9  # Full damage at 10 GPa

# Tensile damage (spall)
tensile_damage_threshold = 5.0e6     # 5 MPa tensile stress

# Evolution parameters
damage_rate = 10.0                   # Rate coefficient
max_damage = 0.99                    # Maximum damage (< 1 for stability)

# Healing (optional, for long-term simulations)
healing_enabled = false
healing_rate = 0.01                  # 1/s

# ==============================================================================
# Spall Model
# ==============================================================================
[SPALL]
enabled = true

# Dynamic tensile strength
static_tensile_strength = 10.0e6     # Pa
strain_rate_exponent = 0.1           # Rate sensitivity

# Spall criteria
spall_velocity_threshold = 1.0       # m/s particle velocity
spall_energy_per_area = 1000.0       # J/m² fracture energy

# ==============================================================================
# Zone Definitions (computed from scaling laws)
# ==============================================================================
# Zone radii are computed using NTS empirical relations:
# R_cavity = 55 * W^0.295 * (ρ/2.65)^(-1/3.4)  meters
# R_crushed ≈ 2.5 * R_cavity
# R_fractured ≈ 5 * R_cavity
# R_damaged ≈ 10 * R_cavity
#
# For 150 kt at 2650 kg/m³:
# R_cavity ≈ 118 m
# R_crushed ≈ 295 m
# R_fractured ≈ 590 m
# R_damaged ≈ 1180 m

[DAMAGE_ZONES]
# Override scaling if needed
use_empirical_scaling = true

# Zone multipliers (relative to cavity radius)
crushed_zone_ratio = 2.5
fractured_zone_ratio = 5.0
damaged_zone_ratio = 10.0

# Pressure thresholds for zone boundaries
vaporization_pressure = 100.0e9      # 100 GPa
melting_pressure = 30.0e9            # 30 GPa
crushing_pressure = 5.0e9            # 5 GPa
fracture_pressure = 0.5e9            # 500 MPa
damage_pressure = 0.1e9              # 100 MPa

# ==============================================================================
# Shock Wave Attenuation
# ==============================================================================
[SHOCK_ATTENUATION]
# Peak pressure decay exponents
# P(r) = P0 * (r0/r)^n

# Strong shock regime (near cavity)
strong_shock_exponent = 3.0          # Geometric spreading
strong_weak_transition = 5.0         # Multiple of cavity radius

# Weak shock regime (far field)
weak_shock_exponent = 1.87           # Empirical for rock

# ==============================================================================
# Grid Configuration
# ==============================================================================
[GRID]
nx = 250
ny = 250
nz = 125

# Domain size: 50 km × 50 km × 25 km
Lx = 50000.0
Ly = 50000.0
Lz = 25000.0

# Origin (surface at z=0, positive downward)
origin_x = 0.0
origin_y = 0.0
origin_z = 0.0

# Adaptive mesh refinement
[GRID.AMR]
enabled = true
max_refinement_level = 5
min_cell_size = 5.0                  # 5 m minimum near source

# Refine around source
[GRID.AMR.SOURCE_REGION]
x = 25000.0
y = 25000.0
z = 1000.0
radius = 3000.0                      # 3 km refined region
level = 5

# ==============================================================================
# Initial Conditions
# ==============================================================================
[IC_STRESS]
field = STRESS
distribution = LITHOSTATIC
surface_stress = 0.0
density = 2650.0
gravity = 9.81

[IC_TEMPERATURE]
field = TEMPERATURE
distribution = GRADIENT
surface_value = 288.15               # 15°C surface
gradient = 0.0, 0.0, 0.025           # 25 K/km geothermal

[IC_DAMAGE]
field = DAMAGE
distribution = UNIFORM
value = 0.0                          # Undamaged initially

# ==============================================================================
# Boundary Conditions
# ==============================================================================
[BC_SURFACE]
type = FREE_SURFACE
location = ZMIN
field = DISPLACEMENT

[BC_ABSORBING]
type = ABSORBING
location = XMIN, XMAX, YMIN, YMAX, ZMAX
field = DISPLACEMENT
absorbing_type = PML
pml_layers = 20
pml_strength = 100.0

# ==============================================================================
# Seismic Receivers
# ==============================================================================
[RECEIVERS]
output_format = SAC
sampling_rate = 200.0                # 200 Hz

# Near-field stations
[RECEIVER_NF1]
name = NF_1km
location = 26000.0, 25000.0, 0.0     # 1 km from GZ

[RECEIVER_NF2]
name = NF_2km
location = 27000.0, 25000.0, 0.0     # 2 km from GZ

[RECEIVER_NF5]
name = NF_5km
location = 30000.0, 25000.0, 0.0     # 5 km from GZ

# Intermediate stations
[RECEIVER_INT10]
name = INT_10km
location = 35000.0, 25000.0, 0.0     # 10 km from GZ

[RECEIVER_INT20]
name = INT_20km
location = 45000.0, 25000.0, 0.0     # 20 km from GZ

# Borehole station
[RECEIVER_BOREHOLE]
name = BOREHOLE_500m
location = 27000.0, 25000.0, 500.0   # 500 m depth, 2 km offset

# ==============================================================================
# Output Configuration
# ==============================================================================
[OUTPUT]
format = HDF5
path = output/explosion_near_field

# Fields to save
save_displacement = true
save_velocity = true
save_stress = true
save_strain = true
save_damage = true
save_plastic_strain = true
save_pressure = true
save_temperature = true

# Output frequencies
volume_output_frequency = 500
surface_output_frequency = 50

# Cross-sections
save_cross_sections = true
cross_section_planes = XZ_Y25000, YZ_X25000
cross_section_frequency = 100

# Damage zone tracking
track_damage_zones = true
save_zone_boundaries = true
zone_output_frequency = 100

# Seismic source output
save_moment_rate = true
save_source_time_function = true
save_moment_tensor = true

# ==============================================================================
# Analysis
# ==============================================================================
[ANALYSIS]
# Damage assessment
compute_damage_volume = true
damage_thresholds = 0.1, 0.4, 0.6, 0.9

# Zone radii evolution
track_zone_evolution = true

# Energy partitioning
compute_energy_partition = true
track_kinetic_energy = true
track_seismic_energy = true
track_plastic_work = true
track_fracture_energy = true

# Seismic source parameters
compute_seismic_moment = true
compute_magnitude = true
magnitude_types = mb, Mw

# Spall analysis
analyze_spall = true
spall_velocity_threshold = 1.0

# Peak ground motion
compute_pgv = true
compute_pga = true

# ==============================================================================
# Scaling Configurations (Alternative Scenarios)
# ==============================================================================

# Small test (1 kt)
[SCALING_SMALL]
yield_kt = 1.0
depth_of_burial = 300.0

# Medium test (10 kt)
[SCALING_MEDIUM]
yield_kt = 10.0
depth_of_burial = 500.0

# Large test (100 kt)
[SCALING_LARGE]
yield_kt = 100.0
depth_of_burial = 800.0

# Very large test (1 Mt)
[SCALING_MEGATON]
yield_kt = 1000.0
depth_of_burial = 2000.0
