# SCEC TPV16 Configuration
# Dynamic Rupture on Rough Fault Surface

[SIMULATION]
name = SCEC_TPV16_RoughFault
start_time = 0.0
end_time = 12.0
dt_initial = 0.003                # Smaller timestep for rough geometry
dt_min = 0.00005
dt_max = 0.005
max_time_steps = 8000
output_frequency = 30
output_format = HDF5
output_dir = output/scec_tpv16

# Physics models
fluid_model = NONE
enable_geomechanics = true
enable_elastodynamics = true
enable_faults = true
enable_rough_faults = true        # Special flag for rough geometry

# Solver settings
time_integration = NEWMARK_BETA
newmark_beta = 0.25
newmark_gamma = 0.5
rtol = 1.0e-6
atol = 1.0e-8
max_iterations = 50               # May need more iterations

[GRID]
type = CARTESIAN
# Higher resolution required for rough fault
nx = 240                          # 200 m cell size
ny = 240
nz = 120
Lx = 48000.0
Ly = 48000.0
Lz = 24000.0

# Very high refinement near fault due to roughness
use_adaptive_refinement = true
refinement_zone_x = 15000, 33000
refinement_zone_y = 20000, 28000
refinement_factor = 4             # 50 m near fault

[ROCK]
# Same elastic properties as TPV5
density = 2670.0
shear_modulus = 32.04e9
lame_lambda = 32.04e9
youngs_modulus = 80.0e9
poisson_ratio = 0.25

[FAULT1]
# Strike-slip fault with rough surface
name = RoughFault
type = DYNAMIC_RUPTURE

# Base fault geometry (before roughness)
location = 24000, 24000, 0
strike = 0.0
dip = 90.0
length = 30000.0
width = 15000.0

# Roughness parameters
enable_roughness = true
roughness_type = SELF_SIMILAR      # Self-similar/fractal roughness
roughness_rms = 200.0              # RMS amplitude: 200 m
roughness_correlation_length = 1500.0   # Correlation length: 1.5 km
roughness_hurst_exponent = 0.8     # Hurst exponent (self-similarity)
roughness_seed = 12345             # Random seed for reproducibility

# Alternative: Load roughness from file
# roughness_from_file = true
# roughness_file = data/tpv16_roughness.dat

# Friction law: Slip-weakening (same as TPV5)
friction_law = SLIP_WEAKENING
static_friction = 0.677
dynamic_friction = 0.525
slip_weakening_distance = 0.40

# Initial stress (spatially variable due to rough geometry)
# Code will project stress onto rough surface
initial_shear_stress = 81.6e6
initial_normal_stress = -120.0e6

# Resolve initial stress on rough surface
resolve_stress_on_rough_surface = true

# Nucleation patch
nucleation_type = SQUARE_ASPERITY
nucleation_center = 0, 0, -7500
nucleation_radius = 1500.0
nucleation_shear_stress = 81.24e6
forced_rupture_time = 0.5
forced_rupture_duration = 0.3

# Special handling for rough fault
interpolation_order = 2            # Quadratic for smoother rough surface
use_split_nodes = true             # Split nodes at fault for proper contact

[BOUNDARY]
boundary_type = ABSORBING

[BC1]
type = FREE_SURFACE
location = ZMAX
field = DISPLACEMENT

[BC2]
type = ABSORBING
location = XMIN, XMAX, YMIN, YMAX, ZMIN
field = DISPLACEMENT
absorbing_type = PML

[RECEIVERS]
num_receivers = 12

# Same as TPV5 but subset
receiver1_location = 24000, 24000, 0
receiver2_location = 27000, 24000, 0
receiver3_location = 30000, 24000, 0
receiver4_location = 33000, 24000, 0
receiver5_location = 24000, 27000, 0
receiver6_location = 24000, 30000, 0
receiver7_location = 24000, 36000, 0
receiver8_location = 27000, 27000, 0
receiver9_location = 30000, 30000, 0
receiver10_location = 21000, 21000, 0
receiver11_location = 36000, 24000, 0
receiver12_location = 24000, 12000, 0

output_velocity = true
output_displacement = true

[OUTPUT]
save_displacement = true
save_velocity = true
save_stress = true
save_slip = true
save_slip_rate = true
save_rupture_time = true
save_roughness_geometry = true     # Save actual rough fault geometry

# High-frequency output for roughness effects
save_volume_data = true
save_surface_data = true
save_fault_data = true

# Analysis of roughness effects
compute_roughness_statistics = true
compute_spectral_analysis = true   # Frequency content of slip

[ANALYSIS]
# Compare smooth vs rough fault behavior
enable_roughness_analysis = true

# Compute:
# - Rupture speed variations
# - Slip heterogeneity
# - High-frequency radiation
# - Stress drop variations

# Reference smooth solution (TPV5)
reference_smooth_solution = output/scec_tpv5

[VERIFICATION]
# TPV16 has high variability due to roughness
enable_verification = true
reference_solution_dir = data/scec_tpv16_reference
tolerance_slip = 0.3              # 30% tolerance (high due to roughness)
tolerance_rupture_time = 0.5
