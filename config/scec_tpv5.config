# SCEC TPV5 Configuration
# Strike-Slip Dynamic Rupture with Heterogeneous Stress

[SIMULATION]
name = SCEC_TPV5_StrikeSlip
start_time = 0.0
end_time = 12.0                   # 12 seconds
dt_initial = 0.005                # 5 ms
dt_min = 0.0001                   # 0.1 ms
dt_max = 0.01                     # 10 ms
max_time_steps = 5000
output_frequency = 20             # Every 0.1 seconds
output_format = HDF5
output_dir = output/scec_tpv5

# Physics models
fluid_model = NONE
enable_geomechanics = true
enable_elastodynamics = true      # Dynamic wave propagation
enable_faults = true
enable_plasticity = false

# Solver settings for elastodynamics
time_integration = NEWMARK_BETA
newmark_beta = 0.25
newmark_gamma = 0.5
rtol = 1.0e-6
atol = 1.0e-8
max_iterations = 30

[GRID]
type = CARTESIAN
# Domain: 48 km × 48 km × 24 km
nx = 192                          # 250 m cell size
ny = 192
nz = 96
Lx = 48000.0                      # meters
Ly = 48000.0
Lz = 24000.0

# Mesh refinement near fault
use_adaptive_refinement = true
refinement_zone_x = 15000, 33000  # ±9 km from fault
refinement_zone_y = 18000, 30000  # ±6 km across fault
refinement_factor = 2

[ROCK]
# Elastic half-space properties
# Standard SCEC TPV benchmark values

porosity = 0.0                    # No pore pressure effects
density = 2670.0                  # kg/m³

# Elastic properties
# V_p = 6000 m/s, V_s = 3464 m/s
# λ + 2μ = ρ V_p²,  μ = ρ V_s²

shear_modulus = 32.04e9           # Pa (μ = ρ V_s²)
lame_lambda = 32.04e9             # Pa (λ = μ for ν = 0.25)
youngs_modulus = 80.0e9           # Pa
poisson_ratio = 0.25

# Wave speeds (for reference)
# V_p = sqrt((λ + 2μ)/ρ) = 6000 m/s
# V_s = sqrt(μ/ρ) = 3464 m/s

[FAULT1]
# Main strike-slip fault
name = MainFault
type = DYNAMIC_RUPTURE

# Fault geometry - vertical planar fault
# Center of domain, striking in x-direction
location = 24000, 24000, 0        # Center point (x, y, z)
strike = 0.0                      # degrees (along x-axis)
dip = 90.0                        # degrees (vertical)
length = 30000.0                  # 30 km along strike
width = 15000.0                   # 15 km down-dip

# Friction law: Linear slip-weakening
friction_law = SLIP_WEAKENING
static_friction = 0.677           # μ_s
dynamic_friction = 0.525          # μ_d
slip_weakening_distance = 0.40    # D_c in meters

# Initial stress (heterogeneous)
# Background stress
initial_shear_stress = 81.6e6     # Pa (τ_0 = 81.6 MPa)
initial_normal_stress = -120.0e6  # Pa (σ_n = -120 MPa, compression negative)

# Nucleation patch: 3 km × 3 km square centered at hypocenter
nucleation_type = SQUARE_ASPERITY
nucleation_center = 0, 0, -7500   # On-fault coordinates (along-strike, 0, down-dip)
nucleation_radius = 1500.0        # Half-width = 1.5 km
nucleation_shear_stress = 81.24e6 # Slightly higher to initiate rupture

# Stress outside nucleation zone (background)
background_shear_stress = 78.0e6  # Lower stress to prevent immediate rupture

# Forced rupture in nucleation zone
forced_rupture_time = 0.5         # Start forcing at 0.5 seconds
forced_rupture_duration = 0.3     # Force for 0.3 seconds

[BOUNDARY]
# Absorbing boundaries (Perfectly Matched Layers or Clayton-Engquist)
boundary_type = ABSORBING

# Free surface at top (z = 0)
[BC1]
type = FREE_SURFACE
location = ZMAX
field = DISPLACEMENT

# Absorbing boundaries on sides and bottom
[BC2]
type = ABSORBING
location = XMIN, XMAX, YMIN, YMAX, ZMIN
field = DISPLACEMENT
absorbing_type = PML              # Perfectly Matched Layer

[RECEIVERS]
# Station locations for seismogram output
num_receivers = 10

# Stations at various distances from hypocenter
# All at free surface (z = 0)
receiver1_location = 24000, 24000, 0     # At hypocenter, surface
receiver2_location = 27000, 24000, 0     # 3 km along strike
receiver3_location = 30000, 24000, 0     # 6 km along strike
receiver4_location = 33000, 24000, 0     # 9 km along strike
receiver5_location = 24000, 27000, 0     # 3 km across fault
receiver6_location = 24000, 30000, 0     # 6 km across fault
receiver7_location = 24000, 36000, 0     # 12 km across fault
receiver8_location = 27000, 27000, 0     # Diagonal
receiver9_location = 30000, 30000, 0     # Farther diagonal
receiver10_location = 21000, 21000, 0    # Opposite side

# Output 3-component velocity and displacement
output_velocity = true
output_displacement = true
output_acceleration = false

[OUTPUT]
save_displacement = true
save_velocity = true
save_stress = true
save_slip = true                  # Fault slip
save_slip_rate = true             # Fault slip rate
save_rupture_time = true          # Rupture arrival time
save_rise_time = true             # Rise time of slip

# Visualization
save_volume_data = true
save_surface_data = true
save_fault_data = true

# On-fault output stations (for detailed fault behavior)
num_fault_stations = 15
fault_station_spacing = 2000.0    # Every 2 km along fault

[VERIFICATION]
# Compare with SCEC reference solutions
enable_verification = true
reference_solution_dir = data/scec_tpv5_reference
tolerance_slip = 0.1              # 10% tolerance on slip
tolerance_rupture_time = 0.2      # 0.2 second tolerance
tolerance_slip_rate = 0.15        # 15% tolerance on slip rate
