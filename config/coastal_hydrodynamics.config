# ==============================================================================
# Coastal Hydrodynamics and Storm Surge Configuration
# ==============================================================================
#
# This configuration sets up a coastal hydrodynamics simulation
# including storm surge, wave-current interaction, and inundation.
#
# Applications:
#   - Storm surge forecasting
#   - Coastal flood risk assessment
#   - Hurricane impact modeling
#   - Estuarine circulation
#   - Tidal flat dynamics
#
# Physical processes:
#   - 2D shallow water equations
#   - Wind stress (parametric hurricane model)
#   - Atmospheric pressure forcing
#   - Tidal boundary conditions
#   - Wave-current interaction
#   - Wetting/drying for inundation
#
# ==============================================================================

[SIMULATION]
name = coastal_storm_surge
description = Storm surge and coastal flooding simulation

# Time parameters
start_time = 0.0
end_time = 345600.0             # 4 days (before, during, after storm)
dt_initial = 2.0                # 2 second time step (for wetting/drying)
dt_min = 0.1
dt_max = 10.0

# Output settings
output_frequency = 900          # Every 15 minutes
output_format = NETCDF
output_dir = output/storm_surge

# Physics coupling
enable_coastal_hydrodynamics = true
enable_storm_surge = true
enable_wave_dynamics = true
enable_sediment_transport = false

# GPU acceleration
use_gpu = true
gpu_mode = CPU_FALLBACK

# Solver settings
rtol = 1.0e-6
atol = 1.0e-8

# ==============================================================================
# Domain Configuration
# ==============================================================================

[DOMAIN]
# Example: Gulf of Mexico / Louisiana coast
lon_min = -94.0
lon_max = -88.0
lat_min = 28.0
lat_max = 31.0

# High resolution for coastal flooding
nx = 600                        # ~1 km resolution
ny = 300

# Coordinate reference
coordinate_system = WGS84
vertical_datum = NAVD88         # North American Vertical Datum 1988

# ==============================================================================
# Hydrodynamic Model Configuration
# ==============================================================================

[HYDRODYNAMIC]
model_type = SHALLOW_WATER_2D

# Time stepping
time_scheme = RK3               # Runge-Kutta 3rd order
cfl_number = 0.7
adaptive_timestep = true

# Physical parameters
gravity = 9.81
reference_density = 1020.0      # Slightly lower for brackish water

# Coriolis
use_coriolis = true
use_beta_plane = false
latitude_reference = 29.5
f0 = 7.29e-5                    # Coriolis at 29.5°N

# ==============================================================================
# Advection and Friction
# ==============================================================================

[ADVECTION]
scheme = MUSCL
limiter = MINMOD

[BOTTOM_FRICTION]
type = VARIABLE_MANNING         # Spatially variable Manning's n

# Default Manning's n values by land cover
manning_n_ocean = 0.020
manning_n_bay = 0.025
manning_n_marsh = 0.045
manning_n_channel = 0.030
manning_n_urban = 0.050
manning_n_forest = 0.100

# Manning's n file (spatially variable)
manning_file = data/manning_n_louisiana.nc

# ==============================================================================
# Wetting and Drying
# ==============================================================================

[WETTING_DRYING]
enabled = true
method = MOMENTUM_CONSERVING    # THIN_LAYER, MOMENTUM_CONSERVING

# Depth thresholds
dry_depth = 0.05                # 5 cm dry threshold
min_wet_depth = 0.10            # 10 cm minimum wet depth

# Velocity limiting in shallow areas
limit_velocity = true
max_velocity_shallow = 5.0      # m/s maximum in shallow water

# ==============================================================================
# Storm/Hurricane Configuration
# ==============================================================================

[STORM]
type = PARAMETRIC_HURRICANE     # PARAMETRIC_HURRICANE, ANALYTICAL, FROM_FILE

# Use parametric Holland (1980) model
wind_model = HOLLAND
pressure_model = HOLLAND

# Holland B parameter
holland_B = 1.5

# Background atmospheric pressure
ambient_pressure = 101325.0     # Pa

# Storm track file (time, lon, lat, pressure, max_wind, rmw)
track_file = data/storm_track.csv

# Or define storm track explicitly
[STORM_TRACK]
# Time (hours from start), Lon, Lat, Central Pressure (Pa), Max Wind (m/s), RMW (km)
# Example: Hurricane making landfall near Louisiana
point_0 = 0, -89.5, 26.0, 95500, 55, 35
point_1 = 24, -89.8, 27.5, 94000, 58, 33
point_2 = 48, -90.2, 29.0, 93500, 60, 30
point_3 = 60, -90.5, 29.5, 94500, 55, 35
point_4 = 72, -91.0, 30.5, 96000, 45, 40
point_5 = 96, -92.0, 32.0, 99000, 30, 50

# Wind asymmetry parameters
include_asymmetry = true
translation_speed_factor = 0.5  # Add fraction of storm motion

# Wind inflow angle
inflow_angle = 20.0             # degrees

# ==============================================================================
# Wave Model Configuration
# ==============================================================================

[WAVE_MODEL]
enabled = true
model_type = SPECTRAL           # SPECTRAL, PARAMETRIC

# Spectral discretization
num_frequencies = 25
num_directions = 36
freq_min = 0.04                 # Hz
freq_max = 0.50                 # Hz

# Physics
enable_wind_input = true
enable_whitecapping = true
enable_quadruplets = true
enable_depth_breaking = true
enable_bottom_friction = true
enable_refraction = true

# Breaking
breaking_model = BATTJES_JANSSEN
breaking_gamma = 0.73

# Coupling
coupling_interval = 600         # Couple with circulation every 10 min

# ==============================================================================
# Wave-Current Interaction
# ==============================================================================

[WAVE_CURRENT]
enabled = true

# Radiation stress gradient
include_radiation_stress = true

# Wave-enhanced bottom friction
wave_enhanced_friction = true
friction_model = GRANT_MADSEN   # GRANT_MADSEN, SOULSBY

# Stokes drift
include_stokes_drift = true

# Wave setup
compute_wave_setup = true

# ==============================================================================
# Tidal Forcing
# ==============================================================================

[TIDES]
enabled = true

# Tidal constituents
constituents = M2, S2, N2, K1, O1

# Tidal database
tidal_data_source = TPXO9

# Boundary conditions
apply_on_boundaries = true

# ==============================================================================
# Boundary Conditions
# ==============================================================================

[BOUNDARY_SOUTH]
type = OPEN
open_boundary_type = FLATHER
enable_tides = true
enable_surge = true             # Include surge from larger domain

# Sponge layer
sponge_width = 20000.0          # 20 km
sponge_strength = 0.0005

[BOUNDARY_WEST]
type = OPEN
open_boundary_type = FLATHER
enable_tides = true

[BOUNDARY_EAST]
type = OPEN
open_boundary_type = FLATHER
enable_tides = true

[BOUNDARY_NORTH]
type = LAND

# ==============================================================================
# River Inputs
# ==============================================================================

[RIVERS]
enabled = true
num_rivers = 2

[RIVER_1]
name = Mississippi_River
longitude = -89.25
latitude = 29.95
discharge = 15000.0             # m³/s
temperature = 20.0
salinity = 0.0

[RIVER_2]
name = Atchafalaya_River
longitude = -91.35
latitude = 29.7
discharge = 5500.0
temperature = 20.0
salinity = 0.0

# ==============================================================================
# Bathymetry and Topography
# ==============================================================================

[BATHYMETRY]
source = COMPOSITE              # Combine bathymetry and topography

# Offshore bathymetry
bathy_source = GEBCO
gebco_file = data/GEBCO_Gulf.nc

# Coastal/land topography
topo_source = LIDAR
lidar_file = data/Louisiana_DEM.nc

# Minimum depth
minimum_depth = 0.5             # meters

# Bathymetry smoothing for numerics
smooth_bathymetry = true
smoothing_iterations = 5

# ==============================================================================
# Land Cover and Roughness
# ==============================================================================

[LAND_COVER]
enabled = true
source = NLCD                   # National Land Cover Database
nlcd_file = data/NLCD_Louisiana.tif

# Manning's n lookup by NLCD class
# 11 = Open Water: 0.020
# 21 = Developed, Open Space: 0.030
# 22 = Developed, Low Intensity: 0.040
# 23 = Developed, Medium Intensity: 0.050
# 24 = Developed, High Intensity: 0.080
# 41 = Deciduous Forest: 0.100
# 42 = Evergreen Forest: 0.120
# 90 = Woody Wetlands: 0.045
# 95 = Emergent Herbaceous Wetlands: 0.035

# ==============================================================================
# Output Configuration
# ==============================================================================

[OUTPUT]
format = NETCDF
path = output/storm_surge

# Snapshot output
snapshot_interval = 900         # Every 15 minutes

# Variables to output
save_elevation = true
save_velocity = true
save_depth = true
save_wave_height = true
save_wave_direction = true
save_wind_stress = true
save_atmospheric_pressure = true

# Maximum value tracking
save_max_elevation = true
save_max_depth = true
save_max_velocity = true
save_max_wave_height = true

# Inundation mapping
save_inundation_extent = true
save_arrival_time = true
save_duration = true

# High-water marks
extract_high_water_marks = true

# ==============================================================================
# Station Output
# ==============================================================================

[STATIONS]
enabled = true
output_interval = 60            # Every minute

# NOAA tide gauges
[STATION_1]
name = Grand_Isle
station_id = 8761724
longitude = -89.957
latitude = 29.263

[STATION_2]
name = Shell_Beach
station_id = 8761305
longitude = -89.673
latitude = 29.868

[STATION_3]
name = Pilottown
station_id = 8760922
longitude = -89.258
latitude = 29.179

[STATION_4]
name = New_Canal_Station
station_id = 8761927
longitude = -90.113
latitude = 30.027

[STATION_5]
name = Eugene_Island
station_id = 8764227
longitude = -91.385
latitude = 29.373

# ==============================================================================
# Hazard Assessment
# ==============================================================================

[HAZARD]
# Inundation thresholds
inundation_thresholds = 0.3, 0.5, 1.0, 2.0, 3.0  # meters

# Velocity thresholds
velocity_thresholds = 0.5, 1.0, 2.0, 3.0         # m/s

# Combined hazard (momentum flux)
compute_momentum_flux = true
momentum_flux_thresholds = 1.0, 3.0, 7.0         # m³/s²

# Return period analysis (if multiple scenarios)
return_period_analysis = false
return_periods = 10, 50, 100, 500                # years

# ==============================================================================
# Evacuation Zones
# ==============================================================================

[EVACUATION]
enabled = true

# Define evacuation zone polygons
zone_file = data/evacuation_zones.shp

# Compute affected population
population_file = data/population_density.tif

# Statistics by zone
compute_zone_statistics = true

# ==============================================================================
# Parallel Configuration
# ==============================================================================

[PARALLEL]
decomposition = AUTO
halo_width = 3

# ==============================================================================
# Expected Results
# ==============================================================================
#
# For a Category 3 hurricane making landfall:
# - Peak surge: 3-5 m above normal tide
# - Maximum wind speeds: 50-60 m/s
# - Inundation extent: Significant flooding of coastal parishes
# - Duration: Elevated water levels for 12-24 hours
#
# Key features:
# - Storm surge buildup as hurricane approaches
# - Peak surge to the right of track (northern hemisphere)
# - Wind-driven setup in bays and estuaries
# - Wave setup contribution near shoreline
# - Ebb surge after storm passage
# - River-surge interaction at Mississippi Delta
#
# Critical areas:
# - Lake Pontchartrain (wind setup from NE winds)
# - Mississippi River outlets
# - Barrier islands (overwash potential)
# - Wetland areas (vegetation drag effects)
#
# ==============================================================================
