# ==============================================================================
# Planetary Impact Event Simulation
# ==============================================================================
# Models a hypervelocity impact (asteroid/meteorite/comet) including:
# - Contact and compression phase
# - Crater excavation and ejecta
# - Near-field damage and shock metamorphism
# - Seismic wave generation and global propagation
# - Atmospheric effects (for surface impacts)
# - Impact melt and vapor plume
#
# Scalable from small meteorite to extinction-level asteroid
# Based on Chicxulub, Meteor Crater, and laboratory impact studies
# ==============================================================================

[SIMULATION]
name = impact_event
description = Hypervelocity planetary impact with crater formation and seismic waves

# Time parameters - microseconds to hundreds of seconds
start_time = 0.0
end_time = 600.0                     # 10 minutes for seismic waves
dt_initial = 1.0e-9                  # Nanoseconds for contact
dt_min = 1.0e-12                     # Picoseconds for shock
dt_max = 0.01                        # Seconds after crater formation

# Multi-phase timestepping
adaptive_dt = true
phase_adaptive = true

# Phase 1: Contact/compression (microseconds)
phase1_end = 1.0e-3
phase1_dt_max = 1.0e-8

# Phase 2: Excavation (seconds)
phase2_end = 10.0
phase2_dt_max = 1.0e-4

# Phase 3: Modification (tens of seconds)
phase3_end = 60.0
phase3_dt_max = 0.001

# Phase 4: Seismic propagation (minutes)
phase4_dt_max = 0.01

# Output
output_frequency = 200
output_format = HDF5
enable_checkpointing = true
checkpoint_frequency = 5000

# Physics models
fluid_model = COMPRESSIBLE_EULER     # For impact vapor/melt
solid_model = ELASTOPLASTIC_JOHNSON_COOK  # High strain rate model

# Enable physics
enable_geomechanics = true
enable_elastodynamics = true
enable_thermal = true
enable_plasticity = true
enable_fractures = true
enable_phase_change = true           # Melting and vaporization
enable_atmosphere = true             # Vapor plume dynamics

# High-order methods
use_discontinuous_galerkin = true
dg_order = 4
use_ader_time_integration = true
enable_local_time_stepping = true

# Strong shocks require robust numerics
shock_capturing = WENO               # Weighted ENO for shocks
artificial_viscosity = true
av_coefficient = 2.0

# Solvers
rtol = 1.0e-5
atol = 1.0e-8
max_nonlinear_iterations = 100

# GPU acceleration essential
use_gpu = true
gpu_mode = GPU_ONLY

# ==============================================================================
# Impactor Parameters (Example: 1 km Asteroid)
# ==============================================================================
[IMPACTOR]
name = ASTEROID_1KM
type = ROCKY                         # ROCKY, IRON, COMETARY, ICY

# Geometry
shape = SPHERICAL
diameter = 1000.0                    # 1 km diameter (meters)
volume = 5.236e8                     # m³

# Material - ordinary chondrite composition
composition = CHONDRITE
density = 3500.0                     # kg/m³
mass = 1.83e12                       # kg

# Approach parameters
impact_velocity = 18000.0            # 18 km/s (typical asteroid)
impact_angle = 45.0                  # degrees from horizontal (most probable)
azimuth = 0.0                        # Direction of approach

# Impact point
impact_x = 100000.0                  # Center of domain
impact_y = 100000.0
impact_z = 0.0                       # Surface level

# Impactor material properties
[IMPACTOR.MATERIAL]
# Equation of state - Tillotson for silicates
eos_type = TILLOTSON
tillotson_a = 0.5
tillotson_b = 1.5
tillotson_A = 131.0e9                # Pa
tillotson_B = 49.0e9                 # Pa
tillotson_E0 = 487.0e6               # J/kg
tillotson_Es = 4.72e6                # J/kg
tillotson_Esp = 18.2e6               # J/kg
tillotson_alpha = 5.0
tillotson_beta = 5.0

# Strength (Lundborg approximation)
strength_model = LUNDBORG
intact_strength = 100.0e6            # Pa
damaged_strength = 1.0e6             # Pa
friction_coefficient = 0.6
melt_temperature = 1500.0            # K

# ==============================================================================
# Impact Energy Scaling
# ==============================================================================
[IMPACT_ENERGY]
# Kinetic energy: KE = 0.5 * m * v²
# For 1 km asteroid at 18 km/s: ~3 × 10^20 J = 72 Mt TNT equivalent
kinetic_energy = 2.96e20             # Joules
tnt_equivalent_mt = 72.0             # Megatons TNT

# Energy partitioning (approximate)
kinetic_to_seismic = 0.0001          # 0.01% to seismic waves
kinetic_to_thermal = 0.50            # 50% to heating
kinetic_to_ejecta = 0.30             # 30% to ejecta kinetic energy
kinetic_to_vapor = 0.10              # 10% to vaporization
kinetic_to_atmosphere = 0.05         # 5% to atmosphere

# Equivalent earthquake magnitude
# M_w ≈ (2/3) * log10(E) - 6.07 where E in Joules
# For 3e20 J: M_w ≈ 7.6
equivalent_magnitude = 7.6

# ==============================================================================
# Crater Formation Parameters
# ==============================================================================
[CRATER]
model = PI_SCALING                   # Pi-group scaling laws

# Scaling parameters (Holsapple & Schmidt)
# D = K * W^(1/3.4) for simple craters in rock
# For 72 Mt: D ≈ 15 km transient crater
scaling_law = HOLSAPPLE_ROCK

# Crater dimensions (from scaling)
transient_crater_diameter = 15000.0  # 15 km
transient_crater_depth = 4500.0      # ~30% of diameter

# Final crater (with collapse for complex crater)
crater_type = COMPLEX                # > 4 km diameter on Earth
final_crater_diameter = 20000.0      # 20 km (with wall slumping)
final_crater_depth = 2000.0          # Shallow due to rebound

# Central uplift (for complex craters)
enable_central_peak = true
central_peak_height = 800.0          # meters
central_peak_diameter = 5000.0

# Rim height and structure
rim_height = 500.0                   # meters above original surface
rim_width = 3000.0                   # meters

# Collapse and modification
enable_crater_collapse = true
collapse_time = 60.0                 # seconds
slumping_model = ACOUSTIC_FLUIDIZATION

# ==============================================================================
# Shock Wave Parameters
# ==============================================================================
[SHOCK_WAVE]
# Initial shock pressure (impedance matching)
# P = ρ * c * u where u = v/2 for symmetric impact
# For 3500 kg/m³ at 18 km/s: P ≈ 500 GPa peak
peak_pressure = 500.0e9              # Pa (500 GPa)

# Shock attenuation
decay_exponent = -1.87               # Empirical for rock
# P(r) = P0 * (r/r0)^decay_exponent

# Isobaric core
isobaric_core_radius = 1500.0        # ~1.5 km

# Shock metamorphism zones (pressure thresholds)
vaporization_pressure = 150.0e9     # Pa (complete vaporization)
melting_pressure = 60.0e9           # Pa (complete melting)
incipient_melt_pressure = 40.0e9    # Pa (partial melting)
shocked_quartz_pressure = 10.0e9    # Pa (PDFs in quartz)
fracture_pressure = 1.0e9           # Pa (pervasive fracturing)

# Hugoniot parameters for target (granite)
c0 = 5000.0                          # m/s (bulk sound speed)
s = 1.35                             # Hugoniot slope

# ==============================================================================
# Ejecta Parameters
# ==============================================================================
[EJECTA]
enabled = true
model = Z_MODEL                      # Maxwell Z-model

# Excavation flow field parameters
Z_exponent = 2.7                     # For crystalline target
flow_center_depth = 1500.0           # meters

# Ejecta velocity distribution
max_ejection_velocity = 5000.0       # m/s (near rim)
min_ejection_velocity = 10.0         # m/s (at rim)

# Ejecta mass
total_ejecta_mass = 1.0e14           # kg
ballistic_range_max = 500000.0       # 500 km

# Ejecta blanket
blanket_model = MCGETCHIN
thickness_at_rim = 200.0             # meters

# Secondary cratering
enable_secondary_craters = false     # Computationally expensive

# ==============================================================================
# Impact Melt and Vapor
# ==============================================================================
[MELT_VAPOR]
enabled = true

# Melt volume (empirical: V_melt ≈ 0.002 * V_crater)
melt_volume = 3.0e10                 # m³
melt_temperature = 2000.0            # K average

# Melt sheet
melt_sheet_thickness = 100.0         # meters in crater floor
melt_sheet_radius = 8000.0           # meters

# Vapor plume
vapor_volume = 5.0e9                 # m³
vapor_temperature = 5000.0           # K
vapor_expansion_velocity = 3000.0    # m/s

# Plume dynamics
plume_model = FIREBALL_ANALOG
plume_rise_height = 30000.0          # 30 km (above troposphere)

# Atmospheric re-entry of ejecta (thermal radiation)
enable_ejecta_reentry = true
reentry_thermal_pulse = true

# ==============================================================================
# Grid Configuration
# ==============================================================================
[GRID]
# Very large domain for seismic propagation
nx = 400
ny = 400
nz = 200

# Domain: 200 km × 200 km × 100 km
Lx = 200000.0
Ly = 200000.0
Lz = 100000.0

# Origin at corner, surface at z = 50000
origin_x = 0.0
origin_y = 0.0
origin_z = 0.0

# Surface level
surface_level = 50000.0

use_unstructured = false

# Multi-resolution adaptive mesh
[amr]
enabled = true
method = plex_refine

[amr.criterion]
type = combined
weight_shock = 1.0
weight_plastic_strain = 0.8
weight_temperature = 0.5
weight_damage = 0.3

[amr.strategy]
type = fixed_fraction
refine_fraction = 0.25
coarsen_fraction = 0.1

[amr.limits]
max_refinement_level = 6
max_cells = 50000000
min_cell_size = 10.0                 # 10 m minimum

# Impact point high resolution
[amr.features.impact]
x = 100000.0
y = 100000.0
z = 50000.0
radius = 30000.0
level = 6

# Crater region
[amr.features.crater]
x = 100000.0
y = 100000.0
z = 45000.0
radius = 50000.0
level = 4

# ==============================================================================
# Target Material - Crystalline Basement
# ==============================================================================
[ROCK]
name = GRANITE_BASEMENT
constitutive_model = JOHNSON_COOK

# Elastic properties
youngs_modulus = 65.0e9              # 65 GPa
poisson_ratio = 0.25
density = 2700.0                     # kg/m³

# Wave velocities
p_wave_velocity = 6000.0             # m/s
s_wave_velocity = 3500.0             # m/s

# Quality factors
quality_factor_p = 500.0
quality_factor_s = 250.0

# Equation of state - Tillotson for granite
eos_type = TILLOTSON
tillotson_a = 0.5
tillotson_b = 1.5
tillotson_A = 18.0e9
tillotson_B = 18.0e9
tillotson_E0 = 16.0e6
tillotson_Es = 3.5e6
tillotson_Esp = 18.0e6
tillotson_alpha = 5.0
tillotson_beta = 5.0

# Johnson-Cook strength model
# σ = (A + B*ε^n)(1 + C*ln(ε̇/ε̇₀))(1 - T*^m)
jc_A = 1.0e9                         # Pa (initial yield)
jc_B = 300.0e6                       # Pa (hardening)
jc_n = 0.35                          # Hardening exponent
jc_C = 0.02                          # Strain rate sensitivity
jc_m = 1.0                           # Thermal softening exponent
jc_ref_strain_rate = 1.0             # 1/s
jc_melt_temperature = 1500.0         # K

# Damage model
damage_model = GRADY_KIPP
damage_constant = 1.0e-6
fragment_size_exponent = -0.67

# Acoustic fluidization (for crater collapse)
acoustic_fluidization = true
af_viscosity = 1.0e8                 # Pa·s
af_decay_time = 100.0                # seconds

# Thermal properties
thermal_conductivity = 3.0           # W/m·K
specific_heat = 1000.0               # J/kg·K
thermal_expansion = 7.0e-6           # 1/K

# Porosity
porosity = 0.02
compaction_model = P_ALPHA
distension_initial = 1.02

# ==============================================================================
# Sedimentary Cover (if present)
# ==============================================================================
[ROCK_SEDIMENT]
name = SEDIMENTARY_COVER
constitutive_model = JOHNSON_COOK

youngs_modulus = 15.0e9              # Softer
poisson_ratio = 0.30
density = 2400.0

p_wave_velocity = 3500.0
s_wave_velocity = 2000.0

# Lower strength
jc_A = 100.0e6
jc_B = 50.0e6
jc_n = 0.3
jc_C = 0.04
jc_m = 1.0

# Higher porosity
porosity = 0.15
distension_initial = 1.18

# ==============================================================================
# Atmosphere (if surface impact)
# ==============================================================================
[ATMOSPHERE]
enabled = true
model = US_STANDARD_1976

ground_level = 50000.0               # z coordinate of surface
top_of_domain = 100000.0

sea_level_pressure = 101325.0
sea_level_temperature = 288.15
sea_level_density = 1.225

# Atmosphere-surface interaction
include_entry_heating = true
entry_velocity = 18000.0             # m/s

# Vapor plume expansion
plume_interaction = true

# Ejecta curtain
ejecta_air_interaction = true
drag_coefficient = 0.5

# ==============================================================================
# Initial Conditions
# ==============================================================================
[IC1]
field = DISPLACEMENT
distribution = UNIFORM
value = 0.0

[IC2]
field = VELOCITY
distribution = UNIFORM
value = 0.0

[IC3]
# Lithostatic stress
field = STRESS
distribution = LITHOSTATIC
surface_level = 50000.0
density = 2700.0

[IC4]
# Geothermal temperature
field = TEMPERATURE
distribution = GRADIENT
reference_z = 50000.0
reference_value = 288.15             # Surface temperature
gradient = 0.0, 0.0, -0.025          # 25 K/km downward

[IC5]
# Impactor initial state
field = IMPACTOR_VELOCITY
region = IMPACTOR
value_x = 12728.0                    # v*cos(45°)
value_y = 0.0
value_z = -12728.0                   # v*sin(45°) downward

# ==============================================================================
# Boundary Conditions
# ==============================================================================
[BC1]
# Free surface
type = FREE_SURFACE
location = SURFACE
field = DISPLACEMENT

[BC2]
# Absorbing boundaries (all sides except top)
type = ABSORBING
location = XMIN, XMAX, YMIN, YMAX, ZMIN
field = DISPLACEMENT
absorbing_type = PML
pml_layers = 25
pml_strength = 150.0

[BC3]
# Atmospheric outflow
type = OUTFLOW
location = ZMAX
field = ALL

# ==============================================================================
# Seismic Receivers
# ==============================================================================
[RECEIVERS]
output_format = HDF5
sampling_rate = 200.0                # 200 Hz

# Near-field stations (within damage zone)
[RECEIVER_NEAR]
type = RADIAL
center = 100000.0, 100000.0, 50000.0
distances = 5000, 10000, 15000, 20000, 25000
num_azimuths = 8
depth = -10.0                        # 10 m below surface
fields = displacement, velocity, acceleration, pressure

# Intermediate-field stations
[RECEIVER_MID]
type = RADIAL
center = 100000.0, 100000.0, 50000.0
distances = 30000, 40000, 50000, 60000, 70000, 80000
num_azimuths = 8
depth = -10.0
fields = displacement, velocity, acceleration

# Far-field stations
[RECEIVER_FAR]
type = LINE
start = 100000.0, 100000.0, 49990.0
end = 200000.0, 100000.0, 49990.0
num_stations = 20
fields = displacement, velocity, acceleration

# Depth array (borehole sensors)
[RECEIVER_DEPTH]
type = VERTICAL
x = 130000.0                         # 30 km from impact
y = 100000.0
z_start = 49990.0
z_end = 40000.0
num_stations = 10
fields = displacement, velocity, pressure

# Pressure sensors (for atmosphere)
[RECEIVER_PRESSURE]
type = RADIAL
center = 100000.0, 100000.0, 50010.0
distances = 10000, 25000, 50000, 75000
num_azimuths = 8
depth = 10.0                         # 10 m above surface
fields = pressure, temperature, velocity

# ==============================================================================
# Output Configuration
# ==============================================================================
[OUTPUT]
format = HDF5
path = output/impact_event

# Volume fields
save_displacement = true
save_velocity = true
save_stress = true
save_strain = true
save_pressure = true
save_temperature = true
save_damage = true
save_plastic_strain = true
save_density = true

# Crater evolution
save_crater_outline = true
save_ejecta_curtain = true
save_melt_distribution = true

# Output frequency
volume_output_frequency = 500
surface_output_frequency = 50

# Cross-sections
save_cross_sections = true
cross_section_planes = XZ_Y100000, YZ_X100000, XY_Z50000, XY_Z48000
cross_section_frequency = 100

# Shock front tracking
track_shock_front = true
shock_threshold_pressure = 1.0e9     # 1 GPa

# Phase boundaries
save_melt_boundary = true
save_vapor_boundary = true
save_shock_metamorphism = true

# Seismic source
save_equivalent_source = true
save_moment_tensor = true
save_moment_rate = true

# Animation frames
save_animation = true
animation_interval = 20

# ==============================================================================
# Analysis
# ==============================================================================
[ANALYSIS]
# Crater morphometry
compute_crater_metrics = true
metrics_output_file = crater_metrics.csv

# Shock attenuation
compute_shock_decay = true
shock_decay_radii = 500, 1000, 2000, 5000, 10000, 20000, 50000

# Damage zones
compute_damage_zones = true
damage_thresholds = vaporized, melted, shocked_high, shocked_low, fractured

# Ejecta distribution
compute_ejecta_distribution = true
ejecta_mass_vs_radius = true
ejecta_velocity_distribution = true

# Seismic waves
compute_seismic_magnitude = true
magnitude_types = mb, Ms, Mw, Me

# Energy partitioning
compute_energy_partition = true
track_kinetic_energy = true
track_thermal_energy = true
track_seismic_energy = true
track_ejecta_energy = true

# Peak values
compute_peak_pressure = true
compute_peak_velocity = true
compute_peak_temperature = true

# Environmental effects
compute_thermal_radiation = true
compute_ejecta_reentry_heating = true

# ==============================================================================
# Scaling Configurations (Alternative Impactor Sizes)
# ==============================================================================
# These sections allow quick reconfiguration for different event sizes

[SCALING_METEOR_CRATER]
# Arizona Meteor Crater (50 m iron, 15 km/s)
impactor_diameter = 50.0
impactor_density = 7800.0            # Iron
impact_velocity = 15000.0
yield_equivalent_mt = 0.01           # ~10 kt

[SCALING_TUNGUSKA]
# Tunguska airburst (60 m stony, 15 km/s)
impactor_diameter = 60.0
impactor_density = 3000.0
impact_velocity = 15000.0
airburst_altitude = 8000.0           # Did not reach ground
yield_equivalent_mt = 0.015          # ~15 Mt

[SCALING_CHICXULUB]
# Chicxulub K-Pg extinction event (10 km asteroid)
impactor_diameter = 10000.0
impactor_density = 2700.0
impact_velocity = 20000.0
impact_angle = 60.0
yield_equivalent_mt = 100000000.0    # ~100 Tt (teratons)
final_crater_diameter = 180000.0     # 180 km

[SCALING_SMALL_METEORITE]
# Small meteorite (1 m stony)
impactor_diameter = 1.0
impactor_density = 3000.0
impact_velocity = 12000.0
yield_equivalent_kt = 0.001          # ~1 ton TNT
crater_diameter = 10.0               # 10 m crater
