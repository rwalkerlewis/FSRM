# ============================================================================
# SCEC TPV5: Slip-weakening on a planar fault (SeisSol compatible)
# ============================================================================
# This config demonstrates FSRM's compatibility with SeisSol benchmarks
# while adding unique capabilities (reservoir coupling, GPU acceleration)
# ============================================================================

[SIMULATION]
# Basic settings
start_time = 0.0
end_time = 12.0                    # seconds
dt_initial = 0.001                 # seconds
dt_min = 1e-6
dt_max = 0.01

# Output
output_frequency = 100             # steps
output_format = HDF5
output_directory = output/tpv5_dg

# Numerical method (NEW: SeisSol-style DG)
use_discontinuous_galerkin = true
dg_order = 3                       # O3 = 4th order accurate
dg_basis_type = NODAL              # NODAL or MODAL
dg_flux_method = RUSANOV           # RUSANOV, HLL, HLLC

# Time integration (NEW: ADER method)
use_ader_time_integration = true
ader_order = 4                     # Match spatial order

# Local time stepping (NEW: major speedup)
enable_local_time_stepping = true
lts_rate = 2                       # Rate-2 LTS
lts_max_clusters = 20
lts_auto_merge = true
lts_wiggle_factor_min = 0.51

# Physics
enable_elastodynamics = true
enable_dynamic_rupture = true

# GPU acceleration (FSRM advantage over SeisSol!)
use_gpu = true
gpu_mode = GPU_ONLY
gpu_device_id = 0

[GRID]
# Structured grid for this benchmark
use_unstructured = false
nx = 200
ny = 1
nz = 100
Lx = 30000.0                       # 30 km
Ly = 100.0                         # thin (quasi-2D)
Lz = 15000.0                       # 15 km depth

[ROCK]
# Elastic properties (homogeneous)
youngs_modulus = 32.04e9           # Pa
poisson_ratio = 0.25
density = 2670.0                   # kg/mÂ³

# Wave velocities (derived)
p_wave_velocity = 6000.0           # m/s
s_wave_velocity = 3464.0           # m/s

# Attenuation (NEW: multi-Maxwell body)
enable_attenuation = true
attenuation_num_mechanisms = 3
attenuation_freq_central = 2.0     # Hz
attenuation_freq_ratio = 100.0
quality_factor_p = 100.0           # Qp
quality_factor_s = 50.0            # Qs

# Damping (for numerical stability)
damping_alpha = 0.0
damping_beta = 0.0

[FAULT1]
# Fault geometry
type = PLANAR_VERTICAL
strike = 90.0                      # degrees (E-W fault)
dip = 90.0                         # degrees (vertical)
x_center = 0.0
y_center = 0.0
z_center = -7500.0                 # centered at 7.5 km depth
length = 30000.0                   # 30 km along strike
width = 15000.0                    # 15 km down-dip

# Friction law - Linear slip weakening (TPV5 standard)
friction_law = LINEAR_SLIP_WEAKENING
mu_s = 0.677                       # Static friction
mu_d = 0.525                       # Dynamic friction
d_c = 0.40                         # Critical slip distance [m]
cohesion = 0.0                     # No cohesion

# Initial stress (homogeneous)
# TPV5: Right-lateral strike-slip
initial_shear_stress = 81.6e6      # Pa (nucleation patch)
initial_normal_stress = -120.0e6   # Pa (negative = compression)

# Nucleation patch
nucleation_type = SPATIAL_PATCH
nucleation_x_center = 0.0
nucleation_z_center = -7500.0
nucleation_radius = 3000.0         # 3 km radius
nucleation_time_function = SMOOTHSTEP
nucleation_start_time = 0.0
nucleation_duration = 0.5          # 0.5 s ramp

# Outside nucleation: lower initial stress
background_shear_stress = 70.0e6   # Pa

# Enable split-node method (NEW: advanced fault treatment)
use_split_nodes = true
split_node_method = PENALTY
penalty_normal = 1e12
penalty_tangent = 1e10

[BC1]
# Absorbing boundaries (all sides)
type = ABSORBING
location = ALL_SIDES
absorbing_method = PML             # Perfectly Matched Layer
pml_width = 1000.0                 # meters
pml_strength = 1000.0

[OUTPUT]
# Fault output (detailed)
output_fault_data = true
fault_output_fields = slip,slip_rate,shear_stress,normal_stress,rupture_time
fault_output_frequency = 1         # every timestep (for detailed rupture analysis)

# Volume output (less frequent)
volume_output_fields = velocity,displacement,stress
volume_output_frequency = 100

# Receiver output (time series at specific points)
enable_receivers = true
receiver_file = receivers_tpv5.txt

[VERIFICATION]
# Compare against SeisSol reference solution
enable_verification = true
reference_solution_file = reference/seissol_tpv5.h5
verification_fields = slip_rate,rupture_velocity
verification_tolerance = 0.05      # 5% tolerance
