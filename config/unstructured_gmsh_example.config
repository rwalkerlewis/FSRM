# ==============================================================================
# Unstructured Mesh Example using Gmsh
# ==============================================================================
# Demonstrates loading an unstructured mesh from Gmsh format with:
#   - Material domain mapping from physical groups
#   - Boundary conditions from named physical surfaces
#   - EPSG coordinate system transformations
#
# This example requires a Gmsh mesh file with physical groups defined.
# Create one using Gmsh:
#   gmsh -3 my_reservoir.geo -o my_reservoir.msh
#
# See docs/GMSH_MESH_GUIDE.md for detailed instructions on creating meshes.
#
# Usage: mpirun -np 4 fsrm -c config/unstructured_gmsh_example.config
# ==============================================================================

[SIMULATION]
name = unstructured_gmsh
start_time = 0.0
end_time = 86400.0                    # 1 day
dt_initial = 3600.0                   # 1 hour
dt_min = 60.0
dt_max = 43200.0                      # 12 hours
max_timesteps = 1000
output_frequency = 10

fluid_model = SINGLE_COMPONENT
solid_model = ELASTIC

enable_geomechanics = false
enable_thermal = false

rtol = 1.0e-6
atol = 1.0e-8

[GRID]
# =============================================================================
# Gmsh Mesh Configuration
# =============================================================================
mesh_type = GMSH
mesh_file = meshes/reservoir.msh      # Path to your .msh file
use_unstructured = true

# Main computational domain (optional, for single-domain meshes)
gmsh_physical_volume = reservoir

# Material domain mapping (map physical volumes to material sections)
# Format: physical_group_name:MATERIAL_SECTION, ...
# Example: gmsh_material_mapping = reservoir:ROCK1, caprock:ROCK2
gmsh_material_mapping = reservoir:ROCK

# Boundary surfaces for BC application
gmsh_boundaries = inlet, outlet, walls

# Mesh refinement (additional refinement beyond Gmsh mesh)
gmsh_refinement_level = 0

# =============================================================================
# Coordinate Reference System (Optional)
# =============================================================================
# Input coordinates in WGS84 (lat/lon)
input_crs = EPSG:4326

# Model coordinates in UTM Zone 10N (meters)
model_crs = EPSG:32610

# Use local coordinates centered at project site
use_local_coordinates = true
local_origin_x = -122.4194            # Longitude (San Francisco example)
local_origin_y = 37.7749              # Latitude
local_origin_z = 0.0                  # Depth datum

# Alternative: auto-detect UTM zone from coordinates
# auto_detect_utm = true

# =============================================================================
# Material Properties
# =============================================================================

[ROCK]
name = Reservoir_Sandstone
porosity = 0.20
permeability_x = 100 mD
permeability_y = 100 mD
permeability_z = 10 mD
youngs_modulus = 15 GPa
poisson_ratio = 0.25
density = 2500 kg/m3
biot_coefficient = 0.8

# =============================================================================
# Fluid Properties
# =============================================================================

[FLUID]
type = SINGLE_PHASE
density = 1000 kg/m3
viscosity = 1 cP
compressibility = 4.5e-10 1/Pa

# =============================================================================
# Wells
# =============================================================================

[WELL1]
name = INJECTOR
type = INJECTOR
# Well location in input CRS (WGS84 lat/lon)
# Coordinates are transformed to model CRS automatically
x = -122.4190                         # Longitude
y = 37.7750                           # Latitude
z = -500.0                            # Depth (negative = below surface)
control_mode = RATE
target_value = 0.001 m3/s
fluid = WATER

[WELL2]
name = PRODUCER
type = PRODUCER
x = -122.4180
y = 37.7745
z = -500.0
control_mode = BHP
target_value = 10.0 MPa

# =============================================================================
# Boundary Conditions
# =============================================================================
# Location references Gmsh physical group names

[BC1]
type = DIRICHLET
field = PRESSURE
location = inlet                      # Gmsh physical group name
value = 15.0 MPa

[BC2]
type = DIRICHLET
field = PRESSURE
location = outlet
value = 10.0 MPa

[BC3]
type = NEUMANN
field = PRESSURE
location = walls
value = 0.0                           # No-flow

# =============================================================================
# Initial Conditions
# =============================================================================

[IC1]
field = PRESSURE
distribution = UNIFORM
value = 12.0 MPa

# =============================================================================
# Output Configuration
# =============================================================================

[OUTPUT]
format = VTK
path = output/unstructured
frequency = 10
pressure = true
displacement = false

# =============================================================================
# Example Gmsh Geometry File
# =============================================================================
# Save as 'meshes/reservoir.geo' and run: gmsh -3 meshes/reservoir.geo
#
# SetFactory("OpenCASCADE");
# 
# Box(1) = {0, 0, -100, 1000, 500, 100};
# 
# Physical Volume("reservoir") = {1};
# Physical Surface("inlet") = {1};
# Physical Surface("outlet") = {2};
# Physical Surface("walls") = {3, 4, 5, 6};
# 
# Mesh.CharacteristicLengthMin = 20;
# Mesh.CharacteristicLengthMax = 50;
# ==============================================================================
