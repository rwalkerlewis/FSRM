# ==============================================================================
# Unstructured Mesh Example using Gmsh
# ==============================================================================
# Demonstrates loading an unstructured mesh from Gmsh format with
# EPSG coordinate system transformations.
#
# This example requires a Gmsh mesh file. You can create one using Gmsh:
#   gmsh -3 my_reservoir.geo -o my_reservoir.msh
#
# Usage: mpirun -np 4 fsrm -c config/unstructured_gmsh_example.config
# ==============================================================================

[SIMULATION]
name = unstructured_gmsh
start_time = 0.0
end_time = 86400.0                    # 1 day
dt_initial = 3600.0                   # 1 hour
dt_min = 60.0
dt_max = 43200.0                      # 12 hours
max_timesteps = 1000
output_frequency = 10

fluid_model = SINGLE_COMPONENT
solid_model = ELASTIC

enable_geomechanics = false
enable_thermal = false

rtol = 1.0e-6
atol = 1.0e-8

[GRID]
# Unstructured mesh from Gmsh
mesh_type = GMSH
mesh_file = meshes/reservoir.msh      # Path to your .msh file
use_unstructured = true

# Physical groups from Gmsh (must match names in .msh file)
gmsh_physical_volume = reservoir      # Main computational domain
gmsh_boundaries = inlet, outlet, walls

# Mesh refinement (additional refinement beyond Gmsh mesh)
gmsh_refinement_level = 0

# Coordinate Reference System
# Input coordinates in WGS84 (lat/lon)
input_crs = EPSG:4326

# Model coordinates in UTM Zone 10N (meters)
model_crs = EPSG:32610

# Use local coordinates centered at project site
use_local_coordinates = true
local_origin_x = -122.4194            # Longitude (San Francisco example)
local_origin_y = 37.7749              # Latitude
local_origin_z = 0.0                  # Depth datum

# Alternative: auto-detect UTM zone from coordinates
# auto_detect_utm = true

[ROCK]
porosity = 0.20
permeability_x = 100.0                # mD
permeability_y = 100.0
permeability_z = 10.0
youngs_modulus = 15.0e9               # Pa
poisson_ratio = 0.25
density = 2500.0

[FLUID]
type = SINGLE_PHASE
density = 1000.0
viscosity = 0.001
compressibility = 4.5e-10

[WELL1]
name = INJECTOR
type = INJECTOR
# Well location in input CRS (WGS84 lat/lon)
# The coordinates will be transformed to model CRS automatically
x = -122.4190                         # Longitude
y = 37.7750                           # Latitude
z = -500.0                            # Depth (negative = below surface)
control_mode = RATE
target_value = 0.001                  # mÂ³/s
fluid = WATER

[WELL2]
name = PRODUCER
type = PRODUCER
x = -122.4180
y = 37.7745
z = -500.0
control_mode = BHP
target_value = 10.0e6                 # Pa

# Boundary conditions reference physical groups from Gmsh
[BC1]
type = DIRICHLET
field = PRESSURE
location = inlet                      # Gmsh physical group name
value = 15.0e6                        # Pa

[BC2]
type = DIRICHLET
field = PRESSURE
location = outlet
value = 10.0e6

[BC3]
type = NEUMANN
field = PRESSURE
location = walls
value = 0.0                           # No-flow

[IC1]
field = PRESSURE
distribution = UNIFORM
value = 12.0e6

[OUTPUT]
format = VTK
path = output/unstructured
frequency = 10
pressure = true
displacement = false
